This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
app/(app)/demo/page.tsx
app/(marketing)/page.tsx
app/admin/page.tsx
app/api/bays/status/route.ts
app/api/bookings/availability/route.ts
app/api/bookings/check-availability/route.ts
app/api/bookings/create/route.ts
app/api/coupons/validate/route.ts
app/api/debug-yoco/route.ts
app/api/payment/confirm/route.ts
app/api/payment/initialize/route.ts
app/api/payment/verify/route.ts
app/api/trigger-n8n/route.ts
app/apple-icon.tsx
app/booking/confirm/page.tsx
app/booking/page.tsx
app/booking/success/page.tsx
app/globals.css
app/icon.tsx
app/layout.tsx
CLOUDFLARE_DEPLOYMENT.md
components.json
components/admin-dashboard.tsx
components/admin/availability-manager.tsx
components/admin/bookings-table.tsx
components/admin/competitions-manager.tsx
components/admin/revenue-reports.tsx
components/BayStatusDisplay.tsx
components/booking-confirmation.tsx
components/booking-flow.tsx
components/booking-success.tsx
components/theme-provider.tsx
components/ui/badge.tsx
components/ui/button.tsx
components/ui/calendar.tsx
components/ui/card.tsx
components/ui/checkbox.tsx
components/ui/input.tsx
components/ui/label.tsx
components/ui/select.tsx
components/ui/separator.tsx
components/ui/switch.tsx
components/ui/table.tsx
components/ui/tabs.tsx
config.yml
lib/email.tsx
lib/github/workflows/deploy.yml
lib/supabase/client.ts
lib/supabase/middleware.ts
lib/supabase/server.ts
lib/types.ts
lib/utils.ts
lib/venue-config.ts
MIGRATION_TO_OPENNEXT.md
next.config.mjs
opennext.config.js
opennext.config.ts
package.json
postcss.config.mjs
public/aerial-view-of-augusta-national-golf-course.jpg
public/CommandCenter.png
public/dashboard-screen.png
public/golf-course-aerial.png
public/golf-simulator-bay-with-augusta-national-on-screen.jpg
public/icon.svg
public/images/footerimage.jpeg
public/mixed-group-celebrating-longest-drive-on-simulator.jpg
public/mulligan-logo.jpg
public/mulligan-logo.png
public/placeholder-logo.png
public/placeholder-logo.svg
public/placeholder-user.jpg
public/placeholder.jpg
public/placeholder.svg
public/simulator-cta-bg.png
README.md
scripts/001_create_tables.sql
scripts/002_enable_rls.sql
scripts/003_seed_data.sql
scripts/004_create_functions.sql
scripts/005_add_booking_fields.sql
scripts/006_update_pricing_and_courses.sql
scripts/007_add_addons_to_bookings.sql
scripts/008_add_public_booking_policy.sql
styles/globals.css
tsconfig.json
worker.js
wrangler.toml
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".gitignore">
# dependencies
/node_modules
/.pnp
.pnp.js

# testing
/coverage

# next.js
/.next/
/out/
/.open-next/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*

# local env files
.env*.local
.env
.dev.vars

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

# cloudflare
.wrangler/
.dev.vars
wrangler.toml.backup
</file>

<file path="app/(app)/demo/page.tsx">
'use client';

import React, { useState, useEffect, useRef } from 'react';
import { 
  Activity, Users, DollarSign, Calendar, Settings, Bell, 
  Zap, Clock, Terminal, Smartphone, ChevronRight, Mic, 
  PhoneIncoming, ShieldCheck, Wifi, MessageSquarePlus // <--- Added this fix
} from 'lucide-react';

// --- TYPES & MOCK DATA ---
type BayStatus = 'active' | 'idle' | 'cleaning' | 'reserved';
interface Log {
  id: string;
  time: string;
  source: 'n8n' | 'STRIPE' | 'SYSTEM' | 'USER' | 'VOICE_AI';
  message: string;
  type: 'info' | 'success' | 'warning' | 'error';
}

const INITIAL_BAYS: any[] = [
  { id: 1, name: 'Bay 01 (Pebble Beach)', status: 'active', currentSession: { customer: 'M. Ross', timeLeft: '45m', value: 85 } },
  { id: 2, name: 'Bay 02 (St. Andrews)', status: 'active', currentSession: { customer: 'J. Specter', timeLeft: '15m', value: 120 } },
  { id: 3, name: 'Bay 03 (Augusta)', status: 'idle' },
  { id: 4, name: 'Bay 04 (Spyglass)', status: 'reserved', currentSession: { customer: 'L. Litt', timeLeft: 'Starts in 10m', value: 65 } },
  { id: 5, name: 'Bay 05 (Sawgrass)', status: 'active', currentSession: { customer: 'D. Paulsen', timeLeft: '1h 20m', value: 150 } },
  { id: 6, name: 'Bay 06 (Bethpage)', status: 'cleaning' },
];

const BOOT_SEQUENCE = [
  "INITIALIZING VENUE CORE v2.4...",
  "CONNECTING TO STRIPE CONNECT (US)...",
  "ESTABLISHING SECURE HANDSHAKE...",
  "LOADING NEURAL VOICE MODELS...",
  "CALIBRATING YIELD ENGINE...",
  "SYSTEM ONLINE."
];

// --- COMPONENTS ---

// 1. The Boot Screen
const BootScreen = ({ onComplete }: { onComplete: () => void }) => {
  const [lines, setLines] = useState<string[]>([]);
  
  useEffect(() => {
    let delay = 0;
    BOOT_SEQUENCE.forEach((line, index) => {
      delay += Math.random() * 300 + 400; 
      setTimeout(() => {
        setLines(prev => [...prev, line]);
        if (index === BOOT_SEQUENCE.length - 1) {
          setTimeout(onComplete, 800);
        }
      }, delay);
    });
  }, []);

  return (
    <div className="fixed inset-0 bg-black z-[100] flex flex-col items-center justify-center font-mono text-emerald-500 p-8 select-none">
      <div className="w-full max-w-md space-y-2">
        {lines.map((line, i) => (
          <div key={i} className="border-r-2 border-emerald-500 w-fit animate-pulse pr-1">
            {`> ${line}`}
          </div>
        ))}
        <div className="h-4 w-2 bg-emerald-500 animate-blink mt-2"></div>
      </div>
    </div>
  );
};

// 2. Animated Number
const AnimatedNumber = ({ value }: { value: number }) => {
  const [displayValue, setDisplayValue] = useState(value);

  useEffect(() => {
    let start = displayValue;
    const end = value;
    if (start === end) return;
    
    const duration = 1000;
    const startTime = performance.now();

    const animate = (currentTime: number) => {
      const elapsed = currentTime - startTime;
      const progress = Math.min(elapsed / duration, 1);
      const ease = 1 - Math.pow(1 - progress, 4);
      
      const current = Math.floor(start + (end - start) * ease);
      setDisplayValue(current);

      if (progress < 1) requestAnimationFrame(animate);
    };
    requestAnimationFrame(animate);
  }, [value]);

  return <>{displayValue.toLocaleString()}</>;
};

// 3. Status Badge
const StatusBadge = ({ status }: { status: BayStatus }) => {
  const styles: any = {
    active: 'bg-emerald-500/10 text-emerald-500 border-emerald-500/20',
    idle: 'bg-zinc-800 text-zinc-400 border-zinc-700',
    cleaning: 'bg-amber-500/10 text-amber-500 border-amber-500/20',
    reserved: 'bg-blue-500/10 text-blue-500 border-blue-500/20',
  };
  return (
    <span className={`px-2 py-0.5 rounded text-[10px] font-mono uppercase tracking-wider border ${styles[status]} flex items-center gap-1.5`}>
      <span className={`w-1.5 h-1.5 rounded-full ${status === 'active' ? 'bg-current animate-pulse' : 'bg-current'}`} />
      {status}
    </span>
  );
};

// 4. Bay Card
const BayCard = ({ bay }: { bay: any }) => (
  <div className="group relative bg-[#09090b] border border-white/5 hover:border-emerald-500/30 transition-all duration-300 p-5 rounded-lg overflow-hidden">
    <div className="absolute inset-0 bg-gradient-to-b from-white/[0.02] to-transparent opacity-0 group-hover:opacity-100 transition-opacity" />
    <div className="flex justify-between items-start mb-6">
      <div>
        <h3 className="text-sm font-medium text-zinc-200">{bay.name}</h3>
        <p className="text-[10px] text-zinc-500 font-mono mt-1 uppercase">Unit ID: {bay.id < 10 ? `0${bay.id}` : bay.id}</p>
      </div>
      <StatusBadge status={bay.status} />
    </div>
    {bay.status === 'active' || bay.status === 'reserved' ? (
      <div className="space-y-3">
         <div className="flex justify-between items-end">
            <div>
               <p className="text-[10px] text-zinc-500 uppercase tracking-wider mb-1">Customer</p>
               <p className="text-sm text-white font-medium">{bay.currentSession?.customer}</p>
            </div>
            <div className="text-right">
               <p className="text-[10px] text-zinc-500 uppercase tracking-wider mb-1">Value</p>
               <p className="text-sm text-emerald-400 font-mono">${bay.currentSession?.value}</p>
            </div>
         </div>
         <div className="bg-zinc-900 rounded-sm p-2 flex items-center justify-between border border-white/5">
            <span className="text-[10px] text-zinc-400 flex items-center gap-2"><Clock className="w-3 h-3" /> Time Remaining</span>
            <span className="text-xs font-mono text-white">{bay.currentSession?.timeLeft}</span>
         </div>
      </div>
    ) : (
      <div className="h-[86px] flex flex-col items-center justify-center border border-dashed border-white/5 rounded-sm bg-black/20">
         <p className="text-[10px] text-zinc-600 uppercase tracking-widest">Available</p>
         <button className="mt-2 text-[10px] bg-white/5 hover:bg-white/10 text-white px-3 py-1 rounded transition-colors">Quick Book</button>
      </div>
    )}
  </div>
);

// 5. Log Stream
const LogStream = ({ logs }: { logs: Log[] }) => {
   const scrollRef = useRef<HTMLDivElement>(null);
   useEffect(() => { if (scrollRef.current) scrollRef.current.scrollTop = 0; }, [logs]);
   return (
      <div className="h-full flex flex-col">
         <div className="flex items-center justify-between p-4 border-b border-white/5 bg-[#09090b]">
            <div className="flex items-center gap-2">
               <Terminal className="w-4 h-4 text-zinc-500" />
               <span className="text-xs font-mono uppercase text-zinc-400">System Activity</span>
            </div>
            <span className="flex h-2 w-2 relative">
               <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
               <span className="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
            </span>
         </div>
         <div ref={scrollRef} className="flex-1 overflow-y-auto p-4 space-y-3 font-mono text-[10px]">
            {logs.map((log) => (
               <div key={log.id} className="flex gap-3 animate-[fadeIn_0.3s_ease-out]">
                  <span className="text-zinc-600 shrink-0">{log.time}</span>
                  <div className="flex-1">
                     <span className={`uppercase font-bold tracking-wider mr-2 ${
                        log.source === 'n8n' ? 'text-blue-400' : 
                        log.source === 'STRIPE' ? 'text-indigo-400' : 
                        log.source === 'VOICE_AI' ? 'text-emerald-400' : 'text-zinc-500'
                     }`}>[{log.source}]</span>
                     <span className={`${
                        log.type === 'success' ? 'text-emerald-500' :
                        log.type === 'warning' ? 'text-amber-500' : 'text-zinc-300'
                     }`}>{log.message}</span>
                  </div>
               </div>
            ))}
         </div>
      </div>
   );
};

// 6. Voice Node (FIXED STYLING)
const VoiceNode = ({ active }: { active: boolean }) => (
  <div className="bg-[#09090b] border border-white/5 p-4 rounded-xl flex items-center justify-between overflow-hidden relative group w-full mb-6 z-0">
     {/* Active Pulse Background */}
     {active && (
        <div className="absolute inset-0 bg-emerald-500/10 z-0 pointer-events-none">
           <div className="absolute inset-0 animate-pulse bg-emerald-500/5"></div>
        </div>
     )}
     
     <div className="relative z-10 flex items-center gap-4">
        <div className={`w-10 h-10 rounded-full flex items-center justify-center border transition-all duration-300 ${active ? 'bg-emerald-500 text-black border-emerald-400 scale-110 shadow-[0_0_15px_rgba(16,185,129,0.5)]' : 'bg-zinc-800 text-zinc-500 border-white/5'}`}>
           {active ? <PhoneIncoming className="w-5 h-5 animate-bounce" /> : <Mic className="w-5 h-5" />}
        </div>
        <div>
           <h4 className="text-sm font-medium text-white tracking-wide">Neural Voice</h4>
           <p className="text-[10px] text-zinc-500 font-mono uppercase tracking-wider mt-0.5">
              {active ? <span className="text-emerald-400 animate-pulse font-bold">Incoming Call...</span> : 'Standby Mode'}
           </p>
        </div>
     </div>

     {/* Visualizer */}
     <div className="flex gap-1 items-end h-6 relative z-10">
        {[1,2,3,4,5].map((i) => (
           <div 
             key={i} 
             className={`w-1 rounded-full transition-all duration-300 ${active ? 'bg-emerald-400 animate-[wave_1s_ease-in-out_infinite]' : 'h-1 bg-zinc-800'}`} 
             style={{ 
               height: active ? `${Math.random() * 20 + 5}px` : '4px', 
               animationDelay: `${i * 0.1}s` 
             }} 
           />
        ))}
     </div>
  </div>
);

// --- MAIN PAGE ---
export default function DemoPage() {
  const [booted, setBooted] = useState(false);
  const [bays, setBays] = useState<any[]>(INITIAL_BAYS);
  const [logs, setLogs] = useState<Log[]>([{ id: 'init', time: '10:42:00', source: 'SYSTEM', message: 'System Initialized. Monitoring.', type: 'info' }]);
  const [revenue, setRevenue] = useState(2450);

  const simulateFlashFill = () => {
     const now = new Date();
     const time = `${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;
     
     // 1. Voice AI Answers Call
     setLogs(prev => [{ id: Math.random().toString(), time, source: 'VOICE_AI', message: 'Incoming Call: +1 (555) 012-3499', type: 'info' }, ...prev]);

     // 2. Negotiating
     setTimeout(() => {
        setLogs(prev => [{ id: Math.random().toString(), time, source: 'VOICE_AI', message: 'Intent Detected: Booking (2 Players, 8PM)', type: 'info' }, ...prev]);
     }, 1200);

     // 3. Payment Link
     setTimeout(() => {
        setLogs(prev => [{ id: Math.random().toString(), time, source: 'n8n', message: 'Stripe Payment Link sent via SMS', type: 'success' }, ...prev]);
     }, 2500);

     // 4. Close & Update
     setTimeout(() => {
        setLogs(prev => [{ id: Math.random().toString(), time, source: 'STRIPE', message: 'Payment captured: $85.00', type: 'success' }, ...prev]);
        setRevenue(prev => prev + 85);
        setBays(prev => prev.map(bay => bay.id === 3 ? { ...bay, status: 'reserved', currentSession: { customer: 'Voice AI Capture', timeLeft: 'Starts in 10m', value: 85 } } : bay));
     }, 4000);
  };

  if (!booted) return <BootScreen onComplete={() => setBooted(true)} />;

  return (
    <div className="min-h-screen bg-black text-zinc-100 font-sans selection:bg-emerald-500 selection:text-black animate-in fade-in duration-1000">
      
      {/* SIDEBAR */}
      <div className="fixed left-0 top-0 bottom-0 w-16 bg-[#050505] border-r border-white/5 flex flex-col items-center py-6 z-40">
         <div className="w-8 h-8 bg-white text-black flex items-center justify-center font-serif font-bold rounded-sm mb-8">V</div>
         <div className="space-y-6">
            {[Activity, Calendar, Users, DollarSign].map((Icon, i) => (
                <button key={i} className={`p-2 rounded-lg transition-all ${i === 0 ? 'text-emerald-500 bg-emerald-500/10' : 'text-zinc-600 hover:text-white'}`}><Icon className="w-5 h-5" /></button>
            ))}

            {/* NEW: Concierge / Request Feature Button */}
            <div className="my-4 w-8 h-[1px] bg-white/10"></div>
            <button className="p-2 text-amber-500 bg-amber-500/10 rounded-lg group relative">
                <MessageSquarePlus className="w-5 h-5" />
                <span className="absolute left-14 top-1/2 -translate-y-1/2 bg-black border border-white/10 px-2 py-1 text-[10px] text-white opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap rounded">
                   Request Feature
                </span>
            </button>
         </div>
         <div className="mt-auto"><button className="p-2 text-zinc-600 hover:text-white"><Settings className="w-5 h-5" /></button></div>
      </div>

      <div className="pl-16 relative">
         {/* HEADER - Increased Z-Index to prevent overlap */}
         <header className="h-16 border-b border-white/5 bg-[#050505]/80 backdrop-blur-xl flex items-center justify-between px-8 sticky top-0 z-50">
            <div>
               <h1 className="text-lg font-serif text-white tracking-tight">Command Center</h1>
               <p className="text-[10px] text-zinc-500 font-mono uppercase tracking-widest">Venue: Main Street • <span className="text-emerald-500">System Online</span></p>
            </div>
            <div className="flex items-center gap-6">
               <div className="flex items-center gap-2 px-3 py-1.5 bg-zinc-900 border border-white/5 rounded-full">
                  <span className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                  <span className="text-xs font-mono text-zinc-400">Live Feed</span>
               </div>
               <div className="h-8 w-[1px] bg-white/10"></div>
               <div className="w-8 h-8 bg-zinc-800 rounded-full border border-white/10 flex items-center justify-center"><span className="font-mono text-xs">SR</span></div>
            </div>
         </header>

         <main className="p-8 max-w-[1600px] mx-auto z-0 relative">
            
            {/* KPI ROW */}
            <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
               <div className="bg-[#09090b] p-6 rounded-xl border border-white/5">
                  <div className="flex justify-between items-start mb-2"><span className="text-[10px] font-mono uppercase text-zinc-500 tracking-wider">Gross Revenue (24h)</span><DollarSign className="w-4 h-4 text-emerald-500" /></div>
                  <div className="text-3xl font-serif text-white">$<AnimatedNumber value={revenue} /></div>
                  <div className="mt-2 text-[10px] text-emerald-500 font-mono flex items-center gap-1"><Activity className="w-3 h-3" /> +12% vs last Saturday</div>
               </div>
               <div className="bg-[#09090b] p-6 rounded-xl border border-white/5">
                  <div className="flex justify-between items-start mb-2"><span className="text-[10px] font-mono uppercase text-zinc-500 tracking-wider">Occupancy Rate</span><Users className="w-4 h-4 text-blue-500" /></div>
                  <div className="text-3xl font-serif text-white">82%</div>
                  <div className="mt-2 text-[10px] text-zinc-400 font-mono">4 Bays Active • 2 Reserved</div>
               </div>
               <div className="bg-[#09090b] p-6 rounded-xl border border-white/5">
                  <div className="flex justify-between items-start mb-2"><span className="text-[10px] font-mono uppercase text-zinc-500 tracking-wider">Ghost Revenue</span><Zap className="w-4 h-4 text-amber-500" /></div>
                  <div className="text-3xl font-serif text-white">$420</div>
                  <div className="mt-2 text-[10px] text-amber-500 font-mono">Recovered via Flash-Fill</div>
               </div>
               <div className="bg-gradient-to-br from-emerald-900/20 to-black p-6 rounded-xl border border-emerald-500/20 flex flex-col justify-center items-start relative overflow-hidden group hover:border-emerald-500/40 transition-all cursor-pointer">
                  <div className="absolute top-0 right-0 p-10 bg-emerald-500/10 blur-[50px] rounded-full group-hover:bg-emerald-500/20 transition-all"></div>
                  <h3 className="text-sm font-bold text-white mb-1 relative z-10">Simulate Chaos</h3>
                  <p className="text-[10px] text-zinc-400 mb-4 relative z-10">Trigger a "Voice Agent" event.</p>
                  <button onClick={simulateFlashFill} className="w-full bg-white text-black hover:bg-zinc-200 text-xs font-bold py-2 px-4 rounded transition-colors flex items-center justify-center gap-2 relative z-10">
                     <Zap className="w-3 h-3 text-emerald-600 fill-emerald-600" /> Trigger Event
                  </button>
               </div>
            </div>

            {/* MAIN DASHBOARD GRID */}
            <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 h-[600px]">
               {/* LEFT: VENUE VISUALIZER */}
               <div className="lg:col-span-8 flex flex-col">
                  
                  {/* VOICE NODE - VISUALIZER */}
                  <VoiceNode active={logs.length > 0 && logs[0].source === 'VOICE_AI'} />

                  <div className="flex justify-between items-center mb-6">
                     <h2 className="text-lg font-serif text-white">Venue Status</h2>
                     <div className="flex gap-2">
                        <span className="flex items-center gap-1 text-[10px] text-zinc-500 uppercase"><div className="w-2 h-2 bg-emerald-500 rounded-full"></div> Active</span>
                        <span className="flex items-center gap-1 text-[10px] text-zinc-500 uppercase"><div className="w-2 h-2 bg-zinc-700 rounded-full"></div> Idle</span>
                     </div>
                  </div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                     {bays.map(bay => <BayCard key={bay.id} bay={bay} />)}
                  </div>
                  
                  <div className="bg-[#09090b] border border-white/5 rounded-lg p-4 mt-6">
                     <div className="flex items-center justify-between text-xs text-zinc-400 font-mono">
                        <span className="flex items-center gap-2"><ShieldCheck className="w-3 h-3 text-emerald-500" /> System Encrypted</span>
                        <span className="flex items-center gap-2"><Wifi className="w-3 h-3 text-emerald-500" /> Latency: 24ms</span>
                     </div>
                  </div>
               </div>

               {/* RIGHT: INTELLIGENCE FEED */}
               <div className="lg:col-span-4 bg-[#050505] border border-white/10 rounded-xl overflow-hidden flex flex-col">
                  <LogStream logs={logs} />
                  <div className="p-3 border-t border-white/5 bg-[#09090b]">
                     <div className="flex items-center gap-2 bg-black border border-white/10 rounded px-3 py-2">
                        <ChevronRight className="w-3 h-3 text-zinc-500" />
                        <input type="text" disabled placeholder="Waiting for n8n webhook..." className="bg-transparent border-none outline-none text-xs text-zinc-500 w-full font-mono cursor-not-allowed" />
                     </div>
                  </div>
               </div>
            </div>
         </main>
      </div>
    </div>
  );
}
</file>

<file path="app/(marketing)/page.tsx">
'use client';

import React, { useState, useEffect, useRef } from 'react';
import Link from 'next/link';
import { motion, useScroll, useTransform, useSpring } from 'framer-motion';
import { 
  ArrowRight, Zap, Shield, CheckCircle2, XCircle, Terminal, 
  BarChart3, Mic, Server, Lock, Globe, Cpu, ChevronRight, Play,
  Code2, PenTool, MessageSquarePlus, Hammer
} from 'lucide-react';

// --- VISUALS ---

const MouseSpotlight = () => {
  const [mousePosition, setMousePosition] = useState({ x: 0, y: 0 });
  useEffect(() => {
    const updateMousePosition = (ev: MouseEvent) => {
      setMousePosition({ x: ev.clientX, y: ev.clientY });
    };
    window.addEventListener('mousemove', updateMousePosition);
    return () => window.removeEventListener('mousemove', updateMousePosition);
  }, []);

  return (
    <div 
      className="fixed inset-0 pointer-events-none z-0 transition-opacity duration-500"
      style={{
        background: `radial-gradient(600px circle at ${mousePosition.x}px ${mousePosition.y}px, rgba(16,185,129,0.06), transparent 40%)`
      }}
    />
  );
};

const CodeTerminal = () => {
  const logs = [
    "Initializing VenueOS Kernel...",
    "Connecting to Stripe Connect (Standard)...",
    "Loading Neural Voice Models (OpenAI Whisper)...",
    "Syncing with Trackman API...",
    "Yield Engine: ACTIVE",
    "Listening for inbound calls..."
  ];
  return (
    <div className="w-full max-w-lg mx-auto bg-[#0A0A0A] border border-white/10 rounded-lg overflow-hidden shadow-2xl font-mono text-[10px] md:text-xs relative group">
       <div className="bg-[#111] px-4 py-2 flex gap-2 border-b border-white/5">
          <div className="w-2.5 h-2.5 rounded-full bg-red-500/50" />
          <div className="w-2.5 h-2.5 rounded-full bg-yellow-500/50" />
          <div className="w-2.5 h-2.5 rounded-full bg-green-500/50" />
          <div className="ml-auto text-zinc-600">bash — v2.4</div>
       </div>
       <div className="p-4 h-48 flex flex-col justify-end text-zinc-400 space-y-1">
          {logs.map((log, i) => (
             <motion.div 
               key={i}
               initial={{ opacity: 0, x: -10 }}
               animate={{ opacity: 1, x: 0 }}
               transition={{ delay: i * 0.8 }}
             >
                <span className="text-emerald-500 mr-2">➜</span>
                {log}
             </motion.div>
          ))}
          <div className="text-zinc-600 animate-pulse mt-2">awaiting_input...</div>
       </div>
       <div className="absolute inset-0 pointer-events-none bg-gradient-to-t from-emerald-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500" />
    </div>
  );
};

const FeatureCard = ({ title, desc, icon, delay, highlight = false }: any) => (
  <motion.div 
    initial={{ opacity: 0, y: 20 }}
    whileInView={{ opacity: 1, y: 0 }}
    viewport={{ once: true }}
    transition={{ delay, duration: 0.5 }}
    className={`group relative p-8 rounded-2xl border transition-all duration-500 overflow-hidden ${highlight ? 'bg-emerald-950/10 border-emerald-500/30' : 'bg-zinc-900/40 border-white/5 hover:border-emerald-500/30'}`}
  >
    {highlight && <div className="absolute inset-0 bg-emerald-500/5 animate-pulse" />}
    <div className="absolute inset-0 bg-gradient-to-br from-emerald-500/5 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500" />
    <div className="relative z-10">
      <div className={`w-12 h-12 rounded-lg border flex items-center justify-center mb-6 transition-transform duration-500 group-hover:scale-110 ${highlight ? 'bg-emerald-900/20 border-emerald-500/20 text-emerald-400' : 'bg-zinc-900 border-white/10 text-emerald-500'}`}>
        {icon}
      </div>
      <h3 className="text-xl font-serif text-zinc-100 mb-3">{title}</h3>
      <p className="text-sm text-zinc-400 leading-relaxed">{desc}</p>
    </div>
  </motion.div>
);

const ComparisonSlider = () => {
  const [sliderVal, setSliderVal] = useState(50);
  return (
    <div className="relative w-full max-w-5xl mx-auto h-[500px] rounded-2xl overflow-hidden border border-white/10 shadow-2xl group">
      {/* LEFT: HELL */}
      <div className="absolute inset-0 bg-[#050000] flex items-center justify-center border-r border-white/5">
          <div className="text-center opacity-40 grayscale group-hover:grayscale-0 transition-all duration-700">
             <XCircle className="w-20 h-20 text-red-900 mx-auto mb-6" />
             <h3 className="text-red-900 font-serif text-5xl mb-2">VOID</h3>
             <p className="text-red-900/50 font-mono tracking-widest">$0.00 REVENUE</p>
          </div>
          <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-20"></div>
      </div>
      
      {/* RIGHT: HEAVEN (Clipped) */}
      <div 
         className="absolute inset-0 bg-[#000502] flex items-center justify-center overflow-hidden"
         style={{ clipPath: `inset(0 0 0 ${sliderVal}%)` }}
      >
          <div className="text-center w-full max-w-5xl mx-auto px-10">
             <CheckCircle2 className="w-20 h-20 text-emerald-500 mx-auto mb-6 drop-shadow-[0_0_15px_rgba(16,185,129,0.5)]" />
             <h3 className="text-white font-serif text-5xl mb-2 drop-shadow-xl">CAPTURED</h3>
             <p className="text-emerald-500 font-mono tracking-widest">$240.00 RECOVERED</p>
             <div className="mt-8 inline-flex items-center gap-2 px-3 py-1 bg-emerald-900/30 border border-emerald-500/30 rounded text-[10px] text-emerald-400 font-mono uppercase">
                <Terminal className="w-3 h-3" />
                <span>Protocol: Flash-Fill Executed</span>
             </div>
          </div>
          <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-20"></div>
      </div>

      {/* HANDLE */}
      <div className="absolute top-0 bottom-0 w-1 bg-white cursor-ew-resize z-20 flex items-center justify-center shadow-[0_0_30px_rgba(255,255,255,0.8)]" style={{ left: `${sliderVal}%` }}>
         <div className="w-12 h-12 bg-black border border-white rounded-full flex items-center justify-center">
            <div className="flex gap-1">
               <div className="w-0.5 h-4 bg-white" />
               <div className="w-0.5 h-4 bg-white" />
            </div>
         </div>
      </div>
      <input type="range" min="0" max="100" value={sliderVal} onChange={(e) => setSliderVal(parseInt(e.target.value))} className="absolute inset-0 w-full h-full opacity-0 cursor-ew-resize z-30" />
    </div>
  );
};

// --- SECTIONS ---

const HeroSection = () => {
  const { scrollY } = useScroll();
  const y1 = useTransform(scrollY, [0, 500], [0, 100]);

  return (
    <section className="relative min-h-[90vh] flex flex-col items-center justify-center pt-32 px-6 overflow-hidden">
      {/* Background Grid */}
      <div className="absolute inset-0 bg-grid-white opacity-[0.03] pointer-events-none" />
      
      <div className="relative z-10 text-center max-w-5xl mx-auto">
        {/* Status Chip */}
        <motion.div 
           initial={{ opacity: 0, y: -20 }} 
           animate={{ opacity: 1, y: 0 }} 
           transition={{ duration: 0.8 }}
           className="inline-flex items-center gap-3 px-4 py-1.5 rounded-full bg-zinc-900/50 border border-white/10 mb-10 backdrop-blur-md"
        >
           <span className="flex h-2 w-2 relative">
             <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
             <span className="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
           </span>
           <span className="text-[10px] font-mono uppercase tracking-widest text-zinc-300">
             Systems Nominal <span className="text-emerald-600 px-2">|</span> <span className="text-white">Accepting 2 Bespoke Partners</span>
           </span>
        </motion.div>

        {/* Headline */}
        <motion.h1 
          initial={{ opacity: 0, scale: 0.95 }}
          animate={{ opacity: 1, scale: 1 }}
          transition={{ duration: 1, delay: 0.2 }}
          className="text-6xl md:text-9xl font-serif text-white tracking-tighter leading-[0.9] mb-8 drop-shadow-2xl"
        >
          Revenue <br />
          <span className="text-transparent bg-clip-text bg-gradient-to-b from-emerald-400 to-emerald-900">Infrastructure.</span>
        </motion.h1>

        <motion.p 
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ duration: 1, delay: 0.4 }}
          className="text-xl md:text-2xl text-zinc-400 max-w-2xl mx-auto font-light leading-relaxed mb-12"
        >
          The operating system that replaces your General Manager.
          <br/>
          <span className="text-white border-b border-emerald-500/30 pb-1">Automate deposits, voice calls, and waitlists.</span>
        </motion.p>

        {/* CTA & Terminal */}
        <motion.div 
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8, delay: 0.6 }}
          className="flex flex-col items-center gap-12"
        >
          <div className="flex flex-col sm:flex-row gap-5 w-full justify-center">
             <Link href="/demo" className="group relative h-14 px-8 bg-white text-black font-mono text-xs uppercase tracking-widest font-bold flex items-center justify-center gap-3 overflow-hidden rounded-sm transition-all hover:bg-emerald-400">
                <div className="absolute inset-0 w-full h-full bg-emerald-400 translate-y-full group-hover:translate-y-0 transition-transform duration-300 ease-out" />
                <span className="relative z-10 flex items-center gap-2">Deploy System <ArrowRight className="w-4 h-4" /></span>
             </Link>
             <button className="h-14 px-8 bg-zinc-900 border border-zinc-800 hover:border-white/20 text-zinc-300 font-mono text-xs uppercase tracking-widest font-bold transition-all rounded-sm flex items-center justify-center gap-2 group">
                <Play className="w-3 h-3 group-hover:text-emerald-500 transition-colors" /> Watch Demo
             </button>
          </div>

          {/* Floating Terminal Code Block */}
          <div className="relative w-full max-w-2xl">
             <div className="absolute -inset-1 bg-gradient-to-r from-emerald-500 to-blue-500 rounded-lg blur opacity-20 animate-pulse"></div>
             <CodeTerminal />
          </div>
        </motion.div>
      </div>
    </section>
  );
};

// --- NEW "BESPOKE" SECTION ---
const BespokeFoundry = () => {
   return (
      <section className="py-32 px-6 bg-[#030303] border-t border-white/5 relative overflow-hidden">
         {/* Background accent */}
         <div className="absolute top-0 right-0 w-[600px] h-[600px] bg-emerald-900/10 rounded-full blur-[100px] pointer-events-none"></div>

         <div className="max-w-7xl mx-auto grid lg:grid-cols-2 gap-20 items-center relative z-10">
            <div>
               <div className="inline-flex items-center gap-2 px-3 py-1 bg-white/5 border border-white/10 rounded-full text-[10px] font-mono uppercase text-emerald-400 mb-6">
                  <Hammer className="w-3 h-3" /> The Foundry Initiative
               </div>
               <h2 className="text-4xl md:text-6xl font-serif text-white mb-6">
                  Unlimited <br/> Engineering.
               </h2>
               <p className="text-lg text-zinc-400 mb-8 leading-relaxed">
                  Other software forces you to adapt to <i>their</i> workflow. <br/>
                  <strong>We code the software around yours.</strong>
               </p>
               <ul className="space-y-6 mb-10">
                  <li className="flex gap-4">
                     <div className="w-10 h-10 rounded bg-zinc-900 border border-white/10 flex items-center justify-center shrink-0">
                        <PenTool className="w-5 h-5 text-white" />
                     </div>
                     <div>
                        <h4 className="text-white font-bold mb-1">Bespoke UI Design</h4>
                        <p className="text-sm text-zinc-500">Don't like our dashboard? We will redesign it to match your brand's specific aesthetic perfectly.</p>
                     </div>
                  </li>
                  <li className="flex gap-4">
                     <div className="w-10 h-10 rounded bg-zinc-900 border border-white/10 flex items-center justify-center shrink-0">
                        <Code2 className="w-5 h-5 text-emerald-500" />
                     </div>
                     <div>
                        <h4 className="text-white font-bold mb-1">Custom Integrations</h4>
                        <p className="text-sm text-zinc-500">Need to sync with a legacy POS or a specific camera system? We write the API connectors for you.</p>
                     </div>
                  </li>
               </ul>
               <button className="text-emerald-500 border-b border-emerald-500/30 pb-1 hover:text-emerald-400 hover:border-emerald-400 transition-all font-mono text-xs uppercase tracking-widest">
                 //View Engineering Retainer Docs 
               </button>
            </div>

            {/* Visual: Request -> Code */}
            <div className="relative">
               <div className="absolute -inset-1 bg-gradient-to-br from-zinc-800 to-zinc-900 rounded-2xl blur opacity-50"></div>
               <div className="bg-[#0A0A0A] border border-white/10 rounded-2xl p-8 relative overflow-hidden">
                  {/* Message 1 */}
                  <div className="flex justify-end mb-6">
                     <div className="bg-emerald-600/20 border border-emerald-500/20 text-emerald-100 px-4 py-3 rounded-2xl rounded-tr-sm text-sm max-w-sm">
                        "We need a custom leaderboard that tracks 'Longest Drive' from Trackman and displays it on the lobby TV."
                     </div>
                  </div>
                  {/* Message 2 (System) */}
                  <div className="flex justify-start mb-6">
                     <div className="bg-zinc-800 border border-white/5 text-zinc-300 px-4 py-3 rounded-2xl rounded-tl-sm text-sm flex items-center gap-3">
                        <div className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
                        <span>Engineering Team notified. Ticket #492 created.</span>
                     </div>
                  </div>
                  {/* Code Block */}
                  <div className="bg-black rounded-lg border border-white/10 p-4 font-mono text-[10px] text-zinc-500 overflow-hidden">
                     <p className="text-purple-400">import</p> <span className="text-white">{`{ TrackmanAPI }`}</span> <span className="text-purple-400">from</span> <span className="text-green-400">'@venue/sdk'</span>;
                     <br/><br/>
                     <span className="text-blue-400">const</span> <span className="text-yellow-200">LeaderboardWidget</span> = <span className="text-white">async () ={`>`}</span> {'{'}
                     <br/>
                     &nbsp;&nbsp;<span className="text-blue-400">const</span> data = <span className="text-purple-400">await</span> TrackmanAPI.getMetrics('drive_distance');
                     <br/>
                     &nbsp;&nbsp;<span className="text-purple-400">return</span> <span className="text-white">{`<LobbyDisplay data={data} />`}</span>
                     <br/>
                     {'}'}
                  </div>
                  {/* Overlay */}
                  <div className="absolute bottom-6 right-8">
                      <div className="px-3 py-1 bg-emerald-500 text-black text-[10px] font-bold font-mono uppercase tracking-widest rounded-full shadow-[0_0_20px_rgba(16,185,129,0.4)]">
                         Deployed: 48 Hours
                      </div>
                  </div>
               </div>
            </div>
         </div>
      </section>
   );
};

const IntegrationsTicker = () => (
   <div className="w-full bg-black border-y border-white/10 py-8 overflow-hidden relative z-20">
      <div className="max-w-7xl mx-auto px-6 mb-4 flex justify-center">
         <span className="text-[10px] font-mono text-zinc-500 uppercase tracking-[0.2em]">Deep Integration Ecosystem</span>
      </div>
      <div className="relative flex overflow-x-hidden group">
         <div className="animate-marquee whitespace-nowrap flex gap-16 items-center opacity-50 grayscale group-hover:grayscale-0 transition-all duration-700">
            {/* Mock Logos - In real app use SVGs */}
            <span className="text-xl font-bold font-serif text-white">STRIPE <span className="text-[10px] font-mono font-normal text-zinc-500">CONNECT</span></span>
            <span className="text-xl font-bold font-serif text-white">TRACKMAN <span className="text-[10px] font-mono font-normal text-zinc-500">API</span></span>
            <span className="text-xl font-bold font-serif text-white">OPENAI <span className="text-[10px] font-mono font-normal text-zinc-500">WHISPER</span></span>
            <span className="text-xl font-bold font-serif text-white">TWILIO <span className="text-[10px] font-mono font-normal text-zinc-500">MESSAGING</span></span>
            <span className="text-xl font-bold font-serif text-white">UNEEKOR <span className="text-[10px] font-mono font-normal text-zinc-500">SDK</span></span>
            {/* Duplicate for infinite scroll */}
            <span className="text-xl font-bold font-serif text-white">STRIPE <span className="text-[10px] font-mono font-normal text-zinc-500">CONNECT</span></span>
            <span className="text-xl font-bold font-serif text-white">TRACKMAN <span className="text-[10px] font-mono font-normal text-zinc-500">API</span></span>
            <span className="text-xl font-bold font-serif text-white">OPENAI <span className="text-[10px] font-mono font-normal text-zinc-500">WHISPER</span></span>
         </div>
      </div>
   </div>
);

// --- MAIN PAGE COMPONENT ---

export default function LandingPage() {
  return (
    <main className="min-h-screen bg-[#020202] text-zinc-100 font-sans selection:bg-emerald-500/30 overflow-x-hidden">
      <div className="noise-bg fixed inset-0 z-50 pointer-events-none opacity-[0.03]"></div>
      <MouseSpotlight />
      
      {/* NAVBAR */}
      <nav className="fixed w-full z-40 top-0 border-b border-white/5 bg-[#020202]/80 backdrop-blur-md">
        <div className="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
           <div className="flex items-center gap-2">
              <div className="w-8 h-8 bg-zinc-100 text-black flex items-center justify-center font-serif font-bold rounded-sm">V</div>
              <span className="font-serif text-lg tracking-tight text-white">Venue Engine</span>
           </div>
           <Link href="/demo" className="flex items-center gap-2 px-4 py-2 bg-zinc-900 hover:bg-zinc-800 border border-white/10 rounded-sm transition-all text-[10px] font-bold font-mono uppercase tracking-widest group">
              <div className="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse" />
              Client Portal
              <ChevronRight className="w-3 h-3 group-hover:translate-x-1 transition-transform" />
           </Link>
        </div>
      </nav>

      <HeroSection />
      
      <IntegrationsTicker />

      {/* THE PROBLEM */}
      <section className="py-32 px-6 relative border-b border-white/5 bg-[#050505]">
         <div className="max-w-5xl mx-auto mb-16 text-center">
            <div className="inline-block mb-4 px-3 py-1 border border-red-500/20 bg-red-900/10 rounded-full text-[10px] font-mono text-red-400 uppercase tracking-widest">
               Financial Alert
            </div>
            <h2 className="text-3xl md:text-5xl font-serif mb-6 text-white">The "Empty Bay" Hemorrhage.</h2>
            <p className="text-zinc-400 font-mono text-xs uppercase tracking-widest max-w-lg mx-auto leading-loose">
               You are losing $150/hr every time a customer "forgets" to show up. <br/>
               Drag the slider to enable the Venue Engine protocols.
            </p>
         </div>
         <ComparisonSlider />
      </section>

      {/* THE SOLUTION (BENTO) */}
      <section className="py-32 px-6 relative z-10">
         <div className="max-w-7xl mx-auto">
            <div className="flex flex-col md:flex-row justify-between items-end mb-20 gap-8">
               <div>
                  <h2 className="text-4xl md:text-6xl font-serif text-white mb-4">The Revenue Core</h2>
                  <p className="text-zinc-500 font-mono text-xs uppercase tracking-widest">Four Engines. Zero Leakage.</p>
               </div>
               <div className="flex gap-4">
                  <div className="text-right">
                     <div className="text-2xl font-mono text-emerald-400">99.9%</div>
                     <div className="text-[10px] text-zinc-600 uppercase tracking-widest">Uptime</div>
                  </div>
                  <div className="w-[1px] h-10 bg-white/10"></div>
                  <div className="text-right">
                     <div className="text-2xl font-mono text-white">24ms</div>
                     <div className="text-[10px] text-zinc-600 uppercase tracking-widest">Latency</div>
                  </div>
               </div>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-12 gap-6">
               {/* LARGE CARD: VOICE */}
               <div className="md:col-span-8">
                  <FeatureCard 
                     highlight={true}
                     delay={0.1}
                     icon={<Mic className="w-6 h-6" />}
                     title="Neural Voice Agent"
                     desc="A 24/7 AI Receptionist that negotiates times, answers FAQs about club specs, and texts Stripe payment links instantly. It handles 10,000 simultaneous calls."
                  />
               </div>
               
               {/* SMALL CARD: YIELD */}
               <div className="md:col-span-4">
                  <FeatureCard 
                     delay={0.2}
                     icon={<BarChart3 className="w-6 h-6" />}
                     title="Yield Engine"
                     desc="Raining? The system increases ad spend for 'Indoor Golf'. Efficiency is automated."
                  />
               </div>

               {/* SMALL CARD: GHOST */}
               <div className="md:col-span-4">
                  <FeatureCard 
                     delay={0.3}
                     icon={<Shield className="w-6 h-6" />}
                     title="Ghost Protocol"
                     desc="No deposit? No booking. We auto-cancel unpaid slots after 15 minutes."
                  />
               </div>

               {/* LARGE CARD: FLASH FILL */}
               <div className="md:col-span-8">
                  <FeatureCard 
                     delay={0.4}
                     icon={<Zap className="w-6 h-6" />}
                     title="Flash-Fill Protocol"
                     desc="When a slot opens, our n8n engine filters your waitlist by 'LTV' and texts a booking link. Slots refill in < 3 minutes."
                  />
               </div>
            </div>
         </div>
      </section>

      {/* NEW: BESPOKE ENGINEERING SECTION */}
      <BespokeFoundry />

      {/* FOUNDER'S GUARANTEE (Black Card) */}
      <section className="py-40 px-6 relative overflow-hidden bg-black">
         <div className="absolute top-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-emerald-900 to-transparent"></div>
         <div className="max-w-4xl mx-auto relative z-10 text-center">
             <div className="inline-block border border-zinc-800 bg-zinc-900/50 backdrop-blur px-4 py-1 rounded-full text-[10px] font-mono uppercase text-zinc-400 mb-8">
                The Architect's Promise
             </div>
             <h2 className="text-5xl md:text-7xl font-serif text-white mb-8 tracking-tighter">
                We don't sell software. <br/> <span className="text-zinc-600">We sell revenue.</span>
             </h2>
             <p className="text-lg text-zinc-400 mb-12 max-w-xl mx-auto font-light leading-relaxed">
                If Venue Engine does not recover its own monthly cost in captured "Ghost Revenue" within 30 days, I will refund your implementation fee in full.
             </p>
             <div className="flex flex-col items-center gap-6">
                <Link href="/demo" className="h-16 px-12 bg-white text-black hover:bg-zinc-200 font-mono text-sm uppercase tracking-widest font-bold transition-all flex items-center gap-3 rounded-sm shadow-[0_0_50px_rgba(255,255,255,0.2)]">
                   Initiate Audit
                   <ArrowRight className="w-4 h-4" />
                </Link>
                <div className="flex items-center gap-4 opacity-50">
                    <Globe className="w-4 h-4 text-zinc-600" />
                    <Server className="w-4 h-4 text-zinc-600" />
                    <Cpu className="w-4 h-4 text-zinc-600" />
                    <Lock className="w-4 h-4 text-zinc-600" />
                </div>
             </div>
         </div>
      </section>

      <footer className="py-12 border-t border-white/5 bg-black text-center relative z-10">
         <p className="text-[10px] text-zinc-600 font-mono uppercase tracking-widest">
            © 2025 Venue Engine • Johannesburg • New York
         </p>
      </footer>
    </main>
  );
}
</file>

<file path="app/admin/page.tsx">
"use client"

import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { TrendingUp, Users, DollarSign, Activity, Calendar, ArrowUpRight } from "lucide-react"
import { Area, AreaChart, ResponsiveContainer, Tooltip, XAxis, YAxis } from "recharts"
import { venueConfig } from "@/lib/venue-config" // Import Config

// FAKE DATA
const data = [
  { name: "Mon", total: 1200 },
  { name: "Tue", total: 1850 },
  { name: "Wed", total: 1600 },
  { name: "Thu", total: 2100 },
  { name: "Fri", total: 2850 },
  { name: "Sat", total: 3200 },
  { name: "Sun", total: 2600 },
]

export default function AdminDashboard() {
  return (
    <div className="min-h-screen bg-transparent p-6 md:p-8">
      {/* HEADER */}
      <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-4">
        <div>
          <h1 className="text-3xl font-bold text-white tracking-tight font-serif">Command Center</h1>
          <p className="text-gray-400 text-sm">Real-time Revenue Operations</p>
        </div>
        <div className="flex items-center gap-3">
            <div className="flex items-center gap-2 px-3 py-1 rounded-full bg-green-900/20 border border-green-900/50">
                <span className="relative flex h-2 w-2">
                  <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-500 opacity-75"></span>
                  <span className="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                </span>
                <span className="text-xs font-mono text-green-500">SYSTEM ONLINE</span>
            </div>
        </div>
      </div>

      {/* KPI GRID */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        {[
            // Dynamically using venueConfig.currency here
            { label: "Total Revenue", val: `${venueConfig.currency} 18,420`, icon: DollarSign, trend: "+14%", color: "text-primary" },
            { label: "Slot Utilization", val: "87.4%", icon: Activity, trend: "28 slots left", color: "text-blue-400" },
            { label: "Active Bookings", val: "142", icon: Calendar, trend: "+32 this week", color: "text-purple-400" },
            { label: "LTV / Customer", val: `${venueConfig.currency} 345`, icon: Users, trend: "Lifetime Value", color: "text-orange-400" }
        ].map((item, i) => (
            <Card key={i} className="border-white/5 bg-white/5 backdrop-blur-md">
                <CardContent className="p-6">
                    <div className="flex justify-between items-start">
                        <div>
                            <p className="text-xs text-gray-500 uppercase tracking-widest font-semibold">{item.label}</p>
                            <h3 className="text-2xl font-bold text-white mt-2 font-mono">{item.val}</h3>
                        </div>
                        <div className={`p-2 rounded-lg bg-white/5 ${item.color}`}>
                            <item.icon className="w-5 h-5" />
                        </div>
                    </div>
                    <div className="mt-4 flex items-center text-xs text-gray-400">
                        {item.label === "Total Revenue" && <ArrowUpRight className="w-3 h-3 mr-1 text-green-500" />}
                        <span className={item.label === "Total Revenue" ? "text-green-500" : ""}>{item.trend}</span>
                    </div>
                </CardContent>
            </Card>
        ))}
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        {/* REVENUE CHART */}
        <Card className="lg:col-span-2 border-white/5 bg-white/5 backdrop-blur-md">
            <CardHeader>
                <CardTitle className="text-sm font-medium text-gray-400 uppercase tracking-wider">Weekly Performance</CardTitle>
            </CardHeader>
            <CardContent className="pl-0">
                <div className="h-[300px] w-full">
                    <ResponsiveContainer width="100%" height="100%">
                        <AreaChart data={data}>
                            <defs>
                                <linearGradient id="colorTotal" x1="0" y1="0" x2="0" y2="1">
                                    <stop offset="5%" stopColor="#10b981" stopOpacity={0.3}/>
                                    <stop offset="95%" stopColor="#10b981" stopOpacity={0}/>
                                </linearGradient>
                            </defs>
                            <XAxis 
                                dataKey="name" 
                                stroke="#525252" 
                                fontSize={12} 
                                tickLine={false} 
                                axisLine={false} 
                            />
                            <YAxis 
                                stroke="#525252" 
                                fontSize={12} 
                                tickLine={false} 
                                axisLine={false} 
                                tickFormatter={(value) => `${venueConfig.currency}${value/1000}k`} 
                            />
                            <Tooltip 
                                contentStyle={{ backgroundColor: '#171717', border: '1px solid #333', borderRadius: '8px' }}
                                itemStyle={{ color: '#fff' }}
                            />
                            <Area 
                                type="monotone" 
                                dataKey="total" 
                                stroke="#10b981" 
                                strokeWidth={2} 
                                fillOpacity={1} 
                                fill="url(#colorTotal)" 
                            />
                        </AreaChart>
                    </ResponsiveContainer>
                </div>
            </CardContent>
        </Card>

        {/* LIVE FEED */}
        <Card className="border-white/5 bg-white/5 backdrop-blur-md">
            <CardHeader>
                <CardTitle className="text-sm font-medium text-gray-400 uppercase tracking-wider">Real-Time Feed</CardTitle>
            </CardHeader>
            <CardContent>
                <div className="space-y-6">
                    {[
                        { text: "New Booking: 4-Ball", sub: `${venueConfig.currency}50 Deposit Paid`, time: "2m ago", color: "bg-green-500" },
                        { text: "Reminder Sent", sub: "John Doe (Tomorrow 09:00)", time: "5m ago", color: "bg-blue-500" },
                        { text: "Rainy Day Protocol", sub: "Auto-Filled Slot: 16:00", time: "12m ago", color: "bg-purple-500" },
                        { text: "Payment Verified", sub: "Sarah Smith", time: "15m ago", color: "bg-green-500" },
                        { text: "New Review", sub: "5 Stars on Google", time: "32m ago", color: "bg-yellow-500" },
                    ].map((item, i) => (
                        <div key={i} className="flex gap-4">
                            <div className="relative mt-1">
                                <div className={`h-2 w-2 rounded-full ${item.color} shadow-[0_0_10px_currentColor]`} />
                                <div className="absolute top-3 left-1 w-[1px] h-8 bg-white/10" />
                            </div>
                            <div>
                                <p className="text-sm font-medium text-white">{item.text}</p>
                                <p className="text-xs text-gray-500">{item.sub}</p>
                            </div>
                            <span className="ml-auto text-xs text-gray-600 font-mono">{item.time}</span>
                        </div>
                    ))}
                </div>
            </CardContent>
        </Card>
      </div>
    </div>
  )
}
</file>

<file path="app/api/bays/status/route.ts">
import { createClient } from "@supabase/supabase-js"
import { NextResponse } from "next/server"

// 1. Force Edge Runtime & DISABLE CACHE
export const runtime = "edge"
export const dynamic = "force-dynamic" // <--- CRITICAL FIX for Admin visibility

export async function GET() {
  try {
    // Initialize Supabase
    // Ideally use process.env.SUPABASE_SERVICE_ROLE_KEY if available for Admin bypass
    // Otherwise ensure your Public/Anon key has SELECT permissions on 'bookings'
    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!
    const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
    
    const supabase = createClient(supabaseUrl, supabaseKey)

    // 2. Fetch TODAY'S active bookings
    // We fetch a slightly wider window to filter in JS for precision
    const now = new Date()
    const startOfDay = new Date(now).setHours(0,0,0,0)
    const endOfDay = new Date(now).setHours(23,59,59,999)

    const { data: activeBookings, error } = await supabase
      .from("bookings")
      .select("simulator_id, slot_start, slot_end, status")
      // Check Confirmed OR Pending (if someone is paying right now, mark it occupied)
      .neq("status", "cancelled") 
      .gte("slot_end", new Date(startOfDay).toISOString()) // Optimization
      .lte("slot_start", new Date(endOfDay).toISOString())

    if (error) {
      console.error("Supabase Error:", error)
      return NextResponse.json({ error: error.message }, { status: 500 })
    }

    // 3. Precise JS Time Comparison (Timezone Safe)
    const nowMs = now.getTime()
    
    // Filter: Booking must be effectively "Live" right now
    const currentLiveBookings = activeBookings?.filter(b => {
      const startMs = new Date(b.slot_start).getTime()
      const endMs = new Date(b.slot_end).getTime()
      // It is live if: Start is in past AND End is in future
      return startMs <= nowMs && endMs > nowMs
    }) || []

    // 4. Map IDs
    const occupiedIds = currentLiveBookings.map((b) => b.simulator_id)

    const bays = [1, 2, 3].map((id) => ({
      id,
      status: occupiedIds.includes(id) ? "occupied" : "available",
      label: `Simulator ${id}`
    }))

    const availableCount = bays.filter((b) => b.status === "available").length

    return NextResponse.json(
      { 
        bays, 
        availableCount,
        serverTime: now.toISOString()
      }, 
      {
        headers: {
          "Cache-Control": "no-store, no-cache, must-revalidate",
        }
      }
    )

  } catch (error) {
    console.error("Internal Error:", error)
    return NextResponse.json({ error: "Internal Server Error" }, { status: 500 })
  }
}
</file>

<file path="app/api/bookings/availability/route.ts">
import { type NextRequest, NextResponse } from "next/server"
import { createClient } from "@/lib/supabase/server"

export const runtime = "edge"

export async function GET(request: NextRequest) {
  const { searchParams } = new URL(request.url)
  const date = searchParams.get("date")

  if (!date) {
    return NextResponse.json({ error: "Date is required" }, { status: 400 })
  }

  const supabase = await createClient()

  // 1. Fetch ALL bookings (We need created_at to filter stale ones)
  const { data: bookings, error } = await supabase
    .from("bookings")
    .select("slot_start, slot_end, status, created_at") // <--- Added created_at
    .eq("booking_date", date)
    .neq("status", "cancelled")

  if (error) {
    return NextResponse.json({ error: error.message }, { status: 500 })
  }

  // 2. Define operating hours
  const slots: string[] = []
  for (let h = 9; h < 20; h++) {
    slots.push(`${h.toString().padStart(2, "0")}:00`)
    slots.push(`${h.toString().padStart(2, "0")}:30`)
  }

  // 3. Filter "Ghost" Bookings
  // A booking is valid if it is CONFIRMED OR if it is PENDING but created < 20 mins ago
  const now = Date.now();
  const validBookings = bookings.filter(b => {
    if (b.status === 'confirmed') return true;
    if (b.status === 'paid_instore') return true; // (For coupons)
    if (b.status === 'pending') {
       const createdTime = new Date(b.created_at).getTime();
       // Keep it if it's less than 20 minutes old (1200000 ms)
       return (now - createdTime) < 1200000; 
    }
    return false; // Pending and old? Ignore it.
  });

  // 4. Calculate Availability
  const bookedSlots: string[] = []
  
  // Helper for SAST Date
  const getSlotTimeDate = (dateStr: string, timeStr: string) => {
    return new Date(`${dateStr}T${timeStr}:00+02:00`); 
  }

  slots.forEach((time) => {
    const slotStart = getSlotTimeDate(date, time).getTime();
    const slotEnd = slotStart + (30 * 60 * 1000); 

    // Count VALID bookings in this slot
    const activeCount = validBookings.filter((b) => {
      const bStart = new Date(b.slot_start).getTime();
      const bEnd = new Date(b.slot_end).getTime();
      return bStart < slotEnd && bEnd > slotStart;
    }).length;

    // CHECK: Is it 3 or more?
    if (activeCount >= 3) {
      bookedSlots.push(time)
    }
  })

  return NextResponse.json({ bookedSlots })
}
</file>

<file path="app/api/bookings/check-availability/route.ts">
import { createClient } from "@/lib/supabase/server"
import { type NextRequest, NextResponse } from "next/server"

// 1. Force Edge Runtime
export const runtime = 'edge';

// Helper to match the rest of your app's logic
function createSASTTimestamp(dateStr: string, timeStr: string): string {
  const cleanTime = timeStr.length === 5 ? `${timeStr}:00` : timeStr;
  return `${dateStr}T${cleanTime}+02:00`;
}

function addHoursToTimestamp(timestamp: string, hours: number): string {
  const date = new Date(timestamp);
  date.setHours(date.getHours() + hours);
  return date.toISOString(); 
}

export async function POST(request: NextRequest) {
  try {
    const supabase = await createClient()
    const { booking_date, start_time, duration_hours } = await request.json()

    // 1. Calculate Exact ISO Timestamps (Consistency is key!)
    const requestedStartISO = createSASTTimestamp(booking_date, start_time);
    const requestedEndISO = addHoursToTimestamp(requestedStartISO, duration_hours);

    // 2. Fetch Active Bookings for that day
    const { data: bookings, error } = await supabase
      .from("bookings")
      .select("slot_start, slot_end") // Only fetch what we need
      .eq("booking_date", booking_date)
      .neq("status", "cancelled")

    if (error) {
       console.error("Availability Check DB Error:", error);
       return NextResponse.json({ error: "Database check failed" }, { status: 500 });
    }

    // 3. Count Overlaps in JavaScript (Precise & Fast)
    // A booking overlaps if: (StartA < EndB) and (EndA > StartB)
    let overlapCount = 0;
    
    if (bookings) {
      bookings.forEach(b => {
        if (b.slot_start < requestedEndISO && b.slot_end > requestedStartISO) {
          overlapCount++;
        }
      });
    }

    // 4. Compare against Capacity
    const TOTAL_BAYS = 3
    const isAvailable = overlapCount < TOTAL_BAYS

    return NextResponse.json({
      available: isAvailable,
      conflicting_bookings: overlapCount,
      capacity: TOTAL_BAYS
    })

  } catch (error) {
    console.error("Availability Check Server Error:", error)
    return NextResponse.json({ error: "Internal server error" }, { status: 500 })
  }
}
</file>

<file path="app/api/bookings/create/route.ts">
import { type NextRequest, NextResponse } from "next/server"
import { createClient } from "@/lib/supabase/server"

// 1. Force Edge Runtime
export const runtime = "edge"

// --- HELPERS ---
function createSASTTimestamp(dateStr: string, timeStr: string): string {
  const cleanTime = timeStr.length === 5 ? `${timeStr}:00` : timeStr
  return `${dateStr}T${cleanTime}+02:00`
}

function addHoursToTimestamp(timestamp: string, hours: number): string {
  const date = new Date(timestamp)
  date.setHours(date.getHours() + hours)
  return date.toISOString()
}

function calculateEndTimeText(start: string, duration: number): string {
  const [hours, minutes] = start.split(":").map(Number)
  const date = new Date()
  date.setHours(hours, minutes, 0, 0)
  date.setHours(date.getHours() + duration)
  return date.toTimeString().slice(0, 5)
}

export async function POST(request: NextRequest) {
  try {
    const supabase = await createClient()
    const bookingData = await request.json()

    // 1. EXTRACT DATA
    const {
      booking_date,
      start_time,
      duration_hours,
      total_price,
      guest_name,
      guest_email,
      guest_phone,
      payment_status, 
    } = bookingData

    // 2. CALCULATE TIMES
    const slotStartISO = createSASTTimestamp(booking_date, start_time)
    const slotEndISO = addHoursToTimestamp(slotStartISO, duration_hours)
    const endTimeText = calculateEndTimeText(start_time, duration_hours)

    // Convert requested times to Milliseconds for safe comparison
    const reqStartMs = new Date(slotStartISO).getTime()
    const reqEndMs = new Date(slotEndISO).getTime()

    // 3. CHECK AVAILABILITY (MULTI-BAY LOGIC)
    
    // Fetch all active bookings for this day
    const { data: dailyBookings } = await supabase
      .from("bookings")
      .select("simulator_id, slot_start, slot_end")
      .eq("booking_date", booking_date)
      .neq("status", "cancelled")

    // Identify which bays are taken
    const takenBays = new Set<number>()
    
    if (dailyBookings) {
      dailyBookings.forEach((b) => {
        // Safe Date Comparison (using .getTime())
        const existStartMs = new Date(b.slot_start).getTime()
        const existEndMs = new Date(b.slot_end).getTime()

        // Overlap Logic: (StartA < EndB) and (EndA > StartB)
        const isOverlapping = existStartMs < reqEndMs && existEndMs > reqStartMs
        
        if (isOverlapping) {
          takenBays.add(b.simulator_id)
        }
      })
    }

    // 4. ASSIGN BAY (1 -> 2 -> 3)
    let assignedSimulatorId = 0
    if (!takenBays.has(1)) assignedSimulatorId = 1
    else if (!takenBays.has(2)) assignedSimulatorId = 2
    else if (!takenBays.has(3)) assignedSimulatorId = 3

    // If all are full, return 409
    if (assignedSimulatorId === 0) {
      return NextResponse.json(
        { error: "All 3 Simulators are busy for this time slot." }, 
        { status: 409 }
      )
    }

    // 5. INSERT BOOKING
    const { data: booking, error: insertError } = await supabase
      .from("bookings")
      .insert({
        booking_date,
        start_time,
        end_time: endTimeText,
        slot_start: slotStartISO,
        slot_end: slotEndISO,
        duration_hours,
        simulator_id: assignedSimulatorId, 
        user_type: "walk_in", 
        guest_name: guest_name || "Walk-In Guest",
        guest_email,
        guest_phone,
        total_price,
        status: payment_status === "completed" ? "confirmed" : "pending",
        payment_status: payment_status === "completed" ? "paid_instore" : "pending",
        players: bookingData.players || 1,
        session_type: bookingData.session_type || "quick",
        created_at: new Date().toISOString(),
        updated_at: new Date().toISOString(),
      })
      .select()
      .single()

    if (insertError) {
      // Return specific error so we know what broke
      console.error("Walk-in Insert Error:", insertError)
      return NextResponse.json({ 
        error: "Failed to create booking", 
        details: insertError.message 
      }, { status: 500 })
    }

    return NextResponse.json({ success: true, booking_id: booking.id, assigned_bay: assignedSimulatorId })

  } catch (error: any) {
    console.error("Walk-in Server Error:", error)
    return NextResponse.json({ error: error.message || "Internal server error" }, { status: 500 })
  }
}
</file>

<file path="app/api/coupons/validate/route.ts">
import { type NextRequest, NextResponse } from "next/server"
import { createClient } from "@/lib/supabase/server"

export const runtime = 'edge';

export async function POST(request: NextRequest) {
  try {
    const body = await request.json()
    const { coupon_code, booking_amount, session_type } = body

    if (!coupon_code) {
      return NextResponse.json({ valid: false, message: "Coupon code is required" }, { status: 400 })
    }

    const supabase = await createClient()

    // Query the coupons table
    const { data: coupon, error } = await supabase
      .from("coupons")
      .select("*")
      .eq("code", coupon_code.toUpperCase())
      .eq("is_active", true)
      .single()

    if (error || !coupon) {
      return NextResponse.json({ valid: false, message: "Invalid coupon code" }, { status: 200 })
    }

    // Check expiry date
    if (coupon.expires_at && new Date(coupon.expires_at) < new Date()) {
      return NextResponse.json({ valid: false, message: "Coupon has expired" }, { status: 200 })
    }

    // Check usage limit
    if (coupon.max_uses !== null && coupon.current_uses >= coupon.max_uses) {
      return NextResponse.json({ valid: false, message: "Coupon usage limit reached" }, { status: 200 })
    }

    // Calculate discount
    let discount_amount = 0
    if (coupon.discount_type === "percentage") {
      discount_amount = (booking_amount * coupon.discount_value) / 100
    } else if (coupon.discount_type === "fixed") {
      discount_amount = Math.min(coupon.discount_value, booking_amount)
    }

    // Increment usage count
    await supabase
      .from("coupons")
      .update({ current_uses: coupon.current_uses + 1 })
      .eq("id", coupon.id)

    return NextResponse.json({
      valid: true,
      discount_amount,
      message: `Coupon applied! You saved R${discount_amount.toFixed(2)}`,
    })
  } catch (error) {
    console.error("Coupon validation error:", error)
    return NextResponse.json({ valid: false, message: "Server error" }, { status: 500 })
  }
}
</file>

<file path="app/api/debug-yoco/route.ts">
import { NextResponse } from "next/server"

export const runtime = "edge"

export async function GET() {
  const YOCO_KEY = process.env.YOCO_SECRET_KEY

  if (!YOCO_KEY) return NextResponse.json({ error: "No Key Found" })

  try {
    // GET request to list all webhooks
    const response = await fetch("https://payments.yoco.com/api/webhooks", {
      method: "GET",
      headers: {
        "Authorization": `Bearer ${YOCO_KEY}`,
        "Content-Type": "application/json",
      },
    })

    const data = await response.json()
    
    return NextResponse.json({
      status: response.status,
      webhooks: data
    })

  } catch (error: any) {
    return NextResponse.json({ error: error.message })
  }
}
</file>

<file path="app/api/payment/confirm/route.ts">
import { NextResponse } from "next/server"

export const runtime = "edge"

export async function POST(req: Request) {
  try {
    const body = await req.json()
    const { bookingId } = body
    
    // Point to your EXISTING n8n Webhook
    const N8N_URL = "https://n8n.srv1127912.hstgr.cloud/webhook/payment-webhook" 

    // Simulate a Yoco Payload so n8n understands it
    const payload = {
      type: "payment.succeeded", 
      payload: {
        id: "manual_coupon_bypass",
        amount: 0,
        status: "succeeded",
        metadata: {
          bookingId: bookingId,
          depositPaid: "0.00", 
          outstandingBalance: "0.00",
          totalPrice: "0.00 (Coupon)"
        }
      }
    }

    await fetch(N8N_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-yoco-timestamp": Date.now().toString(),
        "x-yoco-signature": "bypass_manual_auth" 
      },
      body: JSON.stringify(payload)
    })

    return NextResponse.json({ success: true })

  } catch (error) {
    return NextResponse.json({ error: "Failed to trigger automation" }, { status: 500 })
  }
}
</file>

<file path="app/api/payment/initialize/route.ts">
import { type NextRequest, NextResponse } from "next/server"
import { createClient } from "@/lib/supabase/server"

// 1. Force Edge Runtime
export const runtime = "edge"

// Helper: Force SAST Timezone (+02:00) construction
function createSASTTimestamp(dateStr: string, timeStr: string): string {
  const cleanTime = timeStr.length === 5 ? `${timeStr}:00` : timeStr;
  return `${dateStr}T${cleanTime}+02:00`;
}

// Helper: Add hours to a timestamp for the end time
function addHoursToTimestamp(timestamp: string, hours: number): string {
  const date = new Date(timestamp);
  date.setHours(date.getHours() + hours);
  return date.toISOString(); 
}

// Helper: Calculate text end time
function calculateEndTimeText(start: string, duration: number): string {
  const [hours, minutes] = start.split(":").map(Number)
  const date = new Date()
  date.setHours(hours, minutes, 0, 0)
  date.setHours(date.getHours() + duration)
  return date.toTimeString().slice(0, 5) 
}

export async function POST(request: NextRequest) {
  try {
    const body = await request.json()
    
    // --- MAPPING VARIABLES ---
    const booking_date = body.booking_date || body.date
    const start_time = body.start_time || body.timeSlot
    const duration_hours = body.duration_hours || body.duration
    const player_count = body.player_count || body.players
    
    const session_type = body.session_type || body.sessionType 
    const famous_course_option = body.famous_course_option || body.sessionType 
    
    const base_price = body.base_price || 0 
    const total_price = body.total_price || body.totalPrice
    
    const guest_name = body.guest_name || body.customerName
    const guest_email = body.guest_email || body.customerEmail
    const guest_phone = body.guest_phone || body.customerPhone
    
    const {
      accept_whatsapp,
      enter_competition,
      coupon_code,
      pay_full_amount
    } = body

    const supabase = await createClient()

    // ---------------------------------------------------------
    // 2. ROBUST COUPON & PRICE LOGIC
    // ---------------------------------------------------------
    let dbTotalPrice = Number(total_price)
    let dbPaymentStatus = "pending"
    let dbStatus = "pending"
    let skipYoco = false
    let couponApplied = null

    const cleanCouponCode = coupon_code ? String(coupon_code).trim().toUpperCase() : null

    if (cleanCouponCode && cleanCouponCode.length > 0) {
      const { data: couponData } = await supabase
        .from("coupons")
        .select("*")
        .eq("code", cleanCouponCode)
        .eq("is_active", true)
        .single()

      if (couponData) {
        couponApplied = cleanCouponCode
        
        // ADMIN BYPASS
        if (cleanCouponCode === "MULLIGAN_ADMIN_100") {
          dbTotalPrice = Number(base_price)
          dbPaymentStatus = "paid_instore" 
          dbStatus = "confirmed"
          skipYoco = true
        }
        // 100% DISCOUNT
        else if (couponData.discount_percent === 100) {
          dbTotalPrice = 0
          dbPaymentStatus = "completed"
          dbStatus = "confirmed"
          skipYoco = true
        }
        // PERCENTAGE DISCOUNT
        else if (couponData.discount_percent > 0) {
           const discountAmount = (Number(base_price) * (couponData.discount_percent / 100));
           dbTotalPrice = Math.max(0, Number(base_price) - discountAmount);
        }
      }
    }

    if (dbTotalPrice === 0 && !skipYoco) {
      dbPaymentStatus = "completed"
      dbStatus = "confirmed"
      skipYoco = true
    }

    // ---------------------------------------------------------
    // 3. MULTI-BAY ASSIGNMENT LOGIC (With Ghost Filter)
    // ---------------------------------------------------------
    
    const requestedStartISO = createSASTTimestamp(booking_date, start_time);
    const requestedEndISO = addHoursToTimestamp(requestedStartISO, duration_hours);

    // Fetch ALL active bookings
    const { data: dailyBookings } = await supabase
        .from("bookings")
        .select("simulator_id, slot_start, slot_end, status, created_at")
        .eq("booking_date", booking_date)
        .neq("status", "cancelled")

    const takenBays = new Set<number>();
    const now = Date.now();
    
    if (dailyBookings) {
      dailyBookings.forEach(b => {
        // SMART FILTER: Ignore "pending" bookings older than 20 mins
        let isActive = true;
        if (b.status === 'pending') {
            const createdTime = new Date(b.created_at).getTime();
            if ((now - createdTime) > 1200000) { // 20 mins
                isActive = false;
            }
        }

        if (isActive) {
            const bStart = new Date(b.slot_start).getTime();
            const bEnd = new Date(b.slot_end).getTime();
            const reqStart = new Date(requestedStartISO).getTime();
            const reqEnd = new Date(requestedEndISO).getTime();

            const isOverlapping = (bStart < reqEnd) && (bEnd > reqStart);
            
            if (isOverlapping) {
               takenBays.add(b.simulator_id);
            }
        }
      });
    }

    let assignedSimulatorId = 0
    if (!takenBays.has(1)) assignedSimulatorId = 1
    else if (!takenBays.has(2)) assignedSimulatorId = 2
    else if (!takenBays.has(3)) assignedSimulatorId = 3
    
    if (assignedSimulatorId === 0) {
        return NextResponse.json({ error: "Sorry, all bays are full for this time duration." }, { status: 409 })
    }

    // ---------------------------------------------------------
    // 4. CREATE DB ROW
    // ---------------------------------------------------------
    const slotStartISO = createSASTTimestamp(booking_date, start_time);
    const slotEndISO = addHoursToTimestamp(slotStartISO, duration_hours);
    const endTimeText = calculateEndTimeText(start_time, duration_hours);

    const { data: booking, error: bookingError } = await supabase
      .from("bookings")
      .insert({
        booking_date,
        start_time,
        end_time: endTimeText,
        slot_start: slotStartISO,
        slot_end: slotEndISO,
        duration_hours,
        player_count,
        simulator_id: assignedSimulatorId, 
        user_type: "guest",
        session_type,
        famous_course_option,
        base_price,
        total_price: dbTotalPrice,
        status: dbStatus,
        payment_status: dbPaymentStatus,
        guest_name,
        guest_email,
        guest_phone,
        accept_whatsapp,
        enter_competition,
        coupon_code: couponApplied,
      })
      .select()
      .single()

    if (bookingError) {
      console.error("Booking Insert Error:", bookingError)
      return NextResponse.json({ error: "Failed to create booking" }, { status: 500 })
    }

    if (skipYoco) {
      return NextResponse.json({
        free_booking: true,
        booking_id: booking.id,
        message: dbPaymentStatus === "paid_instore" ? "Walk-in Confirmed" : "Booking confirmed with coupon",
      })
    }

    // ---------------------------------------------------------
    // 5. DEPOSIT LOGIC
    // ---------------------------------------------------------
    let amountToCharge = dbTotalPrice; 
    const sessionStr = String(session_type || "").toLowerCase();
    const optionStr = String(famous_course_option || "").toLowerCase();
    const isDepositEligible = sessionStr.includes("famous") || sessionStr.includes("ball") || optionStr.includes("ball");

    if (isDepositEligible && !pay_full_amount) {
         amountToCharge = Math.ceil(dbTotalPrice * 0.40);
    }
    
    const outstandingBalance = dbTotalPrice - amountToCharge;

    // ---------------------------------------------------------
    // 6. YOCO CHECKOUT
    // ---------------------------------------------------------
    const appUrl = process.env.NEXT_PUBLIC_SITE_URL || "https://www.themulligan.org"

    const yocoResponse = await fetch("https://payments.yoco.com/api/checkouts", {
      method: "POST",
      headers: {
        Authorization: `Bearer ${process.env.YOCO_SECRET_KEY}`,
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        amount: Math.round(amountToCharge * 100),
        currency: "ZAR",
        cancelUrl: `${appUrl}/booking?cancelled=true`,
        // FIXED URL HERE:
        successUrl: `${appUrl}/booking/success?bookingId=${booking.id}`, 
        failureUrl: `${appUrl}/booking?error=payment_failed`,
        metadata: {
          bookingId: booking.id,
          totalPrice: dbTotalPrice.toFixed(2), 
          depositPaid: amountToCharge.toFixed(2),
          outstandingBalance: outstandingBalance.toFixed(2),
          isDeposit: (outstandingBalance > 0).toString()
        },
      }),
    })

    const yocoData = await yocoResponse.json()

    if (yocoData.id) {
       await supabase
        .from("bookings")
        .update({ yoco_payment_id: yocoData.id })
        .eq("id", booking.id)
    }

    if (!yocoResponse.ok) {
      console.error("Yoco Error:", yocoData)
      return NextResponse.json({ error: "Payment initialization failed" }, { status: 500 })
    }

    return NextResponse.json({
      redirectUrl: yocoData.redirectUrl,
      booking_id: booking.id,
    })

 } catch (error: any) {
    console.error("Server Error:", error)
    return NextResponse.json({ error: error.message || "Internal server error" }, { status: 500 })
  }
}
</file>

<file path="app/api/payment/verify/route.ts">
import { createClient } from "@supabase/supabase-js"
import { NextRequest, NextResponse } from "next/server"

export const runtime = "edge"

export async function GET(request: NextRequest) {
  const searchParams = request.nextUrl.searchParams
  const reference = searchParams.get("reference") // This is the booking_id

  // 1. Basic Validation
  if (!reference) {
    return NextResponse.redirect(new URL("/booking?error=no_payment_reference", request.url))
  }

  try {
    const supabase = createClient(
      process.env.NEXT_PUBLIC_SUPABASE_URL!,
      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
    )

    // 2. Check the Booking in DB
    const { data: booking, error } = await supabase
      .from("bookings")
      .select("status, payment_status")
      .eq("id", reference)
      .single()

    if (error || !booking) {
      console.error("Verify Error:", error)
      return NextResponse.redirect(new URL("/booking?error=booking_not_found", request.url))
    }

    // 3. Smart Redirect
    // Even if status is 'pending' (because n8n is slow), we assume success if they got here from Yoco.
    // The Frontend Success page can show a "Confirming..." spinner if needed.
    return NextResponse.redirect(new URL(`/booking/success?reference=${reference}`, request.url))

  } catch (error) {
    console.error("Verify Exception:", error)
    // Fallback: If anything explodes, just try to send them to success anyway with the ID
    return NextResponse.redirect(new URL(`/booking/success?reference=${reference}`, request.url))
  }
}
</file>

<file path="app/api/trigger-n8n/route.ts">
import { NextRequest, NextResponse } from "next/server"
import { createClient } from "@/lib/supabase/server"

export const runtime = "edge"

export async function POST(request: NextRequest) {
  try {
    const { bookingId } = await request.json()
    if (!bookingId) return NextResponse.json({ error: "No ID" }, { status: 400 })

    const supabase = await createClient()

    // 1. Fetch the Booking
    const { data: booking, error } = await supabase
      .from("bookings")
      .select("*")
      .eq("id", bookingId)
      .single()

    if (error || !booking) {
      return NextResponse.json({ error: "Booking not found" }, { status: 404 })
    }

    // 2. Re-Calculate the 40% Split (Same logic as Checkout)
    // We do this here so n8n gets accurate numbers for the email
    let totalPrice = Number(booking.total_price) || 0
    let depositAmount = totalPrice // Default to full price

    const sessionStr = String(booking.session_type || "").toLowerCase()
    const optionStr = String(booking.famous_course_option || "").toLowerCase()

    // If it's Famous or Multi-ball, apply 40% rule
    if (sessionStr.includes("famous") || sessionStr.includes("ball") || optionStr.includes("ball")) {
      depositAmount = Math.ceil(totalPrice * 0.40)
    }

    const outstandingBalance = totalPrice - depositAmount

    // 3. Send to n8n (Using YOUR specific URL and Secret)
    const n8nUrl = "https://n8n.srv1127912.hstgr.cloud/webhook/manual-confirm"
    
    const n8nResponse = await fetch(n8nUrl, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        secret: "mulligan-secure-8821", // MATCHES YOUR N8N CODE
        bookingId: booking.id,
        yocoId: booking.yoco_payment_id || "manual_web_confirm",
        paymentStatus: "paid", // We assume paid if they reached success
        // Data for Emails
        guest_name: booking.guest_name,
        guest_email: booking.guest_email,
        guest_phone: booking.guest_phone,
        booking_date: booking.booking_date,
        start_time: booking.start_time,
        simulator_id: booking.simulator_id,
        // The Calculated Money Values
        depositPaid: depositAmount.toFixed(2),
        outstandingBalance: outstandingBalance.toFixed(2),
        totalPrice: totalPrice.toFixed(2)
      }),
    })

    if (!n8nResponse.ok) {
      console.error("n8n Failed", n8nResponse.status)
      return NextResponse.json({ error: "Automation failed" }, { status: 500 })
    }

    return NextResponse.json({ success: true })

  } catch (error: any) {
    return NextResponse.json({ error: error.message }, { status: 500 })
  }
}
</file>

<file path="app/apple-icon.tsx">
import { ImageResponse } from "next/og"

// Image metadata
export const size = {
  width: 180,
  height: 180,
}
export const contentType = "image/png"

// Image generation
export default function Icon() {
  return new ImageResponse(
    // ImageResponse JSX element
    <div
      style={{
        fontSize: 120,
        background: "#143B29", // Deep Forest Green
        width: "100%",
        height: "100%",
        display: "flex",
        alignItems: "center",
        justifyContent: "center",
        color: "#B88642", // Copper/Gold
        borderRadius: "32px",
        fontFamily: "Times New Roman, serif",
        fontWeight: 900,
      }}
    >
      M
    </div>,
    // ImageResponse options
    {
      ...size,
    },
  )
}
</file>

<file path="app/booking/confirm/page.tsx">
"use client"

import { useState, Suspense } from "react"
import { useSearchParams } from "next/navigation"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardHeader, CardTitle, CardFooter } from "@/components/ui/card"
import { Calendar, Users, CreditCard, ArrowRight, Loader2, AlertCircle, Trophy } from "lucide-react"

// Helper to wrap search params for Next.js 15
function BookingDetails() {
  const searchParams = useSearchParams()
  
  // State
  const [isProcessing, setIsProcessing] = useState(false)
  const [payFullAmount, setPayFullAmount] = useState(false)
  const [couponCode, setCouponCode] = useState("") 
  const [error, setError] = useState<string | null>(null)

  // Hardcoded Guest Info
  const [guestName, setGuestName] = useState("")
  const [guestEmail, setGuestEmail] = useState("")
  const [guestPhone, setGuestPhone] = useState("")

  // Extract Params
  const sessionType = searchParams.get("sessionType") || ""
  const players = Number(searchParams.get("players")) || 1
  const dateStr = searchParams.get("date") || ""
  const timeSlot = searchParams.get("timeSlot") || ""
  const duration = Number(searchParams.get("duration")) || 1
  const golfClubRental = searchParams.get("golfClubRental") === "true"
  const coachingSession = searchParams.get("coachingSession") === "true"

  // --- CALCULATION LOGIC ---
  const calculateTotal = () => {
    let basePrice = 0
    // DEMO PRICING: Adjusted numbers slightly to look realistic for US Market ($)
    if (sessionType === "4ball") basePrice = 80 * 4 * duration 
    else if (sessionType === "3ball") basePrice = 90 * 3 * duration
    else {
      // Quick Play Fallback
      const pricing = { 1: 120, 2: 100, 3: 90, 4: 80 }
      const rate = pricing[Math.min(players, 4) as keyof typeof pricing] || 120
      basePrice = rate * players * duration
    }
    
    if (golfClubRental) basePrice += 40
    if (coachingSession) basePrice += 100
    return basePrice
  }

  const total = calculateTotal()
  
  // Deposit Logic
  const isDepositEligible = sessionType.includes("ball") || sessionType.includes("famous")
  const depositAmount = Math.ceil(total * 0.40)
  
  // Checkbox Toggle
  const amountDueNow = (isDepositEligible && !payFullAmount) ? depositAmount : total
  const amountDueLater = total - amountDueNow

  const handlePayment = async () => {
    if (!guestName || !guestEmail || !guestPhone) {
      setError("Please fill in your details.")
      return
    }

    setIsProcessing(true)
    setError(null)

    try {
      const response = await fetch("/api/payment/initialize", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          booking_date: dateStr,
          start_time: timeSlot,
          duration_hours: duration,
          player_count: players,
          session_type: sessionType,
          guest_name: guestName,
          guest_email: guestEmail,
          guest_phone: guestPhone,
          total_price: total,
          pay_full_amount: payFullAmount,
          coupon_code: couponCode,
          enter_competition: false, 
          accept_whatsapp: true
        }),
      })

      if (!response.ok) {
        const errorText = await response.text()
        let errorMessage = "Server Error"
        try {
           const errorJson = JSON.parse(errorText)
           errorMessage = errorJson.error || errorMessage
        } catch {
           errorMessage = `Error: ${response.status} ${response.statusText}`
        }
        throw new Error(errorMessage)
      }

      const data = await response.json()

      if (data.redirectUrl) {
        window.location.href = data.redirectUrl
      } else if (data.free_booking) {
         window.location.href = `/booking/success?bookingId=${data.booking_id}`
      } else {
        throw new Error("No payment redirect found")
      }

    } catch (err: any) {
      console.error("Payment Error:", err)
      setError(err.message || "Payment initialization failed")
    } finally {
      setIsProcessing(false) 
    }
  }

  const sessionLabel = sessionType === "4ball" ? "4-Ball Special" : 
                       sessionType === "3ball" ? "3-Ball Special" : "Quick Play"

  return (
    // MAIN CONTAINER - DARK THEME APPLIED
    <div className="max-w-3xl mx-auto p-4 space-y-8 pb-24 text-zinc-100">
      <div className="text-center mb-8 pt-6">
        <h1 className="text-4xl font-bold bg-gradient-to-r from-emerald-400 to-cyan-400 bg-clip-text text-transparent">
          Confirm Booking
        </h1>
        <p className="text-zinc-400 mt-2">Finalize your session details</p>
      </div>

      <div className="grid gap-8 md:grid-cols-2">
        {/* LEFT COL: Details & Input */}
        <div className="space-y-6">
          
          {/* SESSION CARD */}
          <Card className="bg-zinc-900/50 border-zinc-800 backdrop-blur-sm shadow-xl">
            <CardHeader className="pb-3 border-b border-zinc-800/50">
              <CardTitle className="text-lg flex items-center gap-2 text-zinc-100">
                <Calendar className="w-5 h-5 text-emerald-400" />
                Session Details
              </CardTitle>
            </CardHeader>
            <CardContent className="space-y-3 text-sm pt-4">
              <div className="flex justify-between py-1">
                <span className="text-zinc-500">Date</span>
                <span className="font-medium text-zinc-200">{dateStr}</span>
              </div>
              <div className="flex justify-between py-1">
                <span className="text-zinc-500">Time</span>
                <span className="font-medium text-zinc-200">{timeSlot} ({duration} hrs)</span>
              </div>
              <div className="flex justify-between py-1">
                <span className="text-zinc-500">Type</span>
                <span className="font-medium text-emerald-400">{sessionLabel}</span>
              </div>
            </CardContent>
          </Card>

          {/* GUEST DETAILS CARD */}
          <Card className="bg-zinc-900/50 border-zinc-800 backdrop-blur-sm shadow-xl">
             <CardHeader className="pb-3 border-b border-zinc-800/50">
              <CardTitle className="text-lg flex items-center gap-2 text-zinc-100">
                <Users className="w-5 h-5 text-emerald-400" />
                Guest Details
              </CardTitle>
            </CardHeader>
            <CardContent className="space-y-4 pt-4">
              <div className="space-y-1">
                <label className="text-xs font-semibold text-zinc-500 uppercase ml-1">Name</label>
                <input 
                  type="text" 
                  value={guestName}
                  onChange={e => setGuestName(e.target.value)}
                  className="w-full bg-zinc-950 border border-zinc-800 rounded-xl p-3 text-zinc-100 focus:ring-1 focus:ring-emerald-500 focus:outline-none placeholder:text-zinc-600"
                  placeholder="Enter full name"
                />
              </div>
              <div className="space-y-1">
                <label className="text-xs font-semibold text-zinc-500 uppercase ml-1">Email</label>
                <input 
                  type="email" 
                  value={guestEmail}
                  onChange={e => setGuestEmail(e.target.value)}
                  className="w-full bg-zinc-950 border border-zinc-800 rounded-xl p-3 text-zinc-100 focus:ring-1 focus:ring-emerald-500 focus:outline-none placeholder:text-zinc-600"
                  placeholder="Enter email address"
                />
              </div>
              <div className="space-y-1">
                <label className="text-xs font-semibold text-zinc-500 uppercase ml-1">Phone</label>
                <input 
                  type="tel" 
                  value={guestPhone}
                  onChange={e => setGuestPhone(e.target.value)}
                  className="w-full bg-zinc-950 border border-zinc-800 rounded-xl p-3 text-zinc-100 focus:ring-1 focus:ring-emerald-500 focus:outline-none placeholder:text-zinc-600"
                  placeholder="(555) 123-4567"
                />
              </div>
            </CardContent>
          </Card>

           {/* PROMO CODE CARD */}
           <Card className="bg-zinc-900/50 border-zinc-800 backdrop-blur-sm shadow-xl">
            <CardHeader className="pb-3 border-b border-zinc-800/50">
              <CardTitle className="text-lg flex items-center gap-2 text-zinc-100">
                <Trophy className="w-5 h-5 text-amber-500" />
                Promo Code
              </CardTitle>
            </CardHeader>
            <CardContent className="pt-4">
              <div className="flex gap-2">
                <input 
                  type="text" 
                  value={couponCode}
                  onChange={e => setCouponCode(e.target.value.toUpperCase())}
                  className="flex-1 bg-zinc-950 border border-zinc-800 rounded-xl p-3 text-zinc-100 uppercase placeholder:normal-case placeholder:text-zinc-600 focus:outline-none focus:border-amber-500/50"
                  placeholder="Enter code (e.g. SAVE10)"
                />
              </div>
            </CardContent>
          </Card>
        </div>

        {/* RIGHT COL: Payment */}
        <div className="space-y-6">
          <Card className="bg-zinc-900 border-zinc-800 shadow-2xl relative overflow-hidden">
            {/* Top Glow Effect */}
            <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-emerald-500 to-cyan-500" />
            
            <CardHeader className="pb-4">
              <CardTitle className="text-xl flex items-center gap-2 text-white">
                <CreditCard className="w-6 h-6 text-emerald-400" />
                Payment Summary
              </CardTitle>
            </CardHeader>

            <CardContent className="space-y-6">
              <div className="flex justify-between text-zinc-400 text-sm">
                <span>Subtotal</span>
                <span>${total.toFixed(2)}</span>
              </div>
              
              {/* CHECKBOX LOGIC - FIXED DARK MODE */}
              {isDepositEligible && (
                <div className="bg-zinc-800/40 p-4 rounded-xl border border-zinc-700/50">
                  <label className="flex items-start gap-4 cursor-pointer group">
                    <input 
                      type="checkbox" 
                      id="payFull" 
                      checked={payFullAmount}
                      onChange={(e) => setPayFullAmount(e.target.checked)}
                      className="mt-1 w-5 h-5 text-emerald-500 bg-zinc-900 border-zinc-600 rounded focus:ring-emerald-500 focus:ring-offset-0 cursor-pointer"
                    />
                    <div className="space-y-1">
                      <span className="block text-sm font-medium text-zinc-200 group-hover:text-white transition-colors">
                        Pay full amount now?
                      </span>
                      <p className="text-xs text-zinc-500 leading-relaxed">
                        Pay ${total} now and settle nothing in store.
                      </p>
                    </div>
                  </label>
                </div>
              )}

              <div className="h-px bg-zinc-800 w-full" />

              <div className="space-y-4">
                <div className="flex justify-between items-end">
                  <span className="font-semibold text-lg text-zinc-200">Due Now</span>
                  <span className="font-bold text-3xl text-white">${amountDueNow.toFixed(2)}</span>
                </div>
                
                {amountDueLater > 0 && (
                   <div className="flex justify-between items-center text-sm font-medium bg-amber-950/30 border border-amber-900/50 px-4 py-3 rounded-lg">
                    <span className="text-amber-500">Due in Store</span>
                    <span className="text-amber-400 text-lg">${amountDueLater.toFixed(2)}</span>
                  </div>
                )}
              </div>
            </CardContent>
            
            <CardFooter className="pt-2 pb-6">
              <Button 
                onClick={handlePayment} 
                disabled={isProcessing}
                className="w-full h-14 text-lg font-bold bg-emerald-600 hover:bg-emerald-500 text-white rounded-xl shadow-lg shadow-emerald-900/20 transition-all hover:scale-[1.02]"
              >
                {isProcessing ? (
                  <>
                    <Loader2 className="mr-2 h-5 w-5 animate-spin" />
                    Processing...
                  </>
                ) : (
                  <>
                    Pay ${amountDueNow}
                    <ArrowRight className="ml-2 h-5 w-5" />
                  </>
                )}
              </Button>
            </CardFooter>
          </Card>
          
          {error && (
            <div className="p-4 bg-red-950/30 border border-red-900/50 text-red-400 text-sm rounded-xl flex items-center gap-3 animate-in fade-in slide-in-from-top-2">
              <AlertCircle className="w-5 h-5 shrink-0" />
              {error}
            </div>
          )}
        </div>
      </div>
    </div>
  )
}

export default function BookingConfirmPage() {
  return (
    <Suspense fallback={<div className="flex h-screen items-center justify-center bg-zinc-950 text-emerald-500">Loading...</div>}>
      <BookingDetails />
    </Suspense>
  )
}
</file>

<file path="app/booking/page.tsx">
import { BookingFlow } from "@/components/booking-flow"

export default function BookingPage() {
  return (
    <div className="min-h-screen bg-gradient-to-br from-background via-background to-primary/5">
      <BookingFlow />
    </div>
  )
}
</file>

<file path="app/booking/success/page.tsx">
"use client"

import { useEffect, useState, Suspense } from "react"
import { useSearchParams } from "next/navigation"
import Link from "next/link"
import { CheckCircle, Loader2, AlertCircle } from "lucide-react"
import { Button } from "@/components/ui/button"

function SuccessContent() {
  const searchParams = useSearchParams()
  const bookingId = searchParams.get("bookingId")
  
  const [status, setStatus] = useState<"loading" | "success" | "error">("loading")

  useEffect(() => {
    if (!bookingId) return

    // Trigger the "Manual" confirmation immediately
    const triggerConfirmation = async () => {
      try {
        const res = await fetch("/api/trigger-n8n", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ bookingId }),
        })

        if (res.ok) {
          setStatus("success")
        } else {
          console.error("Failed to trigger n8n")
          // Even if n8n fails, we might want to show success if the payment worked,
          // but let's show success anyway so the user doesn't panic.
          setStatus("success") 
        }
      } catch (e) {
        console.error("Network error", e)
        setStatus("success") // Fallback to success to avoid user panic
      }
    }

    triggerConfirmation()
  }, [bookingId])

  if (!bookingId) {
    return (
      <div className="flex flex-col items-center justify-center min-h-[60vh]">
        <AlertCircle className="w-12 h-12 text-red-500 mb-4" />
        <h1 className="text-xl font-bold">Invalid Page Access</h1>
        <Link href="/">
           <Button className="mt-4">Go Home</Button>
        </Link>
      </div>
    )
  }

  return (
    <div className="flex flex-col items-center justify-center min-h-[60vh] text-center p-4">
      {status === "loading" ? (
        <div className="space-y-6 animate-pulse">
          <div className="w-20 h-20 bg-primary/10 rounded-full flex items-center justify-center mx-auto">
            <Loader2 className="w-10 h-10 text-primary animate-spin" />
          </div>
          <h1 className="text-2xl font-bold">Finalizing Booking...</h1>
          <p className="text-muted-foreground">
            Please do not close this tab.
          </p>
        </div>
      ) : (
        <div className="animate-in fade-in zoom-in duration-500 space-y-4">
          <div className="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto">
            <CheckCircle className="w-10 h-10 text-green-600" />
          </div>
          <h1 className="text-3xl font-bold text-green-700">Booking Confirmed!</h1>
          <p className="text-muted-foreground max-w-md mx-auto">
            We have received your booking. A confirmation email is on its way.
          </p>
          <div className="pt-6">
            <Link href="/">
              <Button size="lg" className="w-full sm:w-auto">Book Another Round</Button>
            </Link>
          </div>
        </div>
      )}
    </div>
  )
}

export default function SuccessPage() {
  return (
    <Suspense fallback={<div className="p-20 text-center">Loading...</div>}>
      <SuccessContent />
    </Suspense>
  )
}
</file>

<file path="app/globals.css">
@import "tailwindcss";

@theme {
  --color-background: hsl(220 30% 8%);
  --color-foreground: hsl(210 40% 98%);
  
  --color-card: hsl(220 25% 12%);
  --color-card-foreground: hsl(210 40% 98%);
 
  --color-popover: hsl(220 25% 12%);
  --color-popover-foreground: hsl(210 40% 98%);
 
  --color-primary: hsl(150 100% 35%);
  --color-primary-foreground: hsl(210 40% 98%);
 
  --color-secondary: hsl(45 90% 50%);
  --color-secondary-foreground: hsl(220 30% 8%);
 
  --color-muted: hsl(217 20% 20%);
  --color-muted-foreground: hsl(215 20% 65%);
 
  --color-accent: hsl(150 100% 35%);
  --color-accent-foreground: hsl(210 40% 98%);
 
  --color-destructive: hsl(0 62.8% 30.6%);
  --color-destructive-foreground: hsl(210 40% 98%);
 
  --color-border: hsl(217 20% 20%);
  --color-input: hsl(217 20% 20%);
  --color-ring: hsl(150 100% 40%);
  
  --radius: 0.75rem;
}

/* Base Styles */
@layer base {
  * {
    border-color: var(--color-border);
    outline-color: var(--color-ring);
  }
  body {
    background-color: var(--color-background);
    color: var(--color-foreground);
/* TECH GRID + NOISE TEXTURE */
    background-image: 
      url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E"),
      linear-gradient(to right, rgba(255,255,255,0.03) 1px, transparent 1px),
      linear-gradient(to bottom, rgba(255,255,255,0.03) 1px, transparent 1px);
    background-size: cover, 60px 60px, 60px 60px;
    background-attachment: fixed;
  }
}

/* Custom Utilities */
.glass-panel {
  background-color: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
}

/* app/globals.css */

.bg-grid-white {
  background-size: 100px 100px;
  background-image: linear-gradient(to right, rgba(255, 255, 255, 0.05) 1px, transparent 1px),
    linear-gradient(to bottom, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
}

@keyframes noise {
  0%, 100% { transform: translate(0, 0); }
  10% { transform: translate(-5%, -5%); }
  20% { transform: translate(-10%, 5%); }
  30% { transform: translate(5%, -10%); }
  40% { transform: translate(-5%, 15%); }
  50% { transform: translate(-10%, 5%); }
  60% { transform: translate(15%, 0); }
  70% { transform: translate(0, 10%); }
  80% { transform: translate(-15%, 0); }
  90% { transform: translate(10%, 5%); }
}

.noise-bg {
  position: fixed;
  top: -50%;
  left: -50%;
  right: -50%;
  bottom: -50%;
  width: 200%;
  height: 200vh;
  background: transparent url('https://grainy-gradients.vercel.app/noise.svg') repeat 0 0;
  background-repeat: repeat;
  animation: noise .2s infinite;
  opacity: 0.04;
  visibility: visible;
  pointer-events: none;
  z-index: 50;
  filter: contrast(170%) brightness(100%);
}
</file>

<file path="app/icon.tsx">
import { ImageResponse } from "next/og"

// Image metadata
export const size = {
  width: 32,
  height: 32,
}
export const contentType = "image/png"

// Image generation
export default function Icon() {
  return new ImageResponse(
    // ImageResponse JSX element
    <div
      style={{
        fontSize: 20,
        background: "#143B29", // Deep Forest Green
        width: "100%",
        height: "100%",
        display: "flex",
        alignItems: "center",
        justifyContent: "center",
        color: "#B88642", // Copper/Gold
        borderRadius: "6px",
        fontFamily: "Times New Roman, serif",
        fontWeight: 900,
      }}
    >
      M
    </div>,
    // ImageResponse options
    {
      ...size,
    },
  )
}
</file>

<file path="app/layout.tsx">
import type { Metadata } from "next"
import { Inter, Playfair_Display } from "next/font/google" // Import Playfair
import "./globals.css"
import { cn } from "@/lib/utils"
import { venueConfig } from "@/lib/venue-config"

const inter = Inter({ subsets: ["latin"], variable: "--font-sans" })
const playfair = Playfair_Display({ subsets: ["latin"], variable: "--font-serif" })

export const metadata: Metadata = {
  title: `${venueConfig.name} | Book Online`,
  description: venueConfig.description,
}

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode
}>) {
  return (
    <html lang="en" suppressHydrationWarning>
      <body className={cn(inter.variable, playfair.variable, "min-h-screen bg-background font-sans antialiased")}>
        {children}
      </body>
    </html>
  )
}
</file>

<file path="CLOUDFLARE_DEPLOYMENT.md">
# Cloudflare Pages Deployment Guide

This Next.js 15 golf booking application is configured to deploy to Cloudflare Pages using `@cloudflare/next-on-pages`.

## Prerequisites

1. **Node.js 22+** - Ensure you have Node.js 22 or higher installed
2. **pnpm** - This project uses pnpm as the package manager
3. **Cloudflare Account** - Sign up at https://dash.cloudflare.com
4. **Wrangler CLI** - Install globally: `npm install -g wrangler@latest`

## Environment Variables

To ensure your application functions correctly, you must configure the following environment variables. These should be set dynamically in the Cloudflare Dashboard and NOT hardcoded in your application files.

### 1. Configure in `wrangler.toml` (for structure)
We have added a `[vars]` section to your `wrangler.toml` file. This tells Cloudflare which variables your application expects.
**Note:** Keep the values empty in `wrangler.toml` to avoid committing secrets to version control.

### 2. Configure in Cloudflare Dashboard (for values)
Go to **Settings** → **Environment Variables** in your Cloudflare Pages project and add the following:

| Variable Name | Description | Example Value |
|--------------|-------------|---------------|
| `NEXT_PUBLIC_SUPABASE_URL` | Your Supabase Project URL | `https://xyz.supabase.co` |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | Your Supabase Anonymous Key | `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...` |
| `N8N_WEBHOOK_URL` | URL for your n8n workflow | `https://n8n.yourdomain.com/webhook/...` |
| `YOCO_SECRET_KEY` | Secret key for Yoco payments | `sk_live_...` |
| `NEXT_PUBLIC_APP_URL` | The URL of your deployed app | `https://themulligan.co.za` |

### Required Variables:
\`\`\`bash
# Supabase
SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
SUPABASE_ANON_KEY=your_supabase_anon_key
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key

# Yoco Payment Gateway
YOCO_SECRET_KEY=sk_live_your_secret_key

# n8n Webhook for Booking Notifications
N8N_WEBHOOK_URL=https://your-n8n-instance.com/webhook/bookings

# Admin Coupon Code (for walk-in bookings)
ADMIN_COUPON_CODE=your_secure_admin_code

# App URL (Your Cloudflare Pages URL)
NEXT_PUBLIC_APP_URL=https://your-site.pages.dev
\`\`\`

## Local Development

1. **Install dependencies:**
   \`\`\`bash
   pnpm install
   \`\`\`

2. **Create a `.env.local` file** with your environment variables (see `.env.example`)

3. **Run the development server:**
   \`\`\`bash
   pnpm dev
   \`\`\`

4. **Test with Cloudflare Pages locally:**
   \`\`\`bash
   npx @cloudflare/next-on-pages
   wrangler pages dev .vercel/output/static
   \`\`\`

## Deployment Options

### Option 1: Deploy via Cloudflare Dashboard (Recommended for Production)

1. **Push your code to GitHub/GitLab**

2. **Go to Cloudflare Dashboard** → Workers & Pages → Create Application → Pages

3. **Connect your repository** and select the branch

4. **Configure build settings:**
   - **Build command:** `pnpm install && npx @cloudflare/next-on-pages`
   - **Build output directory:** `.vercel/output/static`
   - **Root directory:** `/`
   - **Environment variables:** Add all variables listed above

5. **Advanced settings:**
   - **Node version:** `22`
   - **Compatibility flags:** Add `nodejs_compat`

6. **Save and Deploy!**

### Option 2: Deploy via Wrangler CLI

1. **Authenticate with Cloudflare:**
   \`\`\`bash
   wrangler login
   \`\`\`

2. **Build the application:**
   \`\`\`bash
   pnpm install
   npx @cloudflare/next-on-pages
   \`\`\`

3. **Deploy to Pages:**
   \`\`\`bash
   wrangler pages deploy .vercel/output/static --project-name=mulligan-golf-booking
   \`\`\`

4. **Set environment variables via CLI:**
   \`\`\`bash
   wrangler pages secret put SUPABASE_URL --project-name=mulligan-golf-booking
   wrangler pages secret put YOCO_SECRET_KEY --project-name=mulligan-golf-booking
   # Repeat for all required variables
   \`\`\`

### Option 3: Continuous Deployment (Automated)

Once you connect via Option 1:
- Every push to `main` branch triggers automatic deployment
- Pushes to other branches create preview deployments
- Pull requests get unique preview URLs

## Custom Domain Setup

1. **Add Custom Domain:**
   - Go to your Pages project → Custom domains
   - Click "Set up a custom domain"
   - Enter your domain (e.g., `themulligan.co.za` or `www.themulligan.co.za`)

2. **DNS Configuration:**
   
   **If domain is on Cloudflare:**
   - DNS records are added automatically ✅
   
   **If domain is external:**
   - Add CNAME record at your DNS provider:
     \`\`\`
     Type: CNAME
     Name: @ (for root) or www (for subdomain)
     Target: your-project.pages.dev
     \`\`\`

3. **SSL Certificate:**
   - Automatically provisioned (1-5 minutes)
   - Free SSL/TLS with auto-renewal

## Key Differences from Vercel

### 1. **Payment Integration**
- Migrated from Paystack to **Yoco** payment processor
- Yoco is optimized for South African businesses
- API endpoints: `/app/api/payment/initialize` and `/app/api/payment/verify`

### 2. **Build Process**
- Using `@cloudflare/next-on-pages` adapter
- Build output: `.vercel/output/static`
- No more `ignoreBuildErrors` - production-ready code only

### 3. **Edge Runtime**
- API routes use `export const runtime = 'edge'`
- Middleware runs on Cloudflare Workers
- Ensures optimal performance globally

### 4. **Analytics**
- Removed `@vercel/analytics` (Vercel-specific)
- Use Cloudflare Web Analytics (free) or your preferred solution

### 5. **Database & Auth**
- Supabase continues to work seamlessly
- Edge runtime compatible
- No changes needed to database configuration

## Yoco Payment Setup

1. **Create a Yoco account:** https://portal.yoco.com
2. **Get your API keys:** Portal → Settings → API Keys
   - Use **Test keys** for development
   - Use **Live keys** for production
3. **Test the integration** with Yoco's test card numbers
4. **Configure webhooks** (optional): Portal → Settings → Webhooks
   - Webhook URL: `https://your-site.pages.dev/api/payment/webhook`

## n8n Webhook Integration

The booking system sends data to your n8n webhook at two points:

1. **Booking Creation** - When a booking is created (before payment)
2. **Payment Confirmation** - When payment is completed

**Webhook Payload:**
\`\`\`json
{
  "event": "booking.created" | "booking.payment_completed",
  "booking_id": "uuid",
  "customer_name": "John Doe",
  "customer_email": "john@example.com",
  "customer_phone": "+27123456789",
  "booking_date": "2025-01-15",
  "start_time": "14:00",
  "duration_hours": 2,
  "session_type": "quick_play" | "famous_course",
  "famous_course_option": "4ball" | "3ball" | null,
  "player_count": 4,
  "bay_id": 1,
  "total_amount": 1200,
  "deposit_amount": 400,
  "accept_whatsapp": true,
  "enter_competition": false,
  "payment_status": "pending" | "completed"
}
\`\`\`

## Troubleshooting

### Build Errors

**Error: "Expected output file not found"**
- Solution: The build output directory should be `.vercel/output/static`, not `.open-next/server`
- Update your Cloudflare Pages build settings

**Error: TypeScript compilation errors**
- Solution: Fix all TypeScript errors (no `ignoreBuildErrors` in production)
- Run `pnpm build` locally to catch errors early

**Error: pnpm-lock.yaml mismatch**
- Solution: Delete `node_modules` and `pnpm-lock.yaml`, then run `pnpm install`

### Runtime Errors

**Error: "Supabase client not initialized"**
- Solution: Verify environment variables are set in Cloudflare Dashboard
- Check that both `SUPABASE_URL` and `SUPABASE_ANON_KEY` (with and without `NEXT_PUBLIC_`) are set

**Error: Edge runtime not supported**
- Solution: Ensure API routes have `export const runtime = 'edge'`
- Avoid using Node.js-specific APIs in edge routes

### Payment Issues

**Error: "Yoco payment initialization failed"**
- Solution: Verify `YOCO_SECRET_KEY` is correct
- Check if using test keys vs live keys appropriately
- Ensure callback URLs match your domain

**Webhook not receiving data**
- Solution: Verify `N8N_WEBHOOK_URL` is set correctly
- Check n8n webhook is active and accessible
- Review Cloudflare Functions logs

## Performance Optimization

Cloudflare Pages provides:
- **Global CDN** - 275+ data centers worldwide
- **Edge Functions** - API routes run at the edge (sub-50ms)
- **Automatic caching** - Static assets cached globally
- **DDoS protection** - Built-in Layer 3/4/7 protection
- **Zero cold starts** - Unlike traditional serverless

## Monitoring & Analytics

1. **Cloudflare Web Analytics** (Free):
   - Add to your Pages project settings
   - Privacy-friendly, no cookies required

2. **Cloudflare Functions Logs**:
   - View real-time logs in dashboard
   - Debug API route issues

3. **Supabase Dashboard**:
   - Monitor database queries
   - Check RLS policy effectiveness

## Support & Resources

- **Cloudflare Pages Docs:** https://developers.cloudflare.com/pages/
- **Next.js on Cloudflare:** https://developers.cloudflare.com/pages/framework-guides/nextjs/
- **@cloudflare/next-on-pages:** https://github.com/cloudflare/next-on-pages
- **Yoco API Docs:** https://developer.yoco.com/
- **Cloudflare Community:** https://community.cloudflare.com/

## Quick Reference Commands

\`\`\`bash
# Local development
pnpm dev

# Build for Cloudflare Pages
npx @cloudflare/next-on-pages

# Deploy to Cloudflare Pages
wrangler pages deploy .vercel/output/static --project-name=mulligan-golf-booking

# Preview locally with Wrangler
wrangler pages dev .vercel/output/static

# View deployments
wrangler pages deployment list --project-name=mulligan-golf-booking

# Tail production logs
wrangler pages deployment tail --project-name=mulligan-golf-booking
\`\`\`

## Post-Deployment Checklist

- [ ] All environment variables configured in Cloudflare Dashboard
- [ ] Custom domain connected with SSL active
- [ ] Supabase database accessible from Cloudflare edge
- [ ] Payment gateway (Yoco) tested end-to-end
- [ ] n8n webhook receiving booking data
- [ ] Booking flow works completely
- [ ] Admin coupon codes functional for walk-ins
- [ ] Mobile responsiveness verified
- [ ] SEO metadata correct for all pages
- [ ] 404 and error pages working properly

Your golf booking site is now live on Cloudflare Pages! 🎉⛳
</file>

<file path="components.json">
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "app/globals.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "iconLibrary": "lucide"
}
</file>

<file path="components/admin-dashboard.tsx">
"use client"

import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { TrendingUp, Users, DollarSign, Activity, Calendar } from "lucide-react"

export function AdminDashboard() {
  return (
    <div className="min-h-screen bg-background p-8">
      {/* HEADER */}
      <div className="flex justify-between items-center mb-10">
        <div>
          <h1 className="text-3xl font-bold text-white tracking-tight">Command Center</h1>
          <p className="text-gray-400">Live Revenue Operations</p>
        </div>
        <div className="flex gap-3">
            <Badge className="bg-green-500/10 text-green-500 border-green-500/20 px-4 py-2 animate-pulse">
                SYSTEM ACTIVE
            </Badge>
        </div>
      </div>

      {/* KPI GRID */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">
        <Card className="border-l-4 border-l-primary bg-white/5">
          <CardContent className="p-6">
            <div className="flex justify-between items-start">
              <div>
                <p className="text-sm text-gray-400 uppercase tracking-wider">Total Revenue</p>
                <h3 className="text-3xl font-bold text-white mt-2">R 184,200</h3>
              </div>
              <div className="p-2 bg-primary/20 rounded-lg">
                <DollarSign className="text-primary w-6 h-6" />
              </div>
            </div>
            <div className="mt-4 flex items-center text-green-400 text-sm">
              <TrendingUp className="w-4 h-4 mr-1" />
              <span>+14% vs last month</span>
            </div>
          </CardContent>
        </Card>

        <Card className="border-l-4 border-l-secondary bg-white/5">
          <CardContent className="p-6">
            <div className="flex justify-between items-start">
              <div>
                <p className="text-sm text-gray-400 uppercase tracking-wider">Slot Utilization</p>
                <h3 className="text-3xl font-bold text-white mt-2">87.4%</h3>
              </div>
              <div className="p-2 bg-secondary/20 rounded-lg">
                <Activity className="text-secondary w-6 h-6" />
              </div>
            </div>
            <div className="mt-4 flex items-center text-gray-400 text-sm">
              <span>28 slots remaining today</span>
            </div>
          </CardContent>
        </Card>

        <Card className="border-l-4 border-l-blue-500 bg-white/5">
          <CardContent className="p-6">
            <div className="flex justify-between items-start">
              <div>
                <p className="text-sm text-gray-400 uppercase tracking-wider">Active Bookings</p>
                <h3 className="text-3xl font-bold text-white mt-2">142</h3>
              </div>
              <div className="p-2 bg-blue-500/20 rounded-lg">
                <Calendar className="text-blue-500 w-6 h-6" />
              </div>
            </div>
            <div className="mt-4 flex items-center text-green-400 text-sm">
              <TrendingUp className="w-4 h-4 mr-1" />
              <span>+32 this week</span>
            </div>
          </CardContent>
        </Card>

        <Card className="border-l-4 border-l-purple-500 bg-white/5">
          <CardContent className="p-6">
            <div className="flex justify-between items-start">
              <div>
                <p className="text-sm text-gray-400 uppercase tracking-wider">LTV / Customer</p>
                <h3 className="text-3xl font-bold text-white mt-2">R 3,450</h3>
              </div>
              <div className="p-2 bg-purple-500/20 rounded-lg">
                <Users className="text-purple-500 w-6 h-6" />
              </div>
            </div>
            <div className="mt-4 flex items-center text-gray-400 text-sm">
              <span>Lifetime Value</span>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* FAKE LIST */}
      <Card className="bg-white/5 border-white/10">
        <CardHeader>
            <CardTitle>Real-Time Feed</CardTitle>
        </CardHeader>
        <CardContent>
            <div className="space-y-4">
                {[
                    { text: "New Booking: 4-Ball @ 14:00 (R600 Deposit Paid)", time: "2 min ago", color: "text-green-400" },
                    { text: "Reminder Sent: John Doe (Tomorrow 09:00)", time: "5 min ago", color: "text-blue-400" },
                    { text: "System Auto-Filled Slot: 16:00 (Rainy Day Protocol)", time: "12 min ago", color: "text-purple-400" },
                    { text: "Payment Verified: Sarah Smith", time: "15 min ago", color: "text-green-400" },
                ].map((item, i) => (
                    <div key={i} className="flex justify-between items-center border-b border-white/5 pb-4 last:border-0">
                        <div className="flex items-center gap-3">
                            <div className="h-2 w-2 rounded-full bg-primary animate-pulse" />
                            <span className={`font-mono text-sm ${item.color}`}>{item.text}</span>
                        </div>
                        <span className="text-xs text-gray-500">{item.time}</span>
                    </div>
                ))}
            </div>
        </CardContent>
      </Card>
    </div>
  )
}
</file>

<file path="components/admin/availability-manager.tsx">
"use client"

import { useState } from "react"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Calendar } from "@/components/ui/calendar"
import { Badge } from "@/components/ui/badge"
import { Switch } from "@/components/ui/switch"
import { Plus, Clock } from "lucide-react"

export function AvailabilityManager() {
  const [selectedDate, setSelectedDate] = useState<Date | undefined>(new Date())

  // Sample time slots (would be fetched from API)
  const timeSlots = [
    { time: "06:00", available: true, bookings: 0, capacity: 2 },
    { time: "07:00", available: true, bookings: 1, capacity: 2 },
    { time: "08:00", available: true, bookings: 2, capacity: 2 },
    { time: "09:00", available: true, bookings: 0, capacity: 2 },
    { time: "10:00", available: true, bookings: 1, capacity: 2 },
    { time: "11:00", available: true, bookings: 0, capacity: 2 },
    { time: "12:00", available: true, bookings: 2, capacity: 2 },
    { time: "13:00", available: true, bookings: 1, capacity: 2 },
    { time: "14:00", available: true, bookings: 0, capacity: 2 },
    { time: "15:00", available: true, bookings: 0, capacity: 2 },
    { time: "16:00", available: true, bookings: 2, capacity: 2 },
    { time: "17:00", available: true, bookings: 1, capacity: 2 },
    { time: "18:00", available: true, bookings: 2, capacity: 2 },
    { time: "19:00", available: true, bookings: 1, capacity: 2 },
    { time: "20:00", available: true, bookings: 0, capacity: 2 },
    { time: "21:00", available: true, bookings: 0, capacity: 2 },
  ]

  return (
    <div className="grid lg:grid-cols-3 gap-6">
      {/* Calendar */}
      <Card className="lg:col-span-1">
        <CardHeader>
          <CardTitle>Select Date</CardTitle>
          <CardDescription>Choose a date to manage availability</CardDescription>
        </CardHeader>
        <CardContent>
          <Calendar mode="single" selected={selectedDate} onSelect={setSelectedDate} className="rounded-md border" />
          <div className="mt-4 space-y-2">
            <Button className="w-full bg-primary text-primary-foreground hover:bg-primary/90">
              <Plus className="w-4 h-4 mr-2" />
              Add Holiday
            </Button>
            <Button variant="outline" className="w-full bg-transparent">
              Bulk Edit Availability
            </Button>
          </div>
        </CardContent>
      </Card>

      {/* Time Slots */}
      <Card className="lg:col-span-2">
        <CardHeader>
          <CardTitle>Time Slots for {selectedDate?.toLocaleDateString()}</CardTitle>
          <CardDescription>Toggle availability and view bookings for each time slot</CardDescription>
        </CardHeader>
        <CardContent>
          <div className="grid md:grid-cols-2 gap-3">
            {timeSlots.map((slot) => (
              <div
                key={slot.time}
                className="flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors"
              >
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center">
                    <Clock className="w-5 h-5 text-primary" />
                  </div>
                  <div>
                    <p className="font-semibold text-foreground">{slot.time}</p>
                    <div className="flex items-center gap-2 mt-1">
                      <Badge
                        variant="outline"
                        className={
                          slot.bookings >= slot.capacity
                            ? "bg-destructive/10 text-destructive border-destructive/20"
                            : "bg-primary/10 text-primary border-primary/20"
                        }
                      >
                        {slot.bookings}/{slot.capacity} booked
                      </Badge>
                    </div>
                  </div>
                </div>
                <div className="flex items-center gap-3">
                  <Switch checked={slot.available} />
                </div>
              </div>
            ))}
          </div>
        </CardContent>
      </Card>
    </div>
  )
}
</file>

<file path="components/admin/bookings-table.tsx">
"use client"

import { useState, useEffect } from "react"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"
import { Input } from "@/components/ui/input"
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/table"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"
import { Search, Download, Eye, X } from "lucide-react"
import { createClient } from "@/lib/supabase/client"
import type { Booking } from "@/lib/types"

export function BookingsTable() {
  const [bookings, setBookings] = useState<Booking[]>([])
  const [loading, setLoading] = useState(true)
  const [searchTerm, setSearchTerm] = useState("")
  const [statusFilter, setStatusFilter] = useState("all")

  useEffect(() => {
    fetchBookings()
  }, [])

  const fetchBookings = async () => {
    const supabase = createClient()
    const { data, error } = await supabase
      .from("bookings")
      .select("*")
      .order("booking_date", { ascending: false })
      .order("start_time", { ascending: false })
      .limit(50)

    if (error) {
      console.error("[v0] Error fetching bookings:", error)
    } else {
      setBookings(data || [])
    }
    setLoading(false)
  }

  const handleCancelBooking = async (bookingId: string) => {
    if (!confirm("Are you sure you want to cancel this booking?")) return

    const supabase = createClient()
    const { error } = await supabase
      .from("bookings")
      .update({ status: "cancelled", cancelled_at: new Date().toISOString() })
      .eq("id", bookingId)

    if (error) {
      console.error("[v0] Error cancelling booking:", error)
      alert("Failed to cancel booking")
    } else {
      fetchBookings()
    }
  }

  const filteredBookings = bookings.filter((booking) => {
    const matchesSearch =
      booking.guest_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
      booking.guest_email?.toLowerCase().includes(searchTerm.toLowerCase()) ||
      booking.id.toLowerCase().includes(searchTerm.toLowerCase())

    const matchesStatus = statusFilter === "all" || booking.status === statusFilter

    return matchesSearch && matchesStatus
  })

  const getStatusColor = (status: string) => {
    switch (status) {
      case "confirmed":
        return "bg-primary text-primary-foreground"
      case "pending":
        return "bg-secondary/20 text-secondary"
      case "cancelled":
        return "bg-destructive/20 text-destructive"
      case "completed":
        return "bg-muted text-muted-foreground"
      default:
        return "bg-muted text-muted-foreground"
    }
  }

  return (
    <Card>
      <CardHeader>
        <div className="flex items-center justify-between">
          <div>
            <CardTitle>All Bookings</CardTitle>
            <CardDescription>Manage and view all booking details</CardDescription>
          </div>
          <Button variant="outline" size="sm">
            <Download className="w-4 h-4 mr-2" />
            Export CSV
          </Button>
        </div>
      </CardHeader>
      <CardContent>
        {/* Filters */}
        <div className="flex gap-3 mb-6">
          <div className="relative flex-1">
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground" />
            <Input
              placeholder="Search by name, email, or booking ID..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="pl-9"
            />
          </div>
          <Select value={statusFilter} onValueChange={setStatusFilter}>
            <SelectTrigger className="w-[180px]">
              <SelectValue placeholder="Filter by status" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="all">All Status</SelectItem>
              <SelectItem value="pending">Pending</SelectItem>
              <SelectItem value="confirmed">Confirmed</SelectItem>
              <SelectItem value="completed">Completed</SelectItem>
              <SelectItem value="cancelled">Cancelled</SelectItem>
            </SelectContent>
          </Select>
        </div>

        {/* Table */}
        <div className="border rounded-lg">
          <Table>
            <TableHeader>
              <TableRow>
                <TableHead>Booking ID</TableHead>
                <TableHead>Guest</TableHead>
                <TableHead>Date & Time</TableHead>
                <TableHead>Players</TableHead>
                <TableHead>Duration</TableHead>
                <TableHead>Total</TableHead>
                <TableHead>Status</TableHead>
                <TableHead>Actions</TableHead>
              </TableRow>
            </TableHeader>
            <TableBody>
              {loading ? (
                <TableRow>
                  <TableCell colSpan={8} className="text-center py-8 text-muted-foreground">
                    Loading bookings...
                  </TableCell>
                </TableRow>
              ) : filteredBookings.length === 0 ? (
                <TableRow>
                  <TableCell colSpan={8} className="text-center py-8 text-muted-foreground">
                    No bookings found
                  </TableCell>
                </TableRow>
              ) : (
                filteredBookings.map((booking) => (
                  <TableRow key={booking.id}>
                    <TableCell className="font-mono text-xs">{booking.id.slice(0, 8)}...</TableCell>
                    <TableCell>
                      <div>
                        <p className="font-medium text-foreground">{booking.guest_name}</p>
                        <p className="text-xs text-muted-foreground">{booking.guest_email}</p>
                      </div>
                    </TableCell>
                    <TableCell>
                      <div>
                        <p className="font-medium text-foreground">{booking.booking_date}</p>
                        <p className="text-xs text-muted-foreground">{booking.start_time}</p>
                      </div>
                    </TableCell>
                    <TableCell>{booking.player_count}</TableCell>
                    <TableCell>{booking.duration_hours}h</TableCell>
                    <TableCell className="font-semibold text-foreground">R{booking.total_price.toFixed(2)}</TableCell>
                    <TableCell>
                      <Badge className={`${getStatusColor(booking.status)} border-0 capitalize`}>
                        {booking.status}
                      </Badge>
                    </TableCell>
                    <TableCell>
                      <div className="flex gap-2">
                        <Button variant="ghost" size="sm">
                          <Eye className="w-4 h-4" />
                        </Button>
                        {booking.status === "confirmed" && (
                          <Button variant="ghost" size="sm" onClick={() => handleCancelBooking(booking.id)}>
                            <X className="w-4 h-4 text-destructive" />
                          </Button>
                        )}
                      </div>
                    </TableCell>
                  </TableRow>
                ))
              )}
            </TableBody>
          </Table>
        </div>
      </CardContent>
    </Card>
  )
}
</file>

<file path="components/admin/competitions-manager.tsx">
"use client"

import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"
import { Switch } from "@/components/ui/switch"
import { Trophy, Plus, Users } from "lucide-react"

export function CompetitionsManager() {
  const competitions = [
    {
      id: "1",
      name: "Monthly Longest Drive Challenge",
      type: "longest_drive",
      startDate: "2025-01-01",
      endDate: "2025-01-31",
      prize: "R2000 Pro Shop Voucher",
      entries: 45,
      isActive: true,
    },
    {
      id: "2",
      name: "Closest to the Pin Competition",
      type: "closest_to_pin",
      startDate: "2025-01-01",
      endDate: "2025-01-31",
      prize: "Free 2-Hour Session",
      entries: 38,
      isActive: true,
    },
  ]

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div>
          <h2 className="text-2xl font-bold text-foreground">Competitions</h2>
          <p className="text-muted-foreground">Manage monthly competitions and view entries</p>
        </div>
        <Button className="bg-primary text-primary-foreground hover:bg-primary/90">
          <Plus className="w-4 h-4 mr-2" />
          Create Competition
        </Button>
      </div>

      {/* Active Competitions */}
      <div className="grid md:grid-cols-2 gap-6">
        {competitions.map((competition) => (
          <Card key={competition.id}>
            <CardHeader>
              <div className="flex items-start justify-between">
                <div className="flex items-start gap-3">
                  <div className="w-10 h-10 rounded-lg bg-secondary/20 flex items-center justify-center flex-shrink-0">
                    <Trophy className="w-5 h-5 text-secondary" />
                  </div>
                  <div>
                    <CardTitle className="text-lg">{competition.name}</CardTitle>
                    <CardDescription className="mt-1">
                      {new Date(competition.startDate).toLocaleDateString()} -{" "}
                      {new Date(competition.endDate).toLocaleDateString()}
                    </CardDescription>
                  </div>
                </div>
                <Switch checked={competition.isActive} />
              </div>
            </CardHeader>
            <CardContent className="space-y-4">
              <div className="flex items-center gap-4">
                <div className="flex items-center gap-2">
                  <Users className="w-4 h-4 text-muted-foreground" />
                  <span className="text-sm text-muted-foreground">{competition.entries} entries</span>
                </div>
                <Badge className="bg-secondary/20 text-secondary border-0">{competition.type.replace("_", " ")}</Badge>
              </div>
              <div className="p-3 bg-muted/50 rounded-lg">
                <p className="text-sm font-medium text-foreground mb-1">Prize</p>
                <p className="text-sm text-muted-foreground">{competition.prize}</p>
              </div>
              <div className="flex gap-2">
                <Button variant="outline" size="sm" className="flex-1 bg-transparent">
                  View Entries
                </Button>
                <Button variant="outline" size="sm" className="flex-1 bg-transparent">
                  Edit
                </Button>
              </div>
            </CardContent>
          </Card>
        ))}
      </div>

      {/* Leaderboard Preview */}
      <Card>
        <CardHeader>
          <CardTitle>Current Leaderboard</CardTitle>
          <CardDescription>Top performers in active competitions</CardDescription>
        </CardHeader>
        <CardContent>
          <div className="space-y-3">
            {[
              { rank: 1, name: "John Smith", score: 342, competition: "Longest Drive" },
              { rank: 2, name: "Sarah Johnson", score: 338, competition: "Longest Drive" },
              { rank: 3, name: "Mike Williams", score: 325, competition: "Longest Drive" },
              { rank: 1, name: "Emma Davis", score: 1.2, competition: "Closest to Pin" },
              { rank: 2, name: "David Brown", score: 1.8, competition: "Closest to Pin" },
            ].map((entry, index) => (
              <div key={index} className="flex items-center justify-between p-3 border rounded-lg">
                <div className="flex items-center gap-3">
                  <div
                    className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${
                      entry.rank === 1 ? "bg-secondary text-secondary-foreground" : "bg-muted text-muted-foreground"
                    }`}
                  >
                    {entry.rank}
                  </div>
                  <div>
                    <p className="font-semibold text-foreground">{entry.name}</p>
                    <p className="text-xs text-muted-foreground">{entry.competition}</p>
                  </div>
                </div>
                <p className="font-bold text-foreground">
                  {entry.score}
                  {entry.competition === "Closest to Pin" ? "m" : "yds"}
                </p>
              </div>
            ))}
          </div>
        </CardContent>
      </Card>
    </div>
  )
}
</file>

<file path="components/admin/revenue-reports.tsx">
"use client"

import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"
import { Download, TrendingUp, DollarSign, Users, Calendar } from "lucide-react"

export function RevenueReports() {
  return (
    <div className="space-y-6">
      {/* Summary Cards */}
      <div className="grid md:grid-cols-3 gap-4">
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Total Revenue (This Month)</CardDescription>
          </CardHeader>
          <CardContent>
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-lg bg-secondary/20 flex items-center justify-center">
                <DollarSign className="w-5 h-5 text-secondary" />
              </div>
              <div>
                <p className="text-2xl font-bold text-foreground">R186,450</p>
                <p className="text-xs text-muted-foreground flex items-center gap-1">
                  <TrendingUp className="w-3 h-3" />
                  +18% from last month
                </p>
              </div>
            </div>
          </CardContent>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Total Bookings</CardDescription>
          </CardHeader>
          <CardContent>
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center">
                <Calendar className="w-5 h-5 text-primary" />
              </div>
              <div>
                <p className="text-2xl font-bold text-foreground">342</p>
                <p className="text-xs text-muted-foreground">This month</p>
              </div>
            </div>
          </CardContent>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Average Booking Value</CardDescription>
          </CardHeader>
          <CardContent>
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-lg bg-secondary/20 flex items-center justify-center">
                <Users className="w-5 h-5 text-secondary" />
              </div>
              <div>
                <p className="text-2xl font-bold text-foreground">R545</p>
                <p className="text-xs text-muted-foreground">+12% with upsells</p>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Detailed Reports */}
      <Card>
        <CardHeader>
          <div className="flex items-center justify-between">
            <div>
              <CardTitle>Revenue Breakdown</CardTitle>
              <CardDescription>Detailed revenue analysis by period</CardDescription>
            </div>
            <Button variant="outline" size="sm">
              <Download className="w-4 h-4 mr-2" />
              Export Report
            </Button>
          </div>
        </CardHeader>
        <CardContent>
          <Tabs defaultValue="daily">
            <TabsList>
              <TabsTrigger value="daily">Daily</TabsTrigger>
              <TabsTrigger value="weekly">Weekly</TabsTrigger>
              <TabsTrigger value="monthly">Monthly</TabsTrigger>
            </TabsList>
            <TabsContent value="daily" className="space-y-4 mt-6">
              <div className="space-y-3">
                {[
                  { date: "Today", revenue: 8450, bookings: 12, avgValue: 704 },
                  { date: "Yesterday", revenue: 7320, bookings: 10, avgValue: 732 },
                  { date: "2 days ago", revenue: 9180, bookings: 14, avgValue: 656 },
                  { date: "3 days ago", revenue: 6890, bookings: 9, avgValue: 766 },
                  { date: "4 days ago", revenue: 10240, bookings: 16, avgValue: 640 },
                ].map((day) => (
                  <div key={day.date} className="flex items-center justify-between p-4 border rounded-lg">
                    <div>
                      <p className="font-semibold text-foreground">{day.date}</p>
                      <p className="text-sm text-muted-foreground">{day.bookings} bookings</p>
                    </div>
                    <div className="text-right">
                      <p className="font-bold text-foreground">R{day.revenue.toLocaleString()}</p>
                      <p className="text-sm text-muted-foreground">Avg: R{day.avgValue}</p>
                    </div>
                  </div>
                ))}
              </div>
            </TabsContent>
            <TabsContent value="weekly" className="mt-6">
              <p className="text-muted-foreground text-center py-8">Weekly revenue data will be displayed here</p>
            </TabsContent>
            <TabsContent value="monthly" className="mt-6">
              <p className="text-muted-foreground text-center py-8">Monthly revenue data will be displayed here</p>
            </TabsContent>
          </Tabs>
        </CardContent>
      </Card>

      {/* Revenue by Category */}
      <Card>
        <CardHeader>
          <CardTitle>Revenue by Category</CardTitle>
          <CardDescription>Breakdown of revenue sources</CardDescription>
        </CardHeader>
        <CardContent>
          <div className="space-y-4">
            {[
              { category: "Session Bookings", amount: 142300, percentage: 76 },
              { category: "Food & Beverage", amount: 28450, percentage: 15 },
              { category: "Equipment Rental", amount: 10200, percentage: 5 },
              { category: "Lessons", amount: 5500, percentage: 3 },
            ].map((item) => (
              <div key={item.category}>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-foreground">{item.category}</span>
                  <span className="text-sm font-semibold text-foreground">R{item.amount.toLocaleString()}</span>
                </div>
                <div className="w-full bg-muted rounded-full h-2">
                  <div
                    className="bg-primary h-2 rounded-full transition-all"
                    style={{ width: `${item.percentage}%` }}
                  />
                </div>
              </div>
            ))}
          </div>
        </CardContent>
      </Card>
    </div>
  )
}
</file>

<file path="components/BayStatusDisplay.tsx">
"use client"

import { useState } from "react"
import { venueConfig } from "@/lib/venue-config"

export default function BayStatusDisplay() {
  // DEMO MODE: Always show 3 available bays
  // We use the config to determine how many bays to show
  const bays = Array.from({ length: venueConfig.bays }, (_, i) => ({
    id: i + 1,
    status: "available",
    label: `Simulator ${i + 1}`
  }))

  return (
    <div className="w-full">
      {/* Header Badge */}
      <div className="flex justify-center mb-8">
        <div className="bg-green-600 rounded-full px-8 py-3 shadow-lg flex items-center gap-3 animate-pulse">
          <div className="relative flex h-4 w-4">
            <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-white opacity-75"></span>
            <span className="relative inline-flex rounded-full h-4 w-4 bg-white"></span>
          </div>
          <h2 className="text-white font-bold text-xl md:text-2xl tracking-wide uppercase">
            {venueConfig.bays} BAYS AVAILABLE NOW
          </h2>
        </div>
      </div>

      {/* Grid of Bays */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        {bays.map((bay) => (
          <div
            key={bay.id}
            className="relative border-2 rounded-xl p-6 flex flex-col items-center justify-center transition-all duration-500 border-green-500 bg-green-50/50"
          >
            {/* Status Dot */}
            <div className="h-8 w-8 rounded-full mb-4 shadow-sm transition-colors duration-500 bg-green-500" />

            {/* Bay Name */}
            <h3 className="text-xl font-bold text-gray-800 mb-2">{bay.label}</h3>

            {/* Status Pill */}
            <span className="px-4 py-1 rounded-md text-sm font-bold text-white uppercase tracking-wider transition-colors duration-500 bg-gray-800">
              Available
            </span>

            {/* Helper Text */}
            <span className="mt-3 text-xs font-semibold text-green-700">
              Walk-ins Welcome
            </span>
          </div>
        ))}
      </div>
    </div>
  )
}
</file>

<file path="components/booking-confirmation.tsx">
"use client"

import { useState } from "react"
import { useSearchParams, useRouter } from "next/navigation"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { ArrowLeft, Calendar, Clock, Trophy, Mail, Phone, User, Info } from "lucide-react"
import Link from "next/link"
import { Input } from "@/components/ui/input"

// NOTE: We use standard HTML inputs for checkboxes to avoid build errors 
// if Shadcn Checkbox/Label components are missing.

export default function BookingConfirmation() {
  const searchParams = useSearchParams()
  const router = useRouter()
  
  // -- STATE --
  const [isProcessing, setIsProcessing] = useState(false)
  const [errorMessage, setErrorMessage] = useState<string | null>(null)
  
  // -- INPUTS --
  const [guestName, setGuestName] = useState("")
  const [guestEmail, setGuestEmail] = useState("")
  const [guestPhone, setGuestPhone] = useState("")
  const [acceptWhatsApp, setAcceptWhatsApp] = useState(false)
  const [enterCompetition, setEnterCompetition] = useState(false)
  const [couponCode, setCouponCode] = useState("")

  // -- URL PARAMS --
  const sessionType = searchParams.get("sessionType") || "quick"
  const players = parseInt(searchParams.get("players") || "1")
  const date = searchParams.get("date") || ""
  const timeSlot = searchParams.get("timeSlot") || ""
  const duration = parseFloat(searchParams.get("duration") || "1")
  const golfClubRental = searchParams.get("golfClubRental") === "true"
  const coachingSession = searchParams.get("coachingSession") === "true"
  const famousCourseOption = searchParams.get("famousCourseOption") || ""

  // -- CALCULATE PRICE --
  const calculateTotal = () => {
    let base = 0
    if (sessionType === "4ball") base = 150 * 4 * duration
    else if (sessionType === "3ball") base = 160 * 3 * duration
    else {
      const pricing: Record<number, number> = { 1: 250, 2: 180, 3: 160, 4: 150 }
      const pricePerPerson = pricing[Math.min(players, 4)] || 150
      base = pricePerPerson * players * duration
    }
    
    // Add-ons
    if (golfClubRental) base += 100
    if (coachingSession) base += 250
    
    return base
  }

  const basePrice = calculateTotal()
  const totalPrice = basePrice 
  
  // Deposit Logic (40% for Famous/Ball options)
  const isDeposit = sessionType.includes("ball") || sessionType.includes("famous")
  const depositAmount = isDeposit ? Math.ceil(totalPrice * 0.4) : totalPrice
  const payNowAmount = depositAmount

  // --- PAYMENT HANDLER ---
  const handlePayment = async () => {
    // 1. Validation
    if (!guestName || !guestEmail || !guestPhone || !acceptWhatsApp) {
      setErrorMessage("Please fill in all required fields marked with *")
      return
    }

    setIsProcessing(true)
    setErrorMessage(null)

    try {
      const response = await fetch("/api/payment/initialize", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          booking_date: date,
          start_time: timeSlot,
          duration_hours: duration,
          player_count: players,
          session_type: sessionType,
          famous_course_option: famousCourseOption,
          guest_name: guestName,
          guest_email: guestEmail,
          guest_phone: guestPhone,
          accept_whatsapp: acceptWhatsApp,
          enter_competition: enterCompetition,
          base_price: basePrice,
          total_price: totalPrice,
          coupon_code: couponCode || null,
          golf_club_rental: golfClubRental,
          coaching_session: coachingSession
        }),
      })

      const data = await response.json()

      // 409 Conflict (Double Booking)
      if (response.status === 409) {
        setErrorMessage("⚠️ That slot was just grabbed by another player. Please choose another time.")
        setIsProcessing(false)
        return
      }

      // Generic Error
      if (!response.ok) {
        throw new Error(data.error || "Payment initialization failed")
      }

      // Success (Free)
      if (data.free_booking && data.booking_id) {
        router.push(`/booking/success?reference=${data.booking_id}`)
        return
      }
      
      // Success (Redirect to Yoco)
      const paymentUrl = data.redirectUrl || data.authorization_url;
      if (paymentUrl) {
        window.location.href = paymentUrl;
        return;
      }

    } catch (error) {
      console.error("Booking Error:", error)
      setErrorMessage(error instanceof Error ? error.message : "Something went wrong.")
      setIsProcessing(false)
    }
  }

  const formattedDate = date
    ? new Date(date).toLocaleDateString("en-ZA", {
        weekday: "short", day: "numeric", month: "short",
      })
    : ""

  return (
    <div className="min-h-screen bg-background pb-20 pt-10">
      <div className="max-w-lg mx-auto px-4 py-6">
        
        {/* Header */}
        <Link href="/booking" className="inline-flex items-center text-sm text-muted-foreground hover:text-primary mb-6">
          <ArrowLeft className="w-4 h-4 mr-1" />
          Back to options
        </Link>
        
        <h1 className="text-2xl font-bold mb-6">Confirm Details</h1>

        {/* Summary Card */}
        <Card className="mb-6 border-0 shadow-md overflow-hidden">
          <div className="h-2 bg-primary w-full" />
          <CardContent className="p-6 space-y-4">
            <div className="flex justify-between items-start">
              <div>
                <p className="font-semibold text-lg">{sessionType === "4ball" ? "4-Ball Special" : sessionType === "3ball" ? "3-Ball Special" : "Quick Play Session"}</p>
                <p className="text-sm text-muted-foreground">{duration} Hours • {players} Players</p>
              </div>
              <div className="bg-primary/10 p-2 rounded-lg">
                <Trophy className="w-6 h-6 text-primary" />
              </div>
            </div>
            
            <hr className="border-t border-border" />
            
            <div className="grid grid-cols-2 gap-4 text-sm">
              <div className="flex items-center gap-2">
                <Calendar className="w-4 h-4 text-muted-foreground" />
                <span>{formattedDate}</span>
              </div>
              <div className="flex items-center gap-2">
                <Clock className="w-4 h-4 text-muted-foreground" />
                <span>{timeSlot}</span>
              </div>
            </div>

            {/* Price Breakdown */}
            <div className="bg-muted/50 p-4 rounded-lg space-y-2 mt-4">
              <div className="flex justify-between text-sm">
                <span>Total Value</span>
                <span>R{totalPrice}</span>
              </div>
              
              {isDeposit && (
                <div className="flex justify-between text-sm text-muted-foreground">
                  <span>Pay Later (In Store)</span>
                  <span>- R{totalPrice - depositAmount}</span>
                </div>
              )}
              
              <div className="flex justify-between font-bold text-lg pt-2 border-t border-border/50">
                <span>Pay Now</span>
                <span className="text-primary">R{payNowAmount}</span>
              </div>
            </div>
          </CardContent>
        </Card>

        {/* Customer Form */}
        <Card className="border-0 shadow-md">
           <CardHeader>
             <CardTitle className="text-lg">Your Details</CardTitle>
           </CardHeader>
           <CardContent className="space-y-4">
             
             {/* Name */}
             <div className="space-y-2">
               <label htmlFor="name" className="text-sm font-medium leading-none">Full Name *</label>
               <div className="relative">
                 <User className="absolute left-3 top-2.5 h-4 w-4 text-muted-foreground" />
                 <Input 
                   id="name" 
                   placeholder="John Doe" 
                   className="pl-9"
                   value={guestName}
                   onChange={(e) => setGuestName(e.target.value)}
                 />
               </div>
             </div>

             {/* Email */}
             <div className="space-y-2">
               <label htmlFor="email" className="text-sm font-medium leading-none">Email Address *</label>
               <div className="relative">
                 <Mail className="absolute left-3 top-2.5 h-4 w-4 text-muted-foreground" />
                 <Input 
                   id="email" 
                   type="email" 
                   placeholder="john@example.com" 
                   className="pl-9"
                   value={guestEmail}
                   onChange={(e) => setGuestEmail(e.target.value)}
                 />
               </div>
             </div>

             {/* Phone */}
             <div className="space-y-2">
               <label htmlFor="phone" className="text-sm font-medium leading-none">Phone Number *</label>
               <div className="relative">
                 <Phone className="absolute left-3 top-2.5 h-4 w-4 text-muted-foreground" />
                 <Input 
                   id="phone" 
                   type="tel" 
                   placeholder="082 123 4567" 
                   className="pl-9"
                   value={guestPhone}
                   onChange={(e) => setGuestPhone(e.target.value)}
                 />
               </div>
             </div>
            
             {/* Coupon Code */}
             <div className="space-y-2 pt-2">
               <label htmlFor="coupon" className="text-sm font-medium leading-none">Coupon Code (Optional)</label>
               <Input 
                 id="coupon" 
                 placeholder="Enter code" 
                 value={couponCode}
                 onChange={(e) => setCouponCode(e.target.value)}
               />
             </div>

             {/* Checkboxes (Standard HTML) */}
             <div className="space-y-4 pt-4">
               <div className="flex items-start space-x-2">
                 <input 
                    type="checkbox"
                    id="whatsapp"
                    className="mt-1 h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"
                    checked={acceptWhatsApp}
                    onChange={(e) => setAcceptWhatsApp(e.target.checked)}
                 />
                 <label htmlFor="whatsapp" className="text-sm leading-snug cursor-pointer">
                   I accept receiving booking confirmation via WhatsApp/SMS *
                 </label>
               </div>
               
               <div className="flex items-start space-x-2">
                 <input 
                    type="checkbox"
                    id="competition"
                    className="mt-1 h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"
                    checked={enterCompetition}
                    onChange={(e) => setEnterCompetition(e.target.checked)}
                 />
                 <label htmlFor="competition" className="text-sm leading-snug cursor-pointer text-muted-foreground">
                   Enter me into the monthly "Free Round" competition
                 </label>
               </div>
             </div>

             {/* Error Message */}
             {errorMessage && (
                <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm flex items-start gap-2 animate-in fade-in">
                  <Info className="w-5 h-5 flex-shrink-0 mt-0.5" />
                  <p className="font-medium">{errorMessage}</p>
                </div>
              )}

             {/* Action Button */}
             <Button 
               className="w-full h-12 text-lg font-bold mt-2" 
               onClick={handlePayment}
               disabled={isProcessing}
             >
               {isProcessing ? "Processing..." : `Pay R${payNowAmount}`}
             </Button>
             
             <p className="text-xs text-center text-muted-foreground pt-2">
               Secure payment via Yoco. 
             </p>

           </CardContent>
        </Card>
      </div>
    </div>
  )
}
</file>

<file path="components/booking-flow.tsx">
"use client"

import { useState, useEffect, useCallback, useRef } from "react"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Calendar } from "@/components/ui/calendar"
import { cn } from "@/lib/utils"
// FIXED: Added Loader2 to the imports below
import { ArrowLeft, ArrowRight, Users, CalendarIcon, Clock, Check, Trophy, Zap, Sparkles, Loader2 } from "lucide-react"
import { format, addDays, startOfToday, isToday, isTomorrow, isWeekend, getDay } from "date-fns"

const PRICING = {
  1: 250,
  2: 180,
  3: 160,
  4: 150,
} as const

// Operating hours by day of week
const OPERATING_HOURS: Record<number, { open: number; close: number }> = {
  0: { open: 10, close: 16 }, // Sunday
  1: { open: 9, close: 20 }, // Monday
  2: { open: 9, close: 20 }, // Tuesday
  3: { open: 9, close: 20 }, // Wednesday
  4: { open: 9, close: 20 }, // Thursday
  5: { open: 9, close: 20 }, // Friday
  6: { open: 8, close: 20 }, // Saturday
}

interface BookingFlowProps {
  onComplete?: (booking: BookingData) => void
}

interface BookingData {
  sessionType: string
  players: number
  date: Date
  timeSlot: string
  duration: number
  customerName: string
  customerEmail: string
  customerPhone: string
  golfClubRental: boolean
  coachingSession: boolean
  totalPrice: number
}

export function BookingFlow({ onComplete }: BookingFlowProps) {
  // --- REFS FOR AUTO-SCROLL ---
  const topRef = useRef<HTMLDivElement>(null)
  const timeSlotsRef = useRef<HTMLDivElement>(null)
  const footerRef = useRef<HTMLDivElement>(null)

  // Form state
  const [step, setStep] = useState(1)
  const [sessionType, setSessionType] = useState<"4ball" | "3ball" | "quick" | "">("")
  const [players, setPlayers] = useState(1)
  const [date, setDate] = useState<Date | undefined>(undefined)
  const [timeSlot, setTimeSlot] = useState("")
  const [duration, setDuration] = useState(1)
  const [golfClubRental, setGolfClubRental] = useState(false)
  const [coachingSession, setCoachingSession] = useState(false)

  // Availability state
  const [bookedSlots, setBookedSlots] = useState<string[]>([])
  const [isCheckingAvailability, setIsCheckingAvailability] = useState(false)
  const [availabilityError, setAvailabilityError] = useState<string | null>(null)

  // --- AUTO SCROLL LOGIC ---
  
  // 1. Scroll to top when Step changes
  useEffect(() => {
    if (topRef.current) {
      topRef.current.scrollIntoView({ behavior: 'smooth', block: 'start' })
    }
  }, [step])

  // 2. Scroll to Time Slots when Date is selected
  useEffect(() => {
    if (date && timeSlotsRef.current) {
      // Small delay to allow UI to render
      setTimeout(() => {
        timeSlotsRef.current?.scrollIntoView({ behavior: 'smooth', block: 'center' })
      }, 100)
    }
  }, [date])

  const calculatePrice = useCallback(() => {
    let basePrice = 0

    if (sessionType === "4ball") {
      basePrice = 150 * 4 * duration
    } else if (sessionType === "3ball") {
      basePrice = 160 * 3 * duration
    } else {
      const pricePerPerson = PRICING[Math.min(players, 4) as keyof typeof PRICING]
      basePrice = pricePerPerson * players * duration
    }

    if (golfClubRental) basePrice += 100
    if (coachingSession) basePrice += 250

    return basePrice
  }, [sessionType, players, duration, golfClubRental, coachingSession])

  const getPricePerPersonPerHour = useCallback(() => {
    if (sessionType === "4ball") return 150
    if (sessionType === "3ball") return 160
    return PRICING[Math.min(players, 4) as keyof typeof PRICING]
  }, [sessionType, players])

  const getMinDuration = useCallback(() => {
    if (sessionType === "4ball" || sessionType === "3ball") return 3
    return 1
  }, [sessionType])

  const generateTimeSlots = useCallback((selectedDate: Date): string[] => {
    const dayOfWeek = getDay(selectedDate)
    const hours = OPERATING_HOURS[dayOfWeek]
    const slots: string[] = []

    for (let hour = hours.open; hour < hours.close; hour++) {
      slots.push(`${hour.toString().padStart(2, "0")}:00`)
      if (hour + 0.5 < hours.close) {
        slots.push(`${hour.toString().padStart(2, "0")}:30`)
      }
    }
    return slots
  }, [])

  const availableSlots = date ? generateTimeSlots(date) : []

  const fetchBookedSlots = useCallback(async (selectedDate: Date) => {
    setIsCheckingAvailability(true)
    setAvailabilityError(null)
    try {
      const dateStr = format(selectedDate, "yyyy-MM-dd")
      const response = await fetch(`/api/bookings/availability?date=${dateStr}`)
      const data = await response.json()

      if (data.bookedSlots && Array.isArray(data.bookedSlots)) {
        setBookedSlots(data.bookedSlots)
      } else {
        setBookedSlots([])
      }

      if (data.error) setAvailabilityError(data.error)
    } catch (error) {
      console.error("Error fetching availability:", error)
      setBookedSlots([])
      setAvailabilityError("Could not check availability")
    } finally {
      setIsCheckingAvailability(false)
    }
  }, [])

  useEffect(() => {
    if (date) fetchBookedSlots(date)
  }, [date, fetchBookedSlots])

  useEffect(() => {
    const minDur = getMinDuration()
    if (duration < minDur) setDuration(minDur)
  }, [sessionType, getMinDuration, duration])

  const isSlotBooked = useCallback((slot: string) => {
    if (bookedSlots.includes(slot)) return true
    if (date && isToday(date)) {
      const now = new Date()
      const [hours, minutes] = slot.split(':').map(Number)
      const slotDate = new Date(date)
      slotDate.setHours(hours, minutes, 0, 0)
      if (slotDate <= now) return true
    }
    return false
  }, [bookedSlots, date])

  const handleSessionSelect = (type: "4ball" | "3ball" | "quick") => {
    setSessionType(type)
    if (type === "4ball") {
      setPlayers(4)
      setDuration(3)
    } else if (type === "3ball") {
      setPlayers(3)
      setDuration(3)
    } else {
      setDuration(1)
    }
  }

  const getNextWeekend = () => {
    const today = startOfToday()
    const dayOfWeek = today.getDay()
    const daysUntilSaturday = dayOfWeek === 6 ? 0 : 6 - dayOfWeek
    return addDays(today, daysUntilSaturday)
  }

  const canProceed = () => {
    switch (step) {
      case 1: return sessionType !== ""
      case 2: return date !== undefined && timeSlot !== ""
      default: return false
    }
  }

  const handleNext = () => {
    if (canProceed() && step < 2) {
      setStep(step + 1)
    } else if (step === 2 && canProceed()) {
      const params = new URLSearchParams({
        sessionType,
        players: players.toString(),
        date: date ? format(date, "yyyy-MM-dd") : "",
        timeSlot,
        duration: duration.toString(),
        golfClubRental: golfClubRental.toString(),
        coachingSession: coachingSession.toString(),
      })
      window.location.href = `/booking/confirm?${params.toString()}`
    }
  }

  const handleBack = () => {
    if (step > 1) setStep(step - 1)
  }

  const durationOptions = [1, 1.5, 2, 2.5, 3, 3.5, 4]
  const minDuration = getMinDuration()

  return (
    <div className="w-full max-w-lg mx-auto pb-32" ref={topRef}>
      <div className="text-center mb-6 pt-4">
        <div className="inline-flex items-center gap-2 bg-primary/10 text-primary px-4 py-2 rounded-full text-sm font-medium mb-4">
          <Sparkles className="w-4 h-4" />
          Premium Experience
        </div>
        <h1 className="text-2xl font-bold text-foreground">Book Your Session</h1>
        <p className="text-muted-foreground mt-1">
          {step === 1 ? "Choose your experience" : "Select date & time"}
        </p>
      </div>

      <div className="flex items-center justify-center gap-2 mb-8">
        {[1, 2].map((s) => (
          <div key={s} className="flex items-center">
            <div
              className={cn(
                "w-10 h-10 rounded-full flex items-center justify-center font-semibold transition-all",
                s < step
                  ? "bg-primary text-primary-foreground"
                  : s === step
                    ? "bg-primary text-primary-foreground shadow-lg scale-110" // Visual Pop for active step
                    : "bg-muted text-muted-foreground",
              )}
            >
              {s < step ? <Check className="w-5 h-5" /> : s}
            </div>
            {s < 2 && <div className={cn("w-16 h-0.5 mx-2", s < step ? "bg-primary" : "bg-muted")} />}
          </div>
        ))}
      </div>

      {/* Step 1: Session Selection */}
      {step === 1 && (
        <div className="space-y-6 px-4">
          <div>
            <div className="flex items-center gap-2 mb-4">
              <Trophy className="w-5 h-5 text-amber-600" />
              <h2 className="font-semibold text-foreground">Famous Courses</h2>
            </div>
            <div className="space-y-3">
              <button
                onClick={() => handleSessionSelect("4ball")}
                className={cn(
                  "w-full p-4 rounded-xl border-2 text-left transition-all active:scale-[0.98]",
                  "flex items-start gap-4",
                  sessionType === "4ball" ? "border-primary bg-primary/5 shadow-sm ring-1 ring-primary" : "border-border hover:border-primary/50",
                )}
              >
                <div className="w-12 h-12 rounded-xl bg-amber-100 flex items-center justify-center flex-shrink-0">
                  <Trophy className="w-6 h-6 text-amber-600" />
                </div>
                <div className="flex-1 min-w-0">
                  <div className="flex items-center gap-2 flex-wrap">
                    <span className="font-semibold text-foreground">4-Ball Special</span>
                    <span className="text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full">Best Value</span>
                  </div>
                  <p className="text-sm text-muted-foreground mt-1">Play world-famous courses with 4 players</p>
                  <div className="mt-2">
                    <span className="text-xl font-bold text-foreground">R150</span>
                    <span className="text-muted-foreground text-sm"> /person/hour</span>
                  </div>
                </div>
              </button>

              <button
                onClick={() => handleSessionSelect("3ball")}
                className={cn(
                  "w-full p-4 rounded-xl border-2 text-left transition-all active:scale-[0.98]",
                  "flex items-start gap-4",
                  sessionType === "3ball" ? "border-primary bg-primary/5 shadow-sm ring-1 ring-primary" : "border-border hover:border-primary/50",
                )}
              >
                <div className="w-12 h-12 rounded-xl bg-teal-100 flex items-center justify-center flex-shrink-0">
                  <Trophy className="w-6 h-6 text-teal-600" />
                </div>
                <div className="flex-1 min-w-0">
                  <span className="font-semibold text-foreground">3-Ball Special</span>
                  <div className="mt-2">
                    <span className="text-xl font-bold text-foreground">R160</span>
                    <span className="text-muted-foreground text-sm"> /person/hour</span>
                  </div>
                </div>
              </button>
            </div>
          </div>

          <div>
            <div className="flex items-center gap-2 mb-4">
              <Zap className="w-5 h-5 text-primary" />
              <h2 className="font-semibold text-foreground">Quick Play</h2>
            </div>
            <button
              onClick={() => handleSessionSelect("quick")}
              className={cn(
                "w-full p-4 rounded-xl border-2 text-left transition-all active:scale-[0.98]",
                "flex items-start gap-4",
                sessionType === "quick" ? "border-primary bg-primary/5 shadow-sm ring-1 ring-primary" : "border-border hover:border-primary/50",
              )}
            >
              <div className="w-12 h-12 rounded-xl bg-primary/10 flex items-center justify-center flex-shrink-0">
                <Zap className="w-6 h-6 text-primary" />
              </div>
              <div className="flex-1 min-w-0">
                <span className="font-semibold text-foreground">Quick Play Session</span>
                <div className="mt-2">
                  <span className="text-lg font-bold text-foreground">From R150</span>
                  <span className="text-muted-foreground text-sm"> /person/hour</span>
                </div>
              </div>
            </button>
          </div>

          {sessionType === "quick" && (
            <div className="animate-in fade-in slide-in-from-top-4 duration-500">
              <div className="flex items-center gap-2 mb-4">
                <Users className="w-5 h-5 text-muted-foreground" />
                <h2 className="font-semibold text-foreground">Number of Players</h2>
              </div>
              <div className="bg-card border border-border rounded-xl p-4">
                <div className="grid grid-cols-4 gap-2">
                  {[1, 2, 3, 4].map((num) => (
                    <button
                      key={num}
                      onClick={() => setPlayers(num)}
                      className={cn(
                        "py-4 rounded-xl font-semibold transition-all flex flex-col items-center",
                        players === num
                          ? "bg-primary text-primary-foreground shadow-md scale-105"
                          : "bg-muted/50 hover:bg-muted text-foreground",
                      )}
                    >
                      <span className="text-xl">{num}</span>
                    </button>
                  ))}
                </div>
              </div>
            </div>
          )}

          {sessionType && (
            <div className="animate-in fade-in slide-in-from-top-4 duration-500">
              <div className="flex items-center gap-2 mb-4">
                <Clock className="w-5 h-5 text-muted-foreground" />
                <h2 className="font-semibold text-foreground">Session Duration</h2>
              </div>
              <div className="bg-card border border-border rounded-xl p-4">
                <div className="flex flex-wrap gap-2">
                  {durationOptions
                    .filter((d) => d >= minDuration)
                    .map((d) => (
                      <button
                        key={d}
                        onClick={() => setDuration(d)}
                        className={cn(
                          "px-4 py-2.5 rounded-xl font-medium transition-all",
                          duration === d
                            ? "bg-primary text-primary-foreground shadow-md scale-105"
                            : "bg-muted/50 hover:bg-muted text-foreground",
                        )}
                      >
                        {d}h
                      </button>
                    ))}
                </div>
              </div>
            </div>
          )}
        </div>
      )}

      {/* Step 2: Date & Time Selection */}
      {step === 2 && (
        <div className="space-y-4 px-4">
          <Card className="overflow-hidden border-0 shadow-lg">
            <CardHeader className="bg-gradient-to-br from-primary via-primary to-primary/90 text-primary-foreground pb-4">
              <CardTitle className="text-lg font-semibold flex items-center gap-3">
                <CalendarIcon className="w-5 h-5" />
                Select Your Date
              </CardTitle>
            </CardHeader>
            <CardContent className="p-0">
              <div className="p-4 border-b border-border/50 bg-muted/30">
                <div className="flex gap-2 overflow-x-auto pb-1 no-scrollbar">
                  {[
                    { label: "Today", date: startOfToday(), check: isToday },
                    { label: "Tomorrow", date: addDays(startOfToday(), 1), check: isTomorrow },
                    {
                      label: "This Weekend",
                      date: getNextWeekend(),
                      check: (d: Date) => isWeekend(d) && d <= addDays(startOfToday(), 7),
                    },
                  ].map((option) => (
                    <button
                      key={option.label}
                      onClick={() => setDate(option.date)}
                      className={cn(
                        "flex-shrink-0 px-4 py-2.5 rounded-full text-sm font-medium transition-all",
                        "border-2 active:scale-95",
                        date && option.check(date)
                          ? "bg-primary text-primary-foreground border-primary shadow-sm"
                          : "bg-card border-border hover:border-primary/50",
                      )}
                    >
                      {option.label}
                    </button>
                  ))}
                </div>
              </div>
              <div className="p-4">
                <Calendar
                  mode="single"
                  selected={date}
                  onSelect={setDate}
                  disabled={(d) => d < new Date(new Date().setHours(0, 0, 0, 0))}
                  className="w-full"
                />
              </div>
            </CardContent>
          </Card>

          {/* Time Slots - Hidden until date selected */}
          {date && (
            <div ref={timeSlotsRef} className="animate-in fade-in slide-in-from-bottom-4 duration-500">
              <Card className="border-0 shadow-lg ring-1 ring-primary/10">
                <CardHeader className="pb-3">
                  <CardTitle className="text-base flex items-center gap-2">
                    <Clock className="w-5 h-5 text-muted-foreground" />
                    Available Times
                  </CardTitle>
                  <p className="text-sm text-muted-foreground">{format(date, "EEEE, MMMM d")}</p>
                </CardHeader>
                <CardContent>
                  {isCheckingAvailability ? (
                    <div className="flex items-center justify-center py-8">
                      <Loader2 className="w-6 h-6 text-primary animate-spin" />
                      <span className="ml-3 text-muted-foreground">Checking...</span>
                    </div>
                  ) : (
                    <div className="grid grid-cols-3 sm:grid-cols-4 gap-2">
                      {availableSlots.map((slot) => {
                        const booked = isSlotBooked(slot)
                        return (
                          <button
                            key={slot}
                            onClick={() => !booked && setTimeSlot(slot)}
                            disabled={booked}
                            className={cn(
                              "py-3 px-2 rounded-xl text-sm font-medium transition-all active:scale-95",
                              booked
                                ? "bg-muted/50 text-muted-foreground cursor-not-allowed line-through opacity-50"
                                : timeSlot === slot
                                  ? "bg-primary text-primary-foreground shadow-md ring-2 ring-primary ring-offset-2"
                                  : "bg-card border border-border hover:border-primary/50 hover:shadow-sm",
                            )}
                          >
                            {slot}
                          </button>
                        )
                      })}
                    </div>
                  )}
                </CardContent>
              </Card>
            </div>
          )}

          {/* Add-ons - Always visible in step 2 */}
          <Card className="border-0 shadow-lg">
            <CardHeader className="pb-3">
              <CardTitle className="text-base">Optional Add-ons</CardTitle>
            </CardHeader>
            <CardContent className="space-y-3">
              <button
                onClick={() => setGolfClubRental(!golfClubRental)}
                className={cn(
                  "w-full flex items-center justify-between p-4 rounded-xl border-2 transition-all",
                  golfClubRental ? "border-primary bg-primary/5 ring-1 ring-primary" : "border-border hover:border-primary/50",
                )}
              >
                <span className="font-medium">Golf Club Rental</span>
                <span className="text-primary font-bold">+R100</span>
              </button>
              {/* Add other add-ons here... */}
            </CardContent>
          </Card>
        </div>
      )}

      {/* Footer */}
      <div ref={footerRef} className="fixed bottom-0 left-0 right-0 bg-gradient-to-r from-primary via-primary to-primary/95 text-primary-foreground p-4 shadow-[0_-5px_20px_rgba(0,0,0,0.1)] z-50 backdrop-blur-sm">
        <div className="max-w-lg mx-auto">
          {sessionType && (
            <div className="flex items-center justify-between mb-3 animate-in slide-in-from-bottom-2">
              <div>
                <p className="text-xs opacity-80 font-medium tracking-wide uppercase">Estimated Total</p>
                <p className="text-2xl font-bold tracking-tight">R{calculatePrice().toLocaleString()}</p>
              </div>
              <div className="text-right">
                <p className="text-xs opacity-80">Per Person</p>
                <p className="text-lg font-semibold">R{getPricePerPersonPerHour()}/hr</p>
              </div>
            </div>
          )}

          <div className="flex gap-3">
            {step > 1 && (
              <Button
                variant="outline"
                onClick={handleBack}
                className="flex-1 h-12 bg-white/10 border-white/20 text-white hover:bg-white/20 transition-colors"
              >
                <ArrowLeft className="w-4 h-4 mr-2" />
                Back
              </Button>
            )}
            <Button
              onClick={handleNext}
              disabled={!canProceed()}
              className={cn(
                "flex-1 h-12 bg-white text-primary hover:bg-white/90 font-bold text-base transition-all",
                canProceed() && "shadow-[0_0_15px_rgba(255,255,255,0.3)] animate-pulse" // Subtle pulse when ready
              )}
            >
              {step === 2 ? "Continue to Details" : "Continue"}
              <ArrowRight className="w-4 h-4 ml-2" />
            </Button>
          </div>
        </div>
      </div>
    </div>
  )
}

export default BookingFlow
</file>

<file path="components/booking-success.tsx">
"use client"

import { useEffect, useState } from "react"
import { useSearchParams, useRouter } from "next/navigation"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { CheckCircle2, Calendar, Clock, Users, Mail, Home, MapPin, Phone } from "lucide-react"
import Link from "next/link"
import { createBrowserClient } from "@/lib/supabase/client"

export function BookingSuccess() {
  const searchParams = useSearchParams()
  const router = useRouter()
  const [booking, setBooking] = useState<any>(null)
  const [loading, setLoading] = useState(true)
  const reference = searchParams.get("reference")

  useEffect(() => {
    const fetchBooking = async () => {
      if (!reference) {
        router.push("/booking")
        return
      }

      const supabase = createBrowserClient()
      const { data, error } = await supabase.from("bookings").select("*").eq("id", reference).single()

      if (error || !data) {
        console.error("[v0] Failed to fetch booking:", error)
        router.push("/booking")
        return
      }

      console.log("[v0] Booking data loaded:", data)
      setBooking(data)
      setLoading(false)
    }

    fetchBooking()
  }, [reference, router])

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-background">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4" />
          <p className="text-muted-foreground">Loading your booking details...</p>
        </div>
      </div>
    )
  }

  if (!booking) {
    return null
  }

  const getSessionDescription = () => {
    if (booking.session_type === "famous-course") {
      if (booking.famous_course_option === "4-ball") {
        return "18-Hole Famous Course • 4-Ball Special"
      }
      if (booking.famous_course_option === "3-ball") {
        return "18-Hole Famous Course • 3-Ball"
      }
      return "18-Hole Famous Course"
    }
    return "Quick Play Session"
  }

  const getDepositAmount = () => {
    if (booking.session_type === "famous-course") {
      if (booking.famous_course_option === "4-ball") return 600 // Updated from 400 to 600
      if (booking.famous_course_option === "3-ball") return 450 // Updated from 300 to 450
    }
    return booking.total_price
  }

  const depositAmount = getDepositAmount()
  const remainderAmount = booking.session_type === "famous-course" ? booking.total_price - depositAmount : 0

  return (
    <div className="min-h-screen py-16 bg-background">
      <div className="container mx-auto px-4">
        <div className="max-w-2xl mx-auto">
          {/* Success Message */}
          <div className="text-center mb-8">
            <div className="w-20 h-20 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4">
              <CheckCircle2 className="w-12 h-12 text-primary" />
            </div>
            <h1 className="font-serif text-3xl md:text-4xl font-bold mb-3 text-foreground">Booking Confirmed!</h1>
            <p className="text-lg text-muted-foreground">
              {booking.accept_whatsapp
                ? "Check your WhatsApp and email for confirmation details"
                : "We've sent a confirmation email with all the details"}
            </p>
          </div>

          {/* Booking Details Card */}
          <Card className="mb-6">
            <CardHeader>
              <div className="flex items-center justify-between">
                <CardTitle>Booking Details</CardTitle>
                <Badge className="bg-primary text-primary-foreground border-0">Confirmed</Badge>
              </div>
              <CardDescription>Reference: {reference}</CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              <div className="grid md:grid-cols-3 gap-4">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center">
                    <Calendar className="w-5 h-5 text-primary" />
                  </div>
                  <div>
                    <p className="text-xs text-muted-foreground">Date</p>
                    <p className="font-semibold text-foreground text-sm">
                      {new Date(booking.booking_date).toLocaleDateString("en-ZA", {
                        month: "short",
                        day: "numeric",
                        year: "numeric",
                      })}
                    </p>
                  </div>
                </div>
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center">
                    <Clock className="w-5 h-5 text-primary" />
                  </div>
                  <div>
                    <p className="text-xs text-muted-foreground">Time</p>
                    <p className="font-semibold text-foreground text-sm">
                      {booking.start_time} ({booking.duration_hours}h)
                    </p>
                  </div>
                </div>
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center">
                    <Users className="w-5 h-5 text-primary" />
                  </div>
                  <div>
                    <p className="text-xs text-muted-foreground">Players</p>
                    <p className="font-semibold text-foreground text-sm">
                      {booking.player_count} player{booking.player_count > 1 ? "s" : ""}
                    </p>
                  </div>
                </div>
              </div>

              <div className="pt-3 border-t">
                <p className="text-sm text-muted-foreground mb-1">Session Type</p>
                <p className="font-semibold text-foreground">{getSessionDescription()}</p>
              </div>

              {booking.session_type === "famous-course" && remainderAmount > 0 && (
                <div className="pt-3 border-t">
                  <p className="text-sm font-semibold text-foreground mb-2">Payment Summary</p>
                  <div className="space-y-1.5">
                    <div className="flex justify-between text-sm">
                      <span className="text-muted-foreground">Deposit Paid Today</span>
                      <span className="font-medium text-foreground">R{depositAmount.toFixed(2)}</span>
                    </div>
                    <div className="flex justify-between text-sm">
                      <span className="text-muted-foreground">Balance Due In-Store</span>
                      <span className="font-medium text-primary">R{remainderAmount.toFixed(2)}</span>
                    </div>
                    <div className="flex justify-between text-sm font-bold pt-1.5 border-t">
                      <span className="text-foreground">Total Session Cost</span>
                      <span className="text-foreground">R{booking.total_price.toFixed(2)}</span>
                    </div>
                  </div>
                </div>
              )}
            </CardContent>
          </Card>

          {/* Location Card */}
          <Card className="mb-6">
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <MapPin className="w-5 h-5 text-primary" />
                The Mulligan Location
              </CardTitle>
            </CardHeader>
            <CardContent className="space-y-3">
              <p className="text-sm text-muted-foreground">
                38A Chopin St, Vanderbijlpark S. W. 5, Vanderbijlpark, 1911, South Africa
              </p>
              <div className="flex flex-col sm:flex-row gap-3">
                <Button variant="outline" size="sm" asChild className="flex-1 bg-transparent">
                  <a
                    href="https://www.google.com/maps/search/?api=1&query=38A+Chopin+St+Vanderbijlpark+S.+W.+5+Vanderbijlpark+1911+South+Africa"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    <MapPin className="w-4 h-4 mr-2" />
                    Get Directions
                  </a>
                </Button>
                <Button variant="outline" size="sm" asChild className="flex-1 bg-transparent">
                  <a href="tel:+27123456789">
                    <Phone className="w-4 h-4 mr-2" />
                    Call Us
                  </a>
                </Button>
              </div>
            </CardContent>
          </Card>

          {/* Next Steps */}
          <Card className="mb-6">
            <CardHeader>
              <CardTitle>What's Next?</CardTitle>
            </CardHeader>
            <CardContent className="space-y-3">
              <div className="flex items-start gap-3">
                <div className="w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-semibold flex-shrink-0 mt-0.5">
                  1
                </div>
                <div>
                  <p className="font-semibold text-foreground">Check Your Messages</p>
                  <p className="text-sm text-muted-foreground">
                    We've sent confirmation via {booking.accept_whatsapp ? "WhatsApp and email" : "email"}
                  </p>
                </div>
              </div>
              <div className="flex items-start gap-3">
                <div className="w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-semibold flex-shrink-0 mt-0.5">
                  2
                </div>
                <div>
                  <p className="font-semibold text-foreground">Arrive 10 Minutes Early</p>
                  <p className="text-sm text-muted-foreground">
                    Give yourself time to check in and get set up at the simulator
                  </p>
                </div>
              </div>
              {booking.session_type === "famous-course" && remainderAmount > 0 && (
                <div className="flex items-start gap-3">
                  <div className="w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-semibold flex-shrink-0 mt-0.5">
                    3
                  </div>
                  <div>
                    <p className="font-semibold text-foreground">Settle Your Balance</p>
                    <p className="text-sm text-muted-foreground">
                      Pay the remaining R{remainderAmount.toFixed(2)} at reception before your session
                    </p>
                  </div>
                </div>
              )}
              <div className="flex items-start gap-3">
                <div className="w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-semibold flex-shrink-0 mt-0.5">
                  {remainderAmount > 0 ? "4" : "3"}
                </div>
                <div>
                  <p className="font-semibold text-foreground">Enjoy Your Session</p>
                  <p className="text-sm text-muted-foreground">
                    Experience Pro Tee simulator with GS Pro software and 400+ championship courses
                  </p>
                </div>
              </div>
            </CardContent>
          </Card>

          {/* Important Info */}
          <Card className="mb-8 border-primary/50 bg-primary/5">
            <CardContent className="pt-6">
              <div className="flex items-start gap-3">
                <Mail className="w-5 h-5 text-primary flex-shrink-0 mt-0.5" />
                <div>
                  <p className="font-semibold text-foreground mb-1">Need to Reschedule?</p>
                  <p className="text-sm text-muted-foreground leading-relaxed">
                    Contact us at least 2 hours before your session to reschedule or cancel. We're here to help make it
                    easy!
                  </p>
                </div>
              </div>
            </CardContent>
          </Card>

          {/* Action Buttons */}
          <div className="flex flex-col sm:flex-row gap-3">
            <Button asChild variant="outline" className="flex-1 bg-transparent">
              <Link href="/">
                <Home className="w-4 h-4 mr-2" />
                Back to Home
              </Link>
            </Button>
            <Button asChild className="flex-1 bg-primary text-primary-foreground hover:bg-primary/90">
              <Link href="/booking">
                <Calendar className="w-4 h-4 mr-2" />
                Book Another Session
              </Link>
            </Button>
          </div>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="components/theme-provider.tsx">
'use client'

import * as React from 'react'
import {
  ThemeProvider as NextThemesProvider,
  type ThemeProviderProps,
} from 'next-themes'

export function ThemeProvider({ children, ...props }: ThemeProviderProps) {
  return <NextThemesProvider {...props}>{children}</NextThemesProvider>
}
</file>

<file path="components/ui/badge.tsx">
import * as React from 'react'
import { Slot } from '@radix-ui/react-slot'
import { cva, type VariantProps } from 'class-variance-authority'

import { cn } from '@/lib/utils'

const badgeVariants = cva(
  'inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden',
  {
    variants: {
      variant: {
        default:
          'border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90',
        secondary:
          'border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90',
        destructive:
          'border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60',
        outline:
          'text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground',
      },
    },
    defaultVariants: {
      variant: 'default',
    },
  },
)

function Badge({
  className,
  variant,
  asChild = false,
  ...props
}: React.ComponentProps<'span'> &
  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : 'span'

  return (
    <Comp
      data-slot="badge"
      className={cn(badgeVariants({ variant }), className)}
      {...props}
    />
  )
}

export { Badge, badgeVariants }
</file>

<file path="components/ui/button.tsx">
import * as React from 'react'
import { Slot } from '@radix-ui/react-slot'
import { cva, type VariantProps } from 'class-variance-authority'

import { cn } from '@/lib/utils'

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
  {
    variants: {
      variant: {
        default: 'bg-primary text-primary-foreground hover:bg-primary/90',
        destructive:
          'bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60',
        outline:
          'border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50',
        secondary:
          'bg-secondary text-secondary-foreground hover:bg-secondary/80',
        ghost:
          'hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50',
        link: 'text-primary underline-offset-4 hover:underline',
      },
      size: {
        default: 'h-9 px-4 py-2 has-[>svg]:px-3',
        sm: 'h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5',
        lg: 'h-10 rounded-md px-6 has-[>svg]:px-4',
        icon: 'size-9',
        'icon-sm': 'size-8',
        'icon-lg': 'size-10',
      },
    },
    defaultVariants: {
      variant: 'default',
      size: 'default',
    },
  },
)

function Button({
  className,
  variant,
  size,
  asChild = false,
  ...props
}: React.ComponentProps<'button'> &
  VariantProps<typeof buttonVariants> & {
    asChild?: boolean
  }) {
  const Comp = asChild ? Slot : 'button'

  return (
    <Comp
      data-slot="button"
      className={cn(buttonVariants({ variant, size, className }))}
      {...props}
    />
  )
}

export { Button, buttonVariants }
</file>

<file path="components/ui/calendar.tsx">
"use client"

import * as React from "react"
import { ChevronLeft, ChevronRight } from "lucide-react"
import { cn } from "@/lib/utils"
import {
  addMonths,
  subMonths,
  startOfMonth,
  endOfMonth,
  startOfWeek,
  endOfWeek,
  format,
  isSameMonth,
  isSameDay,
  addDays,
  startOfDay,
} from "date-fns"

export interface CalendarProps {
  mode?: "single"
  selected?: Date
  onSelect?: (date: Date | undefined) => void
  disabled?: (date: Date) => boolean
  className?: string
}

function Calendar({ selected, onSelect, disabled, className }: CalendarProps) {
  const [currentMonth, setCurrentMonth] = React.useState(selected || new Date())

  const today = startOfDay(new Date())

  // Generate calendar days
  const monthStart = startOfMonth(currentMonth)
  const monthEnd = endOfMonth(currentMonth)
  const calendarStart = startOfWeek(monthStart, { weekStartsOn: 0 }) // Sunday start
  const calendarEnd = endOfWeek(monthEnd, { weekStartsOn: 0 })

  const days: Date[] = []
  let day = calendarStart
  while (day <= calendarEnd) {
    days.push(day)
    day = addDays(day, 1)
  }

  // Split into weeks
  const weeks: Date[][] = []
  for (let i = 0; i < days.length; i += 7) {
    weeks.push(days.slice(i, i + 7))
  }

  const handlePrevMonth = () => setCurrentMonth(subMonths(currentMonth, 1))
  const handleNextMonth = () => setCurrentMonth(addMonths(currentMonth, 1))

  const handleDateClick = (date: Date) => {
    if (disabled?.(date)) return
    onSelect?.(date)
  }

  const dayNames = ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"]

  return (
    <div className={cn("w-full", className)}>
      {/* Header with navigation */}
      <div className="flex items-center justify-between mb-4 px-1">
        <button
          onClick={handlePrevMonth}
          className="w-10 h-10 rounded-full bg-primary/10 hover:bg-primary hover:text-primary-foreground flex items-center justify-center transition-all duration-200 active:scale-95"
          aria-label="Previous month"
        >
          <ChevronLeft className="w-5 h-5" />
        </button>
        <h2 className="text-lg font-semibold text-foreground">{format(currentMonth, "MMMM yyyy")}</h2>
        <button
          onClick={handleNextMonth}
          className="w-10 h-10 rounded-full bg-primary/10 hover:bg-primary hover:text-primary-foreground flex items-center justify-center transition-all duration-200 active:scale-95"
          aria-label="Next month"
        >
          <ChevronRight className="w-5 h-5" />
        </button>
      </div>

      {/* Day names header - proper 7 column grid */}
      <div className="grid grid-cols-7 gap-1 mb-2">
        {dayNames.map((name) => (
          <div
            key={name}
            className="h-10 flex items-center justify-center text-xs font-semibold uppercase tracking-wider text-muted-foreground"
          >
            {name}
          </div>
        ))}
      </div>

      {/* Calendar grid - proper 7 column layout */}
      <div className="space-y-1">
        {weeks.map((week, weekIndex) => (
          <div key={weekIndex} className="grid grid-cols-7 gap-1">
            {week.map((date, dayIndex) => {
              const isCurrentMonth = isSameMonth(date, currentMonth)
              const isSelected = selected && isSameDay(date, selected)
              const isToday = isSameDay(date, today)
              const isDisabled = disabled?.(date) || false

              return (
                <button
                  key={dayIndex}
                  onClick={() => handleDateClick(date)}
                  disabled={isDisabled}
                  className={cn(
                    "aspect-square w-full rounded-xl flex items-center justify-center",
                    "text-sm font-medium transition-all duration-200",
                    "focus:outline-none focus:ring-2 focus:ring-primary/50 focus:ring-offset-2",
                    "active:scale-95",
                    // Outside current month
                    !isCurrentMonth && "text-muted-foreground/40",
                    // Today highlight
                    isToday && !isSelected && "bg-secondary/20 text-secondary font-bold ring-2 ring-secondary/30",
                    // Selected state
                    isSelected && "bg-primary text-primary-foreground shadow-lg shadow-primary/25",
                    // Disabled state
                    isDisabled && "text-muted-foreground/25 cursor-not-allowed hover:bg-transparent",
                    // Default hover
                    !isSelected && !isDisabled && isCurrentMonth && "hover:bg-primary/10 hover:text-primary",
                  )}
                >
                  {format(date, "d")}
                </button>
              )
            })}
          </div>
        ))}
      </div>
    </div>
  )
}

Calendar.displayName = "Calendar"

export { Calendar }
</file>

<file path="components/ui/card.tsx">
import * as React from "react"
import { cn } from "@/lib/utils"

const Card = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div
      ref={ref}
      className={cn(
        // FORCE GLASS EFFECT
        "rounded-xl border border-white/10 bg-white/5 text-card-foreground shadow-xl backdrop-blur-md",
        className
      )}
      {...props}
    />
  )
)
Card.displayName = "Card"

const CardHeader = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div
      ref={ref}
      className={cn("flex flex-col space-y-1.5 p-6", className)}
      {...props}
    />
  )
)
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLHeadingElement>>(
  ({ className, ...props }, ref) => (
    <h3
      ref={ref}
      className={cn("font-semibold leading-none tracking-tight text-white", className)}
      {...props}
    />
  )
)
CardTitle.displayName = "CardTitle"

const CardDescription = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(
  ({ className, ...props }, ref) => (
    <p
      ref={ref}
      className={cn("text-sm text-gray-400", className)}
      {...props}
    />
  )
)
CardDescription.displayName = "CardDescription"

const CardContent = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn("p-6 pt-0 text-gray-200", className)} {...props} />
  )
)
CardContent.displayName = "CardContent"

const CardFooter = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div
      ref={ref}
      className={cn("flex items-center p-6 pt-0", className)}
      {...props}
    />
  )
)
CardFooter.displayName = "CardFooter"

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }
</file>

<file path="components/ui/checkbox.tsx">
'use client'

import * as React from 'react'
import * as CheckboxPrimitive from '@radix-ui/react-checkbox'
import { CheckIcon } from 'lucide-react'

import { cn } from '@/lib/utils'

function Checkbox({
  className,
  ...props
}: React.ComponentProps<typeof CheckboxPrimitive.Root>) {
  return (
    <CheckboxPrimitive.Root
      data-slot="checkbox"
      className={cn(
        'peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50',
        className,
      )}
      {...props}
    >
      <CheckboxPrimitive.Indicator
        data-slot="checkbox-indicator"
        className="flex items-center justify-center text-current transition-none"
      >
        <CheckIcon className="size-3.5" />
      </CheckboxPrimitive.Indicator>
    </CheckboxPrimitive.Root>
  )
}

export { Checkbox }
</file>

<file path="components/ui/input.tsx">
import * as React from 'react'

import { cn } from '@/lib/utils'

function Input({ className, type, ...props }: React.ComponentProps<'input'>) {
  return (
    <input
      type={type}
      data-slot="input"
      className={cn(
        'file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm',
        'focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]',
        'aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive',
        className,
      )}
      {...props}
    />
  )
}

export { Input }
</file>

<file path="components/ui/label.tsx">
'use client'

import * as React from 'react'
import * as LabelPrimitive from '@radix-ui/react-label'

import { cn } from '@/lib/utils'

function Label({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  return (
    <LabelPrimitive.Root
      data-slot="label"
      className={cn(
        'flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50',
        className,
      )}
      {...props}
    />
  )
}

export { Label }
</file>

<file path="components/ui/select.tsx">
'use client'

import * as React from 'react'
import * as SelectPrimitive from '@radix-ui/react-select'
import { CheckIcon, ChevronDownIcon, ChevronUpIcon } from 'lucide-react'

import { cn } from '@/lib/utils'

function Select({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Root>) {
  return <SelectPrimitive.Root data-slot="select" {...props} />
}

function SelectGroup({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Group>) {
  return <SelectPrimitive.Group data-slot="select-group" {...props} />
}

function SelectValue({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Value>) {
  return <SelectPrimitive.Value data-slot="select-value" {...props} />
}

function SelectTrigger({
  className,
  size = 'default',
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Trigger> & {
  size?: 'sm' | 'default'
}) {
  return (
    <SelectPrimitive.Trigger
      data-slot="select-trigger"
      data-size={size}
      className={cn(
        "border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      {children}
      <SelectPrimitive.Icon asChild>
        <ChevronDownIcon className="size-4 opacity-50" />
      </SelectPrimitive.Icon>
    </SelectPrimitive.Trigger>
  )
}

function SelectContent({
  className,
  children,
  position = 'popper',
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Content>) {
  return (
    <SelectPrimitive.Portal>
      <SelectPrimitive.Content
        data-slot="select-content"
        className={cn(
          'bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md',
          position === 'popper' &&
            'data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1',
          className,
        )}
        position={position}
        {...props}
      >
        <SelectScrollUpButton />
        <SelectPrimitive.Viewport
          className={cn(
            'p-1',
            position === 'popper' &&
              'h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1',
          )}
        >
          {children}
        </SelectPrimitive.Viewport>
        <SelectScrollDownButton />
      </SelectPrimitive.Content>
    </SelectPrimitive.Portal>
  )
}

function SelectLabel({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Label>) {
  return (
    <SelectPrimitive.Label
      data-slot="select-label"
      className={cn('text-muted-foreground px-2 py-1.5 text-xs', className)}
      {...props}
    />
  )
}

function SelectItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Item>) {
  return (
    <SelectPrimitive.Item
      data-slot="select-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",
        className,
      )}
      {...props}
    >
      <span className="absolute right-2 flex size-3.5 items-center justify-center">
        <SelectPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </SelectPrimitive.ItemIndicator>
      </span>
      <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
    </SelectPrimitive.Item>
  )
}

function SelectSeparator({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Separator>) {
  return (
    <SelectPrimitive.Separator
      data-slot="select-separator"
      className={cn('bg-border pointer-events-none -mx-1 my-1 h-px', className)}
      {...props}
    />
  )
}

function SelectScrollUpButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollUpButton>) {
  return (
    <SelectPrimitive.ScrollUpButton
      data-slot="select-scroll-up-button"
      className={cn(
        'flex cursor-default items-center justify-center py-1',
        className,
      )}
      {...props}
    >
      <ChevronUpIcon className="size-4" />
    </SelectPrimitive.ScrollUpButton>
  )
}

function SelectScrollDownButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollDownButton>) {
  return (
    <SelectPrimitive.ScrollDownButton
      data-slot="select-scroll-down-button"
      className={cn(
        'flex cursor-default items-center justify-center py-1',
        className,
      )}
      {...props}
    >
      <ChevronDownIcon className="size-4" />
    </SelectPrimitive.ScrollDownButton>
  )
}

export {
  Select,
  SelectContent,
  SelectGroup,
  SelectItem,
  SelectLabel,
  SelectScrollDownButton,
  SelectScrollUpButton,
  SelectSeparator,
  SelectTrigger,
  SelectValue,
}
</file>

<file path="components/ui/separator.tsx">
'use client'

import * as React from 'react'
import * as SeparatorPrimitive from '@radix-ui/react-separator'

import { cn } from '@/lib/utils'

function Separator({
  className,
  orientation = 'horizontal',
  decorative = true,
  ...props
}: React.ComponentProps<typeof SeparatorPrimitive.Root>) {
  return (
    <SeparatorPrimitive.Root
      data-slot="separator"
      decorative={decorative}
      orientation={orientation}
      className={cn(
        'bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px',
        className,
      )}
      {...props}
    />
  )
}

export { Separator }
</file>

<file path="components/ui/switch.tsx">
'use client'

import * as React from 'react'
import * as SwitchPrimitive from '@radix-ui/react-switch'

import { cn } from '@/lib/utils'

function Switch({
  className,
  ...props
}: React.ComponentProps<typeof SwitchPrimitive.Root>) {
  return (
    <SwitchPrimitive.Root
      data-slot="switch"
      className={cn(
        'peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50',
        className,
      )}
      {...props}
    >
      <SwitchPrimitive.Thumb
        data-slot="switch-thumb"
        className={
          'bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0'
        }
      />
    </SwitchPrimitive.Root>
  )
}

export { Switch }
</file>

<file path="components/ui/table.tsx">
'use client'

import * as React from 'react'

import { cn } from '@/lib/utils'

function Table({ className, ...props }: React.ComponentProps<'table'>) {
  return (
    <div
      data-slot="table-container"
      className="relative w-full overflow-x-auto"
    >
      <table
        data-slot="table"
        className={cn('w-full caption-bottom text-sm', className)}
        {...props}
      />
    </div>
  )
}

function TableHeader({ className, ...props }: React.ComponentProps<'thead'>) {
  return (
    <thead
      data-slot="table-header"
      className={cn('[&_tr]:border-b', className)}
      {...props}
    />
  )
}

function TableBody({ className, ...props }: React.ComponentProps<'tbody'>) {
  return (
    <tbody
      data-slot="table-body"
      className={cn('[&_tr:last-child]:border-0', className)}
      {...props}
    />
  )
}

function TableFooter({ className, ...props }: React.ComponentProps<'tfoot'>) {
  return (
    <tfoot
      data-slot="table-footer"
      className={cn(
        'bg-muted/50 border-t font-medium [&>tr]:last:border-b-0',
        className,
      )}
      {...props}
    />
  )
}

function TableRow({ className, ...props }: React.ComponentProps<'tr'>) {
  return (
    <tr
      data-slot="table-row"
      className={cn(
        'hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors',
        className,
      )}
      {...props}
    />
  )
}

function TableHead({ className, ...props }: React.ComponentProps<'th'>) {
  return (
    <th
      data-slot="table-head"
      className={cn(
        'text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]',
        className,
      )}
      {...props}
    />
  )
}

function TableCell({ className, ...props }: React.ComponentProps<'td'>) {
  return (
    <td
      data-slot="table-cell"
      className={cn(
        'p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]',
        className,
      )}
      {...props}
    />
  )
}

function TableCaption({
  className,
  ...props
}: React.ComponentProps<'caption'>) {
  return (
    <caption
      data-slot="table-caption"
      className={cn('text-muted-foreground mt-4 text-sm', className)}
      {...props}
    />
  )
}

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}
</file>

<file path="components/ui/tabs.tsx">
'use client'

import * as React from 'react'
import * as TabsPrimitive from '@radix-ui/react-tabs'

import { cn } from '@/lib/utils'

function Tabs({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Root>) {
  return (
    <TabsPrimitive.Root
      data-slot="tabs"
      className={cn('flex flex-col gap-2', className)}
      {...props}
    />
  )
}

function TabsList({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.List>) {
  return (
    <TabsPrimitive.List
      data-slot="tabs-list"
      className={cn(
        'bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]',
        className,
      )}
      {...props}
    />
  )
}

function TabsTrigger({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Trigger>) {
  return (
    <TabsPrimitive.Trigger
      data-slot="tabs-trigger"
      className={cn(
        "data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  )
}

function TabsContent({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Content>) {
  return (
    <TabsPrimitive.Content
      data-slot="tabs-content"
      className={cn('flex-1 outline-none', className)}
      {...props}
    />
  )
}

export { Tabs, TabsList, TabsTrigger, TabsContent }
</file>

<file path="config.yml">
{}
</file>

<file path="lib/email.tsx">
// Email notification utilities
// In production, integrate with services like Resend, SendGrid, or Postmark

export interface BookingConfirmationEmail {
  to: string
  bookingId: string
  guestName: string
  bookingDate: string
  startTime: string
  duration: number
  playerCount: number
  totalPrice: number
  cancelUrl: string
}

export async function sendBookingConfirmation(data: BookingConfirmationEmail) {
  // This is a placeholder for email sending logic
  // In production, you would integrate with an email service

  const emailHtml = `
    <!DOCTYPE html>
    <html>
      <head>
        <style>
          body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #1A472A; }
          .container { max-width: 600px; margin: 0 auto; padding: 20px; }
          .header { background: #1A472A; color: #F5F5F5; padding: 30px; text-align: center; border-radius: 8px 8px 0 0; }
          .content { background: #F5F5F5; padding: 30px; border-radius: 0 0 8px 8px; }
          .booking-details { background: white; padding: 20px; border-radius: 8px; margin: 20px 0; }
          .detail-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e5e5e5; }
          .button { display: inline-block; background: #D4AF37; color: #1A472A; padding: 12px 30px; text-decoration: none; border-radius: 6px; font-weight: bold; margin: 20px 0; }
          .footer { text-align: center; color: #666; font-size: 12px; margin-top: 30px; }
        </style>
      </head>
      <body>
        <div class="container">
          <div class="header">
            <h1>🏌️ Booking Confirmed!</h1>
          </div>
          <div class="content">
            <p>Hi ${data.guestName},</p>
            <p>Your golf simulator session is confirmed! We're excited to see you on the course.</p>
            
            <div class="booking-details">
              <h2 style="color: #1A472A; margin-top: 0;">Booking Details</h2>
              <div class="detail-row">
                <span><strong>Booking ID:</strong></span>
                <span>${data.bookingId.slice(0, 8)}</span>
              </div>
              <div class="detail-row">
                <span><strong>Date:</strong></span>
                <span>${data.bookingDate}</span>
              </div>
              <div class="detail-row">
                <span><strong>Time:</strong></span>
                <span>${data.startTime}</span>
              </div>
              <div class="detail-row">
                <span><strong>Duration:</strong></span>
                <span>${data.duration} hour${data.duration > 1 ? "s" : ""}</span>
              </div>
              <div class="detail-row">
                <span><strong>Players:</strong></span>
                <span>${data.playerCount}</span>
              </div>
              <div class="detail-row" style="border-bottom: none; font-size: 18px; color: #1A472A;">
                <span><strong>Total Paid:</strong></span>
                <span><strong>R${data.totalPrice.toFixed(2)}</strong></span>
              </div>
            </div>

            <h3 style="color: #1A472A;">What to Bring:</h3>
            <ul>
              <li>Comfortable athletic wear</li>
              <li>Your confirmation email (this one!)</li>
              <li>Valid ID (for student/junior/senior rates)</li>
            </ul>

            <h3 style="color: #1A472A;">Important Information:</h3>
            <ul>
              <li>Please arrive 10 minutes early for check-in</li>
              <li>Free cancellation available up to 2 hours before your session</li>
              <li>Our staff will help you get set up and answer any questions</li>
            </ul>

            <center>
              <a href="${data.cancelUrl}" class="button">Manage Booking</a>
            </center>

            <div class="footer">
              <p>Elite Golf Sim | Premium Golf Simulator Experience</p>
              <p>Need help? Contact us at support@elitegolfsim.com</p>
            </div>
          </div>
        </div>
      </body>
    </html>
  `

  console.log("[v0] Email would be sent to:", data.to)
  console.log("[v0] Email content prepared for booking:", data.bookingId)

  // In production, send via email service:
  // await emailService.send({
  //   to: data.to,
  //   subject: `Booking Confirmed - ${data.bookingDate} at ${data.startTime}`,
  //   html: emailHtml
  // })

  return { success: true, emailHtml }
}

export async function sendCancellationEmail(to: string, bookingId: string, guestName: string) {
  console.log("[v0] Cancellation email would be sent to:", to)

  // In production, implement cancellation email template
  return { success: true }
}

export async function sendReminderEmail(to: string, bookingId: string, guestName: string, bookingDate: string) {
  console.log("[v0] Reminder email would be sent to:", to)

  // In production, implement reminder email template (24 hours before)
  return { success: true }
}
</file>

<file path="lib/github/workflows/deploy.yml">
name: Build & deploy OpenNext → Cloudflare Workers

on:
  push:
    branches:
      - Themulligan   # production branch; change if different

jobs:
  build-deploy:
    runs-on: ubuntu-latest
    env:
      CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}
      CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
      DATABASE_URL: ${{ secrets.DATABASE_URL }}  # optional (used if MIGRATE=true)
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node 20
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Enable corepack (for pnpm)
        run: corepack enable

      - name: Install dependencies (pnpm)
        run: |
          corepack prepare pnpm@latest --activate
          pnpm install --frozen-lockfile

      # Optional: run DB migration (disabled by default)
      - name: Run DB migrations (optional)
        if: env.MIGRATE == 'true'
        run: |
          echo "Running migrations..."
          psql "$DATABASE_URL" -f scripts/006_enable_rls_and_policies.sql
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL }}

      - name: Run OpenNext build
        run: pnpm dlx @opennextjs/cloudflare build

      - name: Deploy to Cloudflare Workers
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}
        run: pnpm dlx @opennextjs/cloudflare deploy
</file>

<file path="lib/supabase/client.ts">
let createSupabaseClient: typeof import("@supabase/supabase-js").createClient | null = null
let supabaseInstance: ReturnType<typeof import("@supabase/supabase-js").createClient> | null = null
let initPromise: Promise<void> | null = null

// Mock client for when Supabase is not available
const mockClient = {
  from: () => ({
    select: () => Promise.resolve({ data: [], error: null }),
    insert: () => Promise.resolve({ data: null, error: { message: "Supabase not configured" } }),
    update: () => Promise.resolve({ data: null, error: { message: "Supabase not configured" } }),
    delete: () => Promise.resolve({ data: null, error: { message: "Supabase not configured" } }),
    eq: () => ({
      select: () => Promise.resolve({ data: [], error: null }),
      single: () => Promise.resolve({ data: null, error: null }),
    }),
    single: () => Promise.resolve({ data: null, error: null }),
  }),
  auth: {
    getUser: () => Promise.resolve({ data: { user: null }, error: null }),
    signInWithPassword: () => Promise.resolve({ data: null, error: { message: "Supabase not configured" } }),
    signUp: () => Promise.resolve({ data: null, error: { message: "Supabase not configured" } }),
    signOut: () => Promise.resolve({ error: null }),
  },
  rpc: () => Promise.resolve({ data: null, error: { message: "Supabase not configured" } }),
} as any

async function initSupabase() {
  if (initPromise) return initPromise

  initPromise = (async () => {
    try {
      const supabase = await import("@supabase/supabase-js")
      createSupabaseClient = supabase.createClient
    } catch (error) {
      console.warn("[v0] Failed to load @supabase/supabase-js, using mock client")
      createSupabaseClient = null
    }
  })()

  return initPromise
}

export async function createClient() {
  await initSupabase()

  const url = process.env.NEXT_PUBLIC_SUPABASE_URL
  const key = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY

  if (!url || !key || !createSupabaseClient) {
    return mockClient
  }

  if (!supabaseInstance) {
    supabaseInstance = createSupabaseClient(url, key)
  }

  return supabaseInstance
}

// Sync version that returns mock if not initialized (for backwards compat)
export function createBrowserClient() {
  const url = process.env.NEXT_PUBLIC_SUPABASE_URL
  const key = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY

  if (!url || !key || !createSupabaseClient || !supabaseInstance) {
    return mockClient
  }

  return supabaseInstance
}

// Initialize eagerly but don't block
initSupabase()
</file>

<file path="lib/supabase/middleware.ts">
import { NextResponse, type NextRequest } from "next/server"

let createSupabaseClient: typeof import("@supabase/supabase-js").createClient | null = null
let initPromise: Promise<void> | null = null

async function initSupabase() {
  if (initPromise) return initPromise

  initPromise = (async () => {
    try {
      const supabase = await import("@supabase/supabase-js")
      createSupabaseClient = supabase.createClient
    } catch (error) {
      console.warn("[v0] Failed to load @supabase/supabase-js in middleware")
      createSupabaseClient = null
    }
  })()

  return initPromise
}

export async function updateSession(request: NextRequest) {
  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL
  const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY

  // If Supabase is not configured, skip middleware processing
  if (!supabaseUrl || !supabaseAnonKey) {
    return NextResponse.next({ request })
  }

  const supabaseResponse = NextResponse.next({ request })

  // Try to initialize Supabase
  await initSupabase()

  if (!createSupabaseClient) {
    // Supabase package not available, skip auth checks
    return supabaseResponse
  }

  // Get auth token from cookies
  const authToken = request.cookies.get("sb-access-token")?.value

  try {
    const supabase = createSupabaseClient(supabaseUrl, supabaseAnonKey, {
      auth: {
        persistSession: false,
        autoRefreshToken: false,
      },
      global: {
        headers: authToken
          ? {
              Authorization: `Bearer ${authToken}`,
            }
          : {},
      },
    })

    const {
      data: { user },
    } = await supabase.auth.getUser()

    // Allow public access to most pages, only protect admin routes
    if (!user && request.nextUrl.pathname.startsWith("/admin")) {
      const url = request.nextUrl.clone()
      url.pathname = "/auth/login"
      return NextResponse.redirect(url)
    }
  } catch (error) {
    console.error("[v0] Middleware Supabase error:", error)
  }

  return supabaseResponse
}

// Initialize eagerly but don't block
initSupabase()
</file>

<file path="lib/supabase/server.ts">
import { cookies } from "next/headers"

let createSupabaseClient: typeof import("@supabase/supabase-js").createClient | null = null
let initPromise: Promise<void> | null = null

// Mock client for when Supabase is not available
const mockClient = {
  from: () => ({
    select: () => Promise.resolve({ data: [], error: null }),
    insert: () => Promise.resolve({ data: null, error: { message: "Supabase not configured" } }),
    update: () => Promise.resolve({ data: null, error: { message: "Supabase not configured" } }),
    delete: () => Promise.resolve({ data: null, error: { message: "Supabase not configured" } }),
    eq: () => ({
      select: () => Promise.resolve({ data: [], error: null }),
      single: () => Promise.resolve({ data: null, error: null }),
    }),
    single: () => Promise.resolve({ data: null, error: null }),
  }),
  auth: {
    getUser: () => Promise.resolve({ data: { user: null }, error: null }),
  },
  rpc: () => Promise.resolve({ data: null, error: { message: "Supabase not configured" } }),
} as any

async function initSupabase() {
  if (initPromise) return initPromise

  initPromise = (async () => {
    try {
      const supabase = await import("@supabase/supabase-js")
      createSupabaseClient = supabase.createClient
    } catch (error) {
      console.warn("[v0] Failed to load @supabase/supabase-js on server, using mock client")
      createSupabaseClient = null
    }
  })()

  return initPromise
}

export async function createClient() {
  await initSupabase()

  const url = process.env.NEXT_PUBLIC_SUPABASE_URL
  const key = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY

  if (!url || !key || !createSupabaseClient) {
    return mockClient
  }

  const cookieStore = await cookies()
  const authToken = cookieStore.get("sb-access-token")?.value

  return createSupabaseClient(url, key, {
    auth: {
      persistSession: false,
      autoRefreshToken: false,
    },
    global: {
      headers: authToken
        ? {
            Authorization: `Bearer ${authToken}`,
          }
        : {},
    },
  })
}

export const createServerClient = createClient

// Initialize eagerly but don't block
initSupabase()
</file>

<file path="lib/types.ts">
export type UserType = "adult" | "student" | "junior" | "senior"
export type BookingStatus = "pending" | "confirmed" | "cancelled" | "completed"
export type PaymentStatus = "pending" | "completed" | "failed" | "refunded"
export type DayType = "weekday" | "weekend" | "holiday"
export type SessionType = "famous-course" | "quickplay"
export type FamousCourseOption = "4-ball" | "3-ball" | null

export interface Booking {
  id: string
  user_id?: string
  booking_date: string
  start_time: string
  end_time: string
  duration_hours: number
  player_count: number
  session_type: SessionType
  famous_course_option?: string
  user_type: UserType
  base_price: number
  total_price: number
  status: BookingStatus
  payment_status: PaymentStatus
  payment_reference?: string
  guest_name?: string
  guest_email?: string
  guest_phone?: string
  accept_whatsapp: boolean
  enter_competition: boolean
  coupon_code?: string
  special_requests?: string
  created_at: string
  updated_at: string
  cancelled_at?: string
}

export interface Upsell {
  id: string
  name: string
  description?: string
  price: number
  category: string
  trigger_condition?: any
  is_active: boolean
  image_url?: string
  created_at: string
  updated_at: string
}

export interface PricingRule {
  id: string
  user_type: UserType
  day_type: DayType
  start_hour: number
  end_hour: number
  price_per_hour: number
  is_peak: boolean
  created_at: string
  updated_at: string
}
</file>

<file path="lib/utils.ts">
import { clsx, type ClassValue } from 'clsx'
import { twMerge } from 'tailwind-merge'

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
</file>

<file path="lib/venue-config.ts">
export const venueConfig = {
  // 1. BRANDING (US Style)
  name: "Fairway Systems",
  tagline: "The Operating System for Modern Golf Venues",
  description: "Automate bookings, secure deposits, and fill empty slots with AI-driven revenue operations.",
  currency: "$", 
  
  // 2. CONTACT (US Format)
  address: "Austin, TX", // Keep it vague but US-based for the demo
  mapLink: "https://maps.google.com", 
  phone: "+1 (512) 555-0123",
  email: "hello@fairwaysystems.io",
  
  // 3. HOURS
  hours: {
    weekday: { open: "09:00", close: "22:00" }, // US venues stay open later
    saturday: { open: "08:00", close: "23:00" },
    sunday: { open: "10:00", close: "20:00" }
  },

  // 4. PRICING (US Market Rates)
  pricing: {
    baseRate: 50,   // $50/hr (Solo)
    twoPlayerRate: 45, 
    threePlayerRate: 40,
    fourPlayerRate: 35, // $35 pp/hr is a great deal in the US
    clubRental: 25,     // $25 rental
    depositPercentage: 0.50, // US markets often take 50%
  },

  // 5. RESOURCES
  bays: 5, // US venues tend to be larger
  
  // 6. IMAGES
  images: {
    logo: "/images/logo-placeholder.png"
  }
}

export const OPERATING_HOURS_LOGIC: Record<number, { open: number; close: number }> = {
  0: { open: 10, close: 20 },
  1: { open: 9, close: 22 },
  2: { open: 9, close: 22 },
  3: { open: 9, close: 22 },
  4: { open: 9, close: 22 },
  5: { open: 9, close: 23 },
  6: { open: 8, close: 23 },
}
</file>

<file path="MIGRATION_TO_OPENNEXT.md">
# Migration Guide: Switching to OpenNext Cloudflare Adapter

## Why OpenNext?

**OpenNext (`@opennextjs/cloudflare`)** is the **modern, officially recommended, and actively maintained** Next.js adapter for Cloudflare Workers and Pages. It provides:

- **Better Next.js 15+ support** - Full compatibility with the latest App Router features
- **Active maintenance** - Regular updates aligned with Next.js releases
- **Official recommendation** - Endorsed by both Cloudflare and the OpenNext community
- **Enhanced performance** - Optimized for Cloudflare's edge runtime
- **Improved reliability** - Better handling of Next.js features like Server Actions, streaming, and middleware

The previous adapter (`@cloudflare/next-on-pages`) is being phased out in favor of OpenNext, making this transition essential for long-term support and stability.

## Local Migration Steps

Follow these steps **exactly** to ensure a smooth transition:

### Step 1: Remove Old Adapter

First, remove the deprecated `@cloudflare/next-on-pages` package:

\`\`\`bash
pnpm remove @cloudflare/next-on-pages
\`\`\`

This ensures no conflicts between the old and new adapters.

### Step 2: Install OpenNext Adapter

Install the new `@opennextjs/cloudflare` package as a development dependency:

\`\`\`bash
pnpm add -D @opennextjs/cloudflare
\`\`\`

### Step 3: Install All Dependencies

Ensure all dependencies are properly installed and the lockfile is updated:

\`\`\`bash
pnpm install
\`\`\`

This step is critical for Cloudflare to recognize the correct adapter during deployment.

### Step 4: Verify Configuration Files

Your configuration files should already be updated. Verify the following:

**`wrangler.toml` should have:**
\`\`\`toml
[build]
command = "npx opennextjs-cloudflare build"
\`\`\`

**`package.json` should have:**
\`\`\`json
{
  "scripts": {
    "deploy": "npm run build && npx @opennextjs/cloudflare && wrangler pages deploy"
  },
  "devDependencies": {
    "@opennextjs/cloudflare": "^1.0.0"
  }
}
\`\`\`

**`open-next.config.ts` should exist** with basic configuration.

### Step 5: Test Build Locally

Before deploying, test the build process locally:

\`\`\`bash
pnpm build
npx @opennextjs/cloudflare
\`\`\`

This should generate the `.open-next` directory with your Cloudflare-optimized build.

### Step 6: Commit Changes

Commit these changes with a clear message to ensure Cloudflare recognizes the new adapter:

\`\`\`bash
git add package.json pnpm-lock.yaml wrangler.toml open-next.config.ts
git commit -m "chore: migrate to OpenNext Cloudflare adapter

- Remove deprecated @cloudflare/next-on-pages
- Add @opennextjs/cloudflare as recommended adapter
- Update wrangler.toml build command
- Ensure Cloudflare uses correct adapter during deployment"
git push origin main
\`\`\`

### Step 7: Deploy to Cloudflare

Once pushed, Cloudflare Pages will automatically:
1. Detect the `@opennextjs/cloudflare` package in your dependencies
2. Use the build command from `wrangler.toml`
3. Generate the optimized Workers deployment
4. Deploy your application with the new adapter

**Manual deployment (if needed):**
\`\`\`bash
pnpm deploy
\`\`\`

## What Changed?

| Aspect | Old (@cloudflare/next-on-pages) | New (@opennextjs/cloudflare) |
|--------|--------------------------------|------------------------------|
| **Output Directory** | `.vercel/output/static` | `.open-next/` |
| **Build Command** | `npx @cloudflare/next-on-pages` | `npx @opennextjs/cloudflare` |
| **Configuration** | None required | `open-next.config.ts` |
| **Next.js Support** | Up to Next.js 14 | Full Next.js 15+ support |
| **Maintenance** | Deprecated | Actively maintained |

## Environment Variables

**No changes needed!** Your environment variables in Cloudflare Dashboard remain the same:

- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- `N8N_WEBHOOK_URL`
- `YOCO_SECRET_KEY`
- `NEXT_PUBLIC_APP_URL`

## Verifying Successful Migration

After deployment, verify the migration was successful:

1. **Check Build Logs** - Look for "Using @opennextjs/cloudflare" in Cloudflare build logs
2. **Test Functionality** - Verify all booking flows work correctly
3. **Check API Routes** - Ensure all API endpoints respond properly
4. **Test Payments** - Confirm Yoco payment integration still works
5. **Monitor Performance** - Compare response times (should be similar or better)

## Troubleshooting

### Build fails with "command not found"

**Solution:** Run `pnpm install` to ensure `@opennextjs/cloudflare` is installed.

### Deployment uses old adapter

**Solution:** Ensure `pnpm-lock.yaml` includes `@opennextjs/cloudflare` and is committed to git.

### API routes return 404

**Solution:** Verify `wrangler.toml` uses `command = "npx opennextjs-cloudflare build"` exactly.

### Environment variables not working

**Solution:** Check Cloudflare Dashboard → Settings → Environment Variables are still set.

## Rollback (If Needed)

If you encounter critical issues, you can temporarily rollback:

\`\`\`bash
pnpm remove @opennextjs/cloudflare
pnpm add -D @cloudflare/next-on-pages
\`\`\`

Update `wrangler.toml`:
\`\`\`toml
[build]
command = "npx @cloudflare/next-on-pages"
\`\`\`

However, **this is only a temporary solution**. OpenNext is the future, and the old adapter will eventually stop receiving updates.

## Benefits You'll See

After migrating to OpenNext, you'll experience:

- **Faster builds** - More efficient bundling for Cloudflare Workers
- **Better compatibility** - Full support for Next.js 15 features like parallel routes and intercepting routes
- **Improved reliability** - Fewer edge-case bugs with Server Actions and middleware
- **Future-proof** - Guaranteed updates as Next.js evolves
- **Better error messages** - More helpful debugging information during builds

## Support

If you encounter any issues during migration:

1. **Check the build logs** in Cloudflare Dashboard
2. **Review the OpenNext documentation**: https://opennext.js.org/cloudflare
3. **Cloudflare Community**: https://community.cloudflare.com
4. **OpenNext GitHub Issues**: https://github.com/opennextjs/opennextjs-cloudflare/issues

## Summary

By switching to OpenNext, you're ensuring your golf booking application uses the **modern, supported, and recommended** adapter for deploying Next.js on Cloudflare. This migration guarantees long-term compatibility, better performance, and peace of mind that your deployment infrastructure is built on the latest standards.

**The migration is straightforward:** Remove old package → Install new package → Commit → Deploy. Cloudflare will handle the rest! 🚀
</file>

<file path="next.config.mjs">
/** @type {import('next').NextConfig} */
const nextConfig = {
  eslint: {
    ignoreDuringBuilds: true,
  },
  typescript: {
    ignoreBuildErrors: true,
  },
  images: {
    unoptimized: true,
  },
  experimental: {
    serverActions: {
      bodySizeLimit: '2mb',
    },
  },
}

export default nextConfig
</file>

<file path="opennext.config.js">
// opennext.config.js
export default {};
</file>

<file path="opennext.config.ts">
// opennext.config.ts
export default {};
</file>

<file path="package.json">
{
  "name": "elite-golf-sim",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "pages:build": "npx @cloudflare/next-on-pages@1",
    "preview": "npm run pages:build && wrangler pages dev .vercel/output/static",
    "deploy": "npm run pages:build && wrangler pages deploy .vercel/output/static",
    "lint": "eslint ."
  },
  "dependencies": {
    "@hookform/resolvers": "latest",
    "@radix-ui/react-accordion": "latest",
    "@radix-ui/react-alert-dialog": "latest",
    "@radix-ui/react-aspect-ratio": "latest",
    "@radix-ui/react-avatar": "latest",
    "@radix-ui/react-checkbox": "latest",
    "@radix-ui/react-collapsible": "latest",
    "@radix-ui/react-context-menu": "latest",
    "@radix-ui/react-dialog": "latest",
    "@radix-ui/react-dropdown-menu": "latest",
    "@radix-ui/react-hover-card": "latest",
    "@radix-ui/react-label": "latest",
    "@radix-ui/react-menubar": "latest",
    "@radix-ui/react-navigation-menu": "latest",
    "@radix-ui/react-popover": "latest",
    "@radix-ui/react-progress": "latest",
    "@radix-ui/react-radio-group": "latest",
    "@radix-ui/react-scroll-area": "latest",
    "@radix-ui/react-select": "latest",
    "@radix-ui/react-separator": "latest",
    "@radix-ui/react-slider": "latest",
    "@radix-ui/react-slot": "latest",
    "@radix-ui/react-switch": "latest",
    "@radix-ui/react-tabs": "latest",
    "@radix-ui/react-toast": "latest",
    "@radix-ui/react-toggle": "latest",
    "@radix-ui/react-toggle-group": "latest",
    "@radix-ui/react-tooltip": "latest",
    "@supabase/supabase-js": "latest",
    "class-variance-authority": "latest",
    "clsx": "^2.1.1",
    "cmdk": "latest",
    "date-fns": "latest",
    "embla-carousel-react": "latest",
    "framer-motion": "^12.23.25",
    "input-otp": "latest",
    "lucide-react": "latest",
    "next": "15.1.0",
    "next-themes": "latest",
    "react": "19.0.0",
    "react-day-picker": "latest",
    "react-dom": "19.0.0",
    "react-hook-form": "latest",
    "react-resizable-panels": "latest",
    "recharts": "latest",
    "sonner": "latest",
    "tailwind-merge": "^3.4.0",
    "tailwindcss-animate": "latest",
    "vaul": "latest",
    "zod": "latest"
  },
  "devDependencies": {
    "@cloudflare/next-on-pages": "^1.13.5",
    "@cloudflare/workers-types": "^4.20241112.0",
    "@tailwindcss/postcss": "latest",
    "@types/node": "^22.5.0",
    "@types/react": "latest",
    "@types/react-dom": "latest",
    "autoprefixer": "latest",
    "eslint": "^8",
    "eslint-config-next": "15.1.0",
    "postcss": "latest",
    "tailwindcss": "latest",
    "typescript": "^5",
    "wrangler": "^3.87.0"
  }
}
</file>

<file path="postcss.config.mjs">
/** @type {import('postcss-load-config').Config} */
const config = {
  plugins: {
    '@tailwindcss/postcss': {},
  },
}

export default config
</file>

<file path="public/icon.svg">
<svg width="180" height="180" viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
  <style>
    @media (prefers-color-scheme: light) {
      .background { fill: black; }
      .foreground { fill: white; }
    }
    @media (prefers-color-scheme: dark) {
      .background { fill: white; }
      .foreground { fill: black; }
    }
  </style>
  <g clip-path="url(#clip0_7960_43945)">
    <rect class="background" width="180" height="180" rx="37" />
    <g style="transform: scale(95%); transform-origin: center">
      <path class="foreground"
        d="M101.141 53H136.632C151.023 53 162.689 64.6662 162.689 79.0573V112.904H148.112V79.0573C148.112 78.7105 148.098 78.3662 148.072 78.0251L112.581 112.898C112.701 112.902 112.821 112.904 112.941 112.904H148.112V126.672H112.941C98.5504 126.672 86.5638 114.891 86.5638 100.5V66.7434H101.141V100.5C101.141 101.15 101.191 101.792 101.289 102.422L137.56 66.7816C137.255 66.7563 136.945 66.7434 136.632 66.7434H101.141V53Z" />
      <path class="foreground"
        d="M65.2926 124.136L14 66.7372H34.6355L64.7495 100.436V66.7372H80.1365V118.47C80.1365 126.278 70.4953 129.958 65.2926 124.136Z" />
    </g>
  </g>
  <defs>
    <clipPath id="clip0_7960_43945">
      <rect width="180" height="180" fill="white" />
    </clipPath>
  </defs>
</svg>
</file>

<file path="public/placeholder-logo.svg">
<svg xmlns="http://www.w3.org/2000/svg" width="215" height="48" fill="none"><path fill="#000" d="M57.588 9.6h6L73.828 38h-5.2l-2.36-6.88h-11.36L52.548 38h-5.2l10.24-28.4Zm7.16 17.16-4.16-12.16-4.16 12.16h8.32Zm23.694-2.24c-.186-1.307-.706-2.32-1.56-3.04-.853-.72-1.866-1.08-3.04-1.08-1.68 0-2.986.613-3.92 1.84-.906 1.227-1.36 2.947-1.36 5.16s.454 3.933 1.36 5.16c.934 1.227 2.24 1.84 3.92 1.84 1.254 0 2.307-.373 3.16-1.12.854-.773 1.387-1.867 1.6-3.28l5.12.24c-.186 1.68-.733 3.147-1.64 4.4-.906 1.227-2.08 2.173-3.52 2.84-1.413.667-2.986 1-4.72 1-2.08 0-3.906-.453-5.48-1.36-1.546-.907-2.76-2.2-3.64-3.88-.853-1.68-1.28-3.627-1.28-5.84 0-2.24.427-4.187 1.28-5.84.88-1.68 2.094-2.973 3.64-3.88 1.574-.907 3.4-1.36 5.48-1.36 1.68 0 3.227.32 4.64.96 1.414.64 2.56 1.56 3.44 2.76.907 1.2 1.454 2.6 1.64 4.2l-5.12.28Zm11.486-7.72.12 3.4c.534-1.227 1.307-2.173 2.32-2.84 1.04-.693 2.267-1.04 3.68-1.04 1.494 0 2.76.387 3.8 1.16 1.067.747 1.827 1.813 2.28 3.2.507-1.44 1.294-2.52 2.36-3.24 1.094-.747 2.414-1.12 3.96-1.12 1.414 0 2.64.307 3.68.92s1.84 1.52 2.4 2.72c.56 1.2.84 2.667.84 4.4V38h-4.96V25.92c0-1.813-.293-3.187-.88-4.12-.56-.96-1.413-1.44-2.56-1.44-.906 0-1.68.213-2.32.64-.64.427-1.133 1.053-1.48 1.88-.32.827-.48 1.84-.48 3.04V38h-4.56V25.92c0-1.2-.133-2.213-.4-3.04-.24-.827-.626-1.453-1.16-1.88-.506-.427-1.133-.64-1.88-.64-.906 0-1.68.227-2.32.68-.64.427-1.133 1.053-1.48 1.88-.32.827-.48 1.827-.48 3V38h-4.96V16.8h4.48Zm26.723 10.6c0-2.24.427-4.187 1.28-5.84.854-1.68 2.067-2.973 3.64-3.88 1.574-.907 3.4-1.36 5.48-1.36 1.84 0 3.494.413 4.96 1.24 1.467.827 2.64 2.08 3.52 3.76.88 1.653 1.347 3.693 1.4 6.12v1.32h-15.08c.107 1.813.614 3.227 1.52 4.24.907.987 2.134 1.48 3.68 1.48.987 0 1.88-.253 2.68-.76a4.803 4.803 0 0 0 1.84-2.2l5.08.36c-.64 2.027-1.84 3.64-3.6 4.84-1.733 1.173-3.733 1.76-6 1.76-2.08 0-3.906-.453-5.48-1.36-1.573-.907-2.786-2.2-3.64-3.88-.853-1.68-1.28-3.627-1.28-5.84Zm15.16-2.04c-.213-1.733-.76-3.013-1.64-3.84-.853-.827-1.893-1.24-3.12-1.24-1.44 0-2.6.453-3.48 1.36-.88.88-1.44 2.12-1.68 3.72h9.92ZM163.139 9.6V38h-5.04V9.6h5.04Zm8.322 7.2.24 5.88-.64-.36c.32-2.053 1.094-3.56 2.32-4.52 1.254-.987 2.787-1.48 4.6-1.48 2.32 0 4.107.733 5.36 2.2 1.254 1.44 1.88 3.387 1.88 5.84V38h-4.96V25.92c0-1.253-.12-2.28-.36-3.08-.24-.8-.64-1.413-1.2-1.84-.533-.427-1.253-.64-2.16-.64-1.44 0-2.573.48-3.4 1.44-.8.933-1.2 2.307-1.2 4.12V38h-4.96V16.8h4.48Zm30.003 7.72c-.186-1.307-.706-2.32-1.56-3.04-.853-.72-1.866-1.08-3.04-1.08-1.68 0-2.986.613-3.92 1.84-.906 1.227-1.36 2.947-1.36 5.16s.454 3.933 1.36 5.16c.934 1.227 2.24 1.84 3.92 1.84 1.254 0 2.307-.373 3.16-1.12.854-.773 1.387-1.867 1.6-3.28l5.12.24c-.186 1.68-.733 3.147-1.64 4.4-.906 1.227-2.08 2.173-3.52 2.84-1.413.667-2.986 1-4.72 1-2.08 0-3.906-.453-5.48-1.36-1.546-.907-2.76-2.2-3.64-3.88-.853-1.68-1.28-3.627-1.28-5.84 0-2.24.427-4.187 1.28-5.84.88-1.68 2.094-2.973 3.64-3.88 1.574-.907 3.4-1.36 5.48-1.36 1.68 0 3.227.32 4.64.96 1.414.64 2.56 1.56 3.44 2.76.907 1.2 1.454 2.6 1.64 4.2l-5.12.28Zm11.443 8.16V38h-5.6v-5.32h5.6Z"/><path fill="#171717" fill-rule="evenodd" d="m7.839 40.783 16.03-28.054L20 6 0 40.783h7.839Zm8.214 0H40L27.99 19.894l-4.02 7.032 3.976 6.914H20.02l-3.967 6.943Z" clip-rule="evenodd"/></svg>
</file>

<file path="public/placeholder.svg">
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="1200" fill="none"><rect width="1200" height="1200" fill="#EAEAEA" rx="3"/><g opacity=".5"><g opacity=".5"><path fill="#FAFAFA" d="M600.709 736.5c-75.454 0-136.621-61.167-136.621-136.62 0-75.454 61.167-136.621 136.621-136.621 75.453 0 136.62 61.167 136.62 136.621 0 75.453-61.167 136.62-136.62 136.62Z"/><path stroke="#C9C9C9" stroke-width="2.418" d="M600.709 736.5c-75.454 0-136.621-61.167-136.621-136.62 0-75.454 61.167-136.621 136.621-136.621 75.453 0 136.62 61.167 136.62 136.621 0 75.453-61.167 136.62-136.62 136.62Z"/></g><path stroke="url(#a)" stroke-width="2.418" d="M0-1.209h553.581" transform="scale(1 -1) rotate(45 1163.11 91.165)"/><path stroke="url(#b)" stroke-width="2.418" d="M404.846 598.671h391.726"/><path stroke="url(#c)" stroke-width="2.418" d="M599.5 795.742V404.017"/><path stroke="url(#d)" stroke-width="2.418" d="m795.717 796.597-391.441-391.44"/><path fill="#fff" d="M600.709 656.704c-31.384 0-56.825-25.441-56.825-56.824 0-31.384 25.441-56.825 56.825-56.825 31.383 0 56.824 25.441 56.824 56.825 0 31.383-25.441 56.824-56.824 56.824Z"/><g clip-path="url(#e)"><path fill="#666" fill-rule="evenodd" d="M616.426 586.58h-31.434v16.176l3.553-3.554.531-.531h9.068l.074-.074 8.463-8.463h2.565l7.18 7.181V586.58Zm-15.715 14.654 3.698 3.699 1.283 1.282-2.565 2.565-1.282-1.283-5.2-5.199h-6.066l-5.514 5.514-.073.073v2.876a2.418 2.418 0 0 0 2.418 2.418h26.598a2.418 2.418 0 0 0 2.418-2.418v-8.317l-8.463-8.463-7.181 7.181-.071.072Zm-19.347 5.442v4.085a6.045 6.045 0 0 0 6.046 6.045h26.598a6.044 6.044 0 0 0 6.045-6.045v-7.108l1.356-1.355-1.282-1.283-.074-.073v-17.989h-38.689v23.43l-.146.146.146.147Z" clip-rule="evenodd"/></g><path stroke="#C9C9C9" stroke-width="2.418" d="M600.709 656.704c-31.384 0-56.825-25.441-56.825-56.824 0-31.384 25.441-56.825 56.825-56.825 31.383 0 56.824 25.441 56.824 56.825 0 31.383-25.441 56.824-56.824 56.824Z"/></g><defs><linearGradient id="a" x1="554.061" x2="-.48" y1=".083" y2=".087" gradientUnits="userSpaceOnUse"><stop stop-color="#C9C9C9" stop-opacity="0"/><stop offset=".208" stop-color="#C9C9C9"/><stop offset=".792" stop-color="#C9C9C9"/><stop offset="1" stop-color="#C9C9C9" stop-opacity="0"/></linearGradient><linearGradient id="b" x1="796.912" x2="404.507" y1="599.963" y2="599.965" gradientUnits="userSpaceOnUse"><stop stop-color="#C9C9C9" stop-opacity="0"/><stop offset=".208" stop-color="#C9C9C9"/><stop offset=".792" stop-color="#C9C9C9"/><stop offset="1" stop-color="#C9C9C9" stop-opacity="0"/></linearGradient><linearGradient id="c" x1="600.792" x2="600.794" y1="403.677" y2="796.082" gradientUnits="userSpaceOnUse"><stop stop-color="#C9C9C9" stop-opacity="0"/><stop offset=".208" stop-color="#C9C9C9"/><stop offset=".792" stop-color="#C9C9C9"/><stop offset="1" stop-color="#C9C9C9" stop-opacity="0"/></linearGradient><linearGradient id="d" x1="404.85" x2="796.972" y1="403.903" y2="796.02" gradientUnits="userSpaceOnUse"><stop stop-color="#C9C9C9" stop-opacity="0"/><stop offset=".208" stop-color="#C9C9C9"/><stop offset=".792" stop-color="#C9C9C9"/><stop offset="1" stop-color="#C9C9C9" stop-opacity="0"/></linearGradient><clipPath id="e"><path fill="#fff" d="M581.364 580.535h38.689v38.689h-38.689z"/></clipPath></defs></svg>
</file>

<file path="README.md">
# Elite Golf Sim - Vanderbijlpark Golf Simulator Booking Platform

Vanderbijlpark's premier indoor golf simulator experience featuring Augusta National, skills challenges, and real-time bay availability.

## 🏌️ Features

### Customer-Facing
- **Real-Time Bay Availability**: Live status display showing available bays with color indicators
- **Augusta National 18 Holes**: Premium experience for 3-4 players (R480/R600)
- **Quick Play Sessions**: Solo (R250) and duo (R360) sessions on all courses
- **Walk-In Friendly**: Pay at Yoco terminal on-site at SW5 Vanderbijlpark
- **Monthly Competitions**: Longest Drive (R2000 voucher), Hole-in-One, and Closest to Pin challenges
- **POPIA Compliant**: WhatsApp opt-in for booking confirmations
- **Mobile-First Design**: Optimized for "golf simulator near me" searches
- **Secure Payments**: Yoco payment processing with cards, Apple Pay, and Google Pay

### Admin Dashboard
- **Walk-In Bookings**: Password-protected admin page for on-site bookings
- **Booking Management**: View, search, filter, and cancel bookings
- **Availability Control**: Manage time slots and bay status
- **Revenue Reports**: Track daily, weekly, and monthly revenue
- **Competition Management**: Monitor entries and leaderboards

## 🚀 Cloudflare Pages Deployment

This project is configured for deployment on Cloudflare Pages using `@cloudflare/next-on-pages`.

### Prerequisites

- Node.js 22+
- pnpm package manager
- Cloudflare account
- Supabase account
- Yoco account (South African payment gateway)

### Setup

1. **Install dependencies:**
\`\`\`bash
pnpm install
\`\`\`

2. **Run database migrations:**
Execute the SQL scripts in the `scripts/` folder in order:
- `001_create_tables.sql` - Creates database tables
- `002_enable_rls.sql` - Enables Row Level Security
- `003_seed_data.sql` - Seeds initial data
- `004_create_functions.sql` - Creates database functions

Run these directly in v0 or in your Supabase SQL editor.

3. **Configure environment variables** (in Cloudflare dashboard or locally):
\`\`\`bash
# Supabase
SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# Yoco Payment Gateway
YOCO_SECRET_KEY=sk_test_your_secret_key

# App URL (for payment callbacks)
NEXT_PUBLIC_SITE_URL=https://your-site.pages.dev
\`\`\`

4. **Build for Cloudflare:**
\`\`\`bash
pnpm build
\`\`\`

5. **Deploy to Cloudflare Pages:**
\`\`\`bash
pnpm pages:deploy
\`\`\`

For detailed deployment instructions, see [CLOUDFLARE_DEPLOYMENT.md](./CLOUDFLARE_DEPLOYMENT.md).

## 💳 Payment Integration

- **Processor**: Yoco (South African payment gateway)
- **Methods**: All major cards, Apple Pay, Google Pay
- **Compliance**: PCI-DSS compliant hosted checkout
- **Features**: Instant settlements, no setup fees, competitive rates

### Yoco Test Cards
- **Success**: 4111 1111 1111 1111 (CVV: 123, any future date)
- **Declined**: 4000 0000 0000 0002

## 📍 Location & Hours

**Elite Golf Sim**  
SW5 Vanderbijlpark, Gauteng, South Africa

**Operating Hours:**  
Monday - Saturday: 9AM - 8PM  
Sunday: Closed

**Walk-ins Welcome:** Pay via Yoco card terminal on-site

## 🔍 SEO & Keywords

**Primary Keywords:**
- "golf simulator near me Vanderbijlpark"
- "indoor golf simulator near me Gauteng"

**Features:**
- Augusta National course simulation
- Real-time 3-bay availability display
- Walk-in welcome with on-site payment
- Mobile-optimized booking (320px+)
- Schema markup for LocalBusiness and SportsActivityLocation

## 🛠️ Tech Stack

- **Framework**: Next.js 15 (App Router)
- **Runtime**: Cloudflare Workers (Edge Runtime)
- **Database**: Supabase (PostgreSQL with RLS)
- **Payments**: Yoco payment gateway
- **Styling**: Tailwind CSS v4 + shadcn/ui
- **Deployment**: Cloudflare Pages with OpenNext
- **Node Version**: 22+

## 📱 Mobile Optimization

- **Breakpoint**: 320px minimum width
- **Above-the-fold**: Real-time bay status on mobile
- **Simplified Flow**: 2-step booking for quick conversions
- **Local Search**: Optimized for "near me" searches
- **Click Actions**: Direct maps and payment integration

## 🏆 Competition Features

**Included with Every Booking:**
- **Longest Drive Challenge**: Win R2000 Pro Shop voucher monthly
- **Hole-in-One Challenge**: Instant prizes on designated holes
- **Closest to Pin**: Free 2-hour session for monthly winner

## 💰 Pricing Structure (December Launch)

### Augusta National 18 Holes
- **3 Players**: R480 (2-hour minimum required)
- **4 Players**: R600 (3-hour minimum required)
- *Note: Full time block required, no overtime permitted*

### Quick Play Sessions
- **Solo**: R250 (1-hour minimum)
- **Duo**: R360 (1-hour minimum)
- *All courses and skills challenges included*

## 🗂️ Project Structure

\`\`\`
├── app/
│   ├── page.tsx                    # Homepage with SEO optimization
│   ├── layout.tsx                  # Layout with schema markup
│   ├── booking/
│   │   ├── page.tsx               # 2-step booking flow
│   │   ├── confirm/page.tsx       # POPIA-compliant confirmation
│   │   └── success/page.tsx       # Payment success
│   ├── admin/
│   │   └── page.tsx               # Walk-in booking admin
│   └── api/
│       ├── bays/status/route.ts   # Real-time bay availability
│       └── payment/
│           ├── initialize/route.ts # Yoco payment init
│           └── verify/route.ts     # Payment verification
├── components/
│   ├── bay-status-display.tsx     # Live 3-bay status widget
│   ├── booking-flow.tsx           # Session type + booking flow
│   ├── booking-confirmation.tsx   # POPIA checkboxes + payment
│   └── admin-dashboard.tsx        # Admin interface
├── lib/
│   ├── supabase/
│   │   ├── client.ts              # Browser Supabase client
│   │   ├── server.ts              # Server Supabase client
│   │   └── middleware.ts          # Auth middleware
│   └── types.ts                   # TypeScript types
└── scripts/
    ├── 001_create_tables.sql      # Database schema
    ├── 002_enable_rls.sql         # Security policies
    ├── 003_seed_data.sql          # Initial data
    └── 004_create_functions.sql   # Database functions
\`\`\`

## 🔑 Admin Access

**Walk-In Bookings:**
1. Navigate to `/admin`
2. Enter password protection
3. Create walk-in booking (bypasses payment)
4. Generate printable receipt with QR code

**Booking Management:**
- View all bookings in real-time
- Manage bay availability
- Export revenue reports
- Track competition entries

## 🌐 Cloudflare Advantages

- **Global Edge Network**: Sub-100ms response times
- **Zero Cold Starts**: Always-on edge runtime
- **DDoS Protection**: Enterprise-grade security
- **Unlimited Bandwidth**: No egress charges
- **Cost Effective**: More affordable than Vercel

## 🚦 Launch Checklist

- [x] Augusta National and 5000+ courses
- [x] Real-time bay availability display
- [x] Walk-in payment messaging
- [x] POPIA-compliant WhatsApp opt-ins
- [x] December pricing structure
- [x] Operating hours in header + footer
- [x] SEO optimization for "near me" searches
- [x] Mobile-first responsive design
- [x] Yoco webhook endpoints configured
- [x] Schema markup for local search
- [x] Custom domain setup
- [x] Production Yoco keys
- [x] n8n automation webhook testing

## 📈 Performance Targets

- **Lighthouse Performance**: >90
- **Lighthouse Accessibility**: >95
- **Mobile Booking Time**: <60 seconds
- **Page Load Time**: <2 seconds
- **Bay Status Refresh**: 30 seconds

## 🆘 Support

**Deployment Issues:** See [CLOUDFLARE_DEPLOYMENT.md](./CLOUDFLARE_DEPLOYMENT.md)

**Technical Support:**
- Database: Check Supabase dashboard and RLS policies
- Payments: Verify Yoco keys and webhook configuration
- Environment: Confirm all variables in Cloudflare dashboard

**Production Launch:** Ensure all environment variables are updated from test to production values.

## 📄 License

© 2025 Elite Golf Sim. All rights reserved.
</file>

<file path="scripts/001_create_tables.sql">
-- Create enum types for booking status and user types
CREATE TYPE booking_status AS ENUM ('pending', 'confirmed', 'cancelled', 'completed');
CREATE TYPE user_type AS ENUM ('adult', 'student', 'junior', 'senior');
CREATE TYPE payment_status AS ENUM ('pending', 'completed', 'failed', 'refunded');
CREATE TYPE day_type AS ENUM ('weekday', 'weekend', 'holiday');

-- Profiles table (extends auth.users)
CREATE TABLE IF NOT EXISTS public.profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  email TEXT NOT NULL,
  full_name TEXT,
  phone TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Pricing rules table
CREATE TABLE IF NOT EXISTS public.pricing_rules (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_type user_type NOT NULL,
  day_type day_type NOT NULL,
  start_hour INTEGER NOT NULL CHECK (start_hour >= 0 AND start_hour < 24),
  end_hour INTEGER NOT NULL CHECK (end_hour >= 0 AND end_hour <= 24),
  price_per_hour DECIMAL(10, 2) NOT NULL,
  is_peak BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(user_type, day_type, start_hour, end_hour)
);

-- Availability calendar table
CREATE TABLE IF NOT EXISTS public.availability (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  date DATE NOT NULL,
  start_time TIME NOT NULL,
  end_time TIME NOT NULL,
  is_available BOOLEAN DEFAULT TRUE,
  max_bookings INTEGER DEFAULT 1,
  current_bookings INTEGER DEFAULT 0,
  day_type day_type NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(date, start_time)
);

-- Bookings table
CREATE TABLE IF NOT EXISTS public.bookings (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES public.profiles(id) ON DELETE CASCADE,
  booking_date DATE NOT NULL,
  start_time TIME NOT NULL,
  end_time TIME NOT NULL,
  duration_hours DECIMAL(3, 2) NOT NULL,
  player_count INTEGER NOT NULL CHECK (player_count >= 1 AND player_count <= 8),
  user_type user_type NOT NULL,
  base_price DECIMAL(10, 2) NOT NULL,
  total_price DECIMAL(10, 2) NOT NULL,
  status booking_status DEFAULT 'pending',
  payment_status payment_status DEFAULT 'pending',
  payment_reference TEXT,
  guest_name TEXT,
  guest_email TEXT,
  guest_phone TEXT,
  special_requests TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  cancelled_at TIMESTAMPTZ
);

-- Upsells table
CREATE TABLE IF NOT EXISTS public.upsells (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  description TEXT,
  price DECIMAL(10, 2) NOT NULL,
  category TEXT NOT NULL, -- 'food', 'beverage', 'equipment', 'lesson', 'membership'
  trigger_condition JSONB, -- Conditions for when to show this upsell
  is_active BOOLEAN DEFAULT TRUE,
  image_url TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Booking upsells junction table
CREATE TABLE IF NOT EXISTS public.booking_upsells (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  booking_id UUID REFERENCES public.bookings(id) ON DELETE CASCADE,
  upsell_id UUID REFERENCES public.upsells(id) ON DELETE CASCADE,
  quantity INTEGER DEFAULT 1,
  price DECIMAL(10, 2) NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(booking_id, upsell_id)
);

-- Competitions table
CREATE TABLE IF NOT EXISTS public.competitions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  description TEXT,
  type TEXT NOT NULL, -- 'longest_drive', 'closest_to_pin'
  start_date DATE NOT NULL,
  end_date DATE NOT NULL,
  prize TEXT,
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Competition entries table
CREATE TABLE IF NOT EXISTS public.competition_entries (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  competition_id UUID REFERENCES public.competitions(id) ON DELETE CASCADE,
  booking_id UUID REFERENCES public.bookings(id) ON DELETE CASCADE,
  user_id UUID REFERENCES public.profiles(id) ON DELETE CASCADE,
  score DECIMAL(10, 2),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(competition_id, booking_id)
);

-- Holidays table for dynamic pricing
CREATE TABLE IF NOT EXISTS public.holidays (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  date DATE NOT NULL UNIQUE,
  name TEXT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Create indexes for better query performance
CREATE INDEX idx_bookings_user_id ON public.bookings(user_id);
CREATE INDEX idx_bookings_date ON public.bookings(booking_date);
CREATE INDEX idx_bookings_status ON public.bookings(status);
CREATE INDEX idx_availability_date ON public.availability(date);
CREATE INDEX idx_pricing_rules_lookup ON public.pricing_rules(user_type, day_type);
</file>

<file path="scripts/002_enable_rls.sql">
-- Enable Row Level Security on all tables
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.bookings ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.booking_upsells ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.competition_entries ENABLE ROW LEVEL SECURITY;

-- Profiles policies
CREATE POLICY "Users can view their own profile"
  ON public.profiles FOR SELECT
  USING (auth.uid() = id);

CREATE POLICY "Users can update their own profile"
  ON public.profiles FOR UPDATE
  USING (auth.uid() = id);

CREATE POLICY "Users can insert their own profile"
  ON public.profiles FOR INSERT
  WITH CHECK (auth.uid() = id);

-- Bookings policies
CREATE POLICY "Users can view their own bookings"
  ON public.bookings FOR SELECT
  USING (auth.uid() = user_id OR user_id IS NULL);

CREATE POLICY "Users can create bookings"
  ON public.bookings FOR INSERT
  WITH CHECK (auth.uid() = user_id OR user_id IS NULL);

CREATE POLICY "Users can update their own bookings"
  ON public.bookings FOR UPDATE
  USING (auth.uid() = user_id OR user_id IS NULL);

-- Booking upsells policies
CREATE POLICY "Users can view their booking upsells"
  ON public.booking_upsells FOR SELECT
  USING (
    EXISTS (
      SELECT 1 FROM public.bookings
      WHERE bookings.id = booking_upsells.booking_id
      AND (bookings.user_id = auth.uid() OR bookings.user_id IS NULL)
    )
  );

CREATE POLICY "Users can create booking upsells"
  ON public.booking_upsells FOR INSERT
  WITH CHECK (
    EXISTS (
      SELECT 1 FROM public.bookings
      WHERE bookings.id = booking_upsells.booking_id
      AND (bookings.user_id = auth.uid() OR bookings.user_id IS NULL)
    )
  );

-- Competition entries policies
CREATE POLICY "Users can view their competition entries"
  ON public.competition_entries FOR SELECT
  USING (auth.uid() = user_id);

CREATE POLICY "Users can create competition entries"
  ON public.competition_entries FOR INSERT
  WITH CHECK (auth.uid() = user_id);

-- Public read access for reference tables (no auth required)
ALTER TABLE public.pricing_rules ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.availability ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.upsells ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.competitions ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.holidays ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Anyone can view pricing rules"
  ON public.pricing_rules FOR SELECT
  USING (true);

CREATE POLICY "Anyone can view availability"
  ON public.availability FOR SELECT
  USING (true);

CREATE POLICY "Anyone can view active upsells"
  ON public.upsells FOR SELECT
  USING (is_active = true);

CREATE POLICY "Anyone can view active competitions"
  ON public.competitions FOR SELECT
  USING (is_active = true);

CREATE POLICY "Anyone can view holidays"
  ON public.holidays FOR SELECT
  USING (true);
</file>

<file path="scripts/003_seed_data.sql">
-- Seed pricing rules for different user types and time periods
-- Adult pricing
INSERT INTO public.pricing_rules (user_type, day_type, start_hour, end_hour, price_per_hour, is_peak) VALUES
('adult', 'weekday', 6, 12, 350.00, false),
('adult', 'weekday', 12, 18, 450.00, true),
('adult', 'weekday', 18, 22, 400.00, true),
('adult', 'weekend', 6, 12, 450.00, true),
('adult', 'weekend', 12, 18, 550.00, true),
('adult', 'weekend', 18, 22, 500.00, true),
('adult', 'holiday', 6, 22, 600.00, true);

-- Student pricing (20% discount)
INSERT INTO public.pricing_rules (user_type, day_type, start_hour, end_hour, price_per_hour, is_peak) VALUES
('student', 'weekday', 6, 12, 280.00, false),
('student', 'weekday', 12, 18, 360.00, true),
('student', 'weekday', 18, 22, 320.00, true),
('student', 'weekend', 6, 12, 360.00, true),
('student', 'weekend', 12, 18, 440.00, true),
('student', 'weekend', 18, 22, 400.00, true),
('student', 'holiday', 6, 22, 480.00, true);

-- Junior pricing (30% discount)
INSERT INTO public.pricing_rules (user_type, day_type, start_hour, end_hour, price_per_hour, is_peak) VALUES
('junior', 'weekday', 6, 12, 245.00, false),
('junior', 'weekday', 12, 18, 315.00, true),
('junior', 'weekday', 18, 22, 280.00, true),
('junior', 'weekend', 6, 12, 315.00, true),
('junior', 'weekend', 12, 18, 385.00, true),
('junior', 'weekend', 18, 22, 350.00, true),
('junior', 'holiday', 6, 22, 420.00, true);

-- Senior pricing (25% discount)
INSERT INTO public.pricing_rules (user_type, day_type, start_hour, end_hour, price_per_hour, is_peak) VALUES
('senior', 'weekday', 6, 12, 262.50, false),
('senior', 'weekday', 12, 18, 337.50, true),
('senior', 'weekday', 18, 22, 300.00, true),
('senior', 'weekend', 6, 12, 337.50, true),
('senior', 'weekend', 12, 18, 412.50, true),
('senior', 'weekend', 18, 22, 375.00, true),
('senior', 'holiday', 6, 22, 450.00, true);

-- Seed availability for next 30 days (6 AM to 10 PM slots)
DO $$
DECLARE
  current_date DATE := CURRENT_DATE;
  end_date DATE := CURRENT_DATE + INTERVAL '30 days';
  slot_time TIME;
  day_type_val day_type;
BEGIN
  WHILE current_date <= end_date LOOP
    -- Determine day type
    IF EXTRACT(DOW FROM current_date) IN (0, 6) THEN
      day_type_val := 'weekend';
    ELSE
      day_type_val := 'weekday';
    END IF;
    
    -- Create hourly slots from 6 AM to 10 PM
    FOR hour IN 6..21 LOOP
      slot_time := (hour || ':00:00')::TIME;
      INSERT INTO public.availability (date, start_time, end_time, is_available, max_bookings, current_bookings, day_type)
      VALUES (current_date, slot_time, (slot_time + INTERVAL '1 hour')::TIME, true, 2, 0, day_type_val);
    END LOOP;
    
    current_date := current_date + INTERVAL '1 day';
  END LOOP;
END $$;

-- Seed upsells
INSERT INTO public.upsells (name, description, price, category, trigger_condition, is_active) VALUES
('Premium Golf Balls (Dozen)', 'Titleist Pro V1 golf balls', 85.00, 'equipment', '{"min_duration": 1}', true),
('Club Rental Set', 'Full set of premium clubs', 150.00, 'equipment', '{"player_count_min": 1}', true),
('30-Min Private Lesson', 'One-on-one coaching session', 450.00, 'lesson', '{"user_type": ["adult", "student"]}', true),
('Gourmet Burger & Chips', 'Chef''s special burger with fries', 120.00, 'food', '{"min_duration": 2}', true),
('Craft Beer Selection', 'Choice of premium craft beers', 65.00, 'beverage', '{"user_type": ["adult"]}', true),
('Soft Drinks & Snacks', 'Assorted beverages and snacks', 45.00, 'beverage', '{}', true),
('Monthly Membership', 'Unlimited access for 30 days', 2500.00, 'membership', '{"booking_count_min": 3}', true),
('Golf Glove', 'Premium leather golf glove', 35.00, 'equipment', '{}', true);

-- Seed sample competitions
INSERT INTO public.competitions (name, description, type, start_date, end_date, prize, is_active) VALUES
('Monthly Longest Drive Challenge', 'Hit the longest drive and win!', 'longest_drive', CURRENT_DATE, CURRENT_DATE + INTERVAL '30 days', 'R2000 Pro Shop Voucher', true),
('Closest to the Pin Competition', 'Get closest to the pin on our signature hole', 'closest_to_pin', CURRENT_DATE, CURRENT_DATE + INTERVAL '30 days', 'Free 2-Hour Session', true);

-- Seed South African public holidays for 2025
INSERT INTO public.holidays (date, name) VALUES
('2025-01-01', 'New Year''s Day'),
('2025-03-21', 'Human Rights Day'),
('2025-04-18', 'Good Friday'),
('2025-04-21', 'Family Day'),
('2025-04-27', 'Freedom Day'),
('2025-05-01', 'Workers'' Day'),
('2025-06-16', 'Youth Day'),
('2025-08-09', 'National Women''s Day'),
('2025-09-24', 'Heritage Day'),
('2025-12-16', 'Day of Reconciliation'),
('2025-12-25', 'Christmas Day'),
('2025-12-26', 'Day of Goodwill');
</file>

<file path="scripts/004_create_functions.sql">
-- Function to automatically create profile on user signup
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS TRIGGER
LANGUAGE plpgsql
SECURITY DEFINER
SET search_path = public
AS $$
BEGIN
  INSERT INTO public.profiles (id, email, full_name)
  VALUES (
    NEW.id,
    NEW.email,
    COALESCE(NEW.raw_user_meta_data->>'full_name', NULL)
  )
  ON CONFLICT (id) DO NOTHING;
  RETURN NEW;
END;
$$;

-- Create trigger for new user signup
DROP TRIGGER IF EXISTS on_auth_user_created ON auth.users;
CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW
  EXECUTE FUNCTION public.handle_new_user();

-- Function to update availability when booking is created
CREATE OR REPLACE FUNCTION public.update_availability_on_booking()
RETURNS TRIGGER
LANGUAGE plpgsql
AS $$
BEGIN
  IF NEW.status = 'confirmed' THEN
    UPDATE public.availability
    SET current_bookings = current_bookings + 1
    WHERE date = NEW.booking_date
    AND start_time = NEW.start_time;
  END IF;
  RETURN NEW;
END;
$$;

-- Create trigger for booking creation
DROP TRIGGER IF EXISTS on_booking_confirmed ON public.bookings;
CREATE TRIGGER on_booking_confirmed
  AFTER INSERT OR UPDATE ON public.bookings
  FOR EACH ROW
  EXECUTE FUNCTION public.update_availability_on_booking();

-- Function to restore availability when booking is cancelled
CREATE OR REPLACE FUNCTION public.restore_availability_on_cancel()
RETURNS TRIGGER
LANGUAGE plpgsql
AS $$
BEGIN
  IF NEW.status = 'cancelled' AND OLD.status != 'cancelled' THEN
    UPDATE public.availability
    SET current_bookings = GREATEST(0, current_bookings - 1)
    WHERE date = NEW.booking_date
    AND start_time = NEW.start_time;
  END IF;
  RETURN NEW;
END;
$$;

-- Create trigger for booking cancellation
DROP TRIGGER IF EXISTS on_booking_cancelled ON public.bookings;
CREATE TRIGGER on_booking_cancelled
  AFTER UPDATE ON public.bookings
  FOR EACH ROW
  EXECUTE FUNCTION public.restore_availability_on_cancel();

-- Function to calculate total price with upsells
CREATE OR REPLACE FUNCTION public.calculate_booking_total(booking_id_param UUID)
RETURNS DECIMAL(10, 2)
LANGUAGE plpgsql
AS $$
DECLARE
  base_price DECIMAL(10, 2);
  upsells_total DECIMAL(10, 2);
BEGIN
  SELECT b.base_price INTO base_price
  FROM public.bookings b
  WHERE b.id = booking_id_param;
  
  SELECT COALESCE(SUM(bu.price * bu.quantity), 0) INTO upsells_total
  FROM public.booking_upsells bu
  WHERE bu.booking_id = booking_id_param;
  
  RETURN base_price + upsells_total;
END;
$$;
</file>

<file path="scripts/005_add_booking_fields.sql">
-- Add missing fields to bookings table for production deployment

ALTER TABLE public.bookings 
ADD COLUMN IF NOT EXISTS session_type TEXT,
ADD COLUMN IF NOT EXISTS famous_course_option TEXT,
ADD COLUMN IF NOT EXISTS accept_whatsapp BOOLEAN DEFAULT FALSE,
ADD COLUMN IF NOT EXISTS enter_competition BOOLEAN DEFAULT FALSE,
ADD COLUMN IF NOT EXISTS coupon_code TEXT;

-- Create index for coupon code lookups
CREATE INDEX IF NOT EXISTS idx_bookings_coupon_code ON public.bookings(coupon_code);

-- Add comment for documentation
COMMENT ON COLUMN public.bookings.session_type IS 'Type of session: quickplay or famous-course';
COMMENT ON COLUMN public.bookings.famous_course_option IS 'Special pricing option: 3-ball or 4-ball for famous courses';
COMMENT ON COLUMN public.bookings.accept_whatsapp IS 'POPIA compliant WhatsApp consent for booking confirmations';
COMMENT ON COLUMN public.bookings.enter_competition IS 'Optional competition entry consent';
COMMENT ON COLUMN public.bookings.coupon_code IS 'Applied coupon code for discount tracking';
</file>

<file path="scripts/006_update_pricing_and_courses.sql">
-- Update famous course pricing and add St. Andrews course

-- Update upsells table to include golf club rental option
INSERT INTO public.upsells (name, description, price, category, trigger_condition, is_active) 
VALUES ('Golf Club Rental', 'Full set of premium golf clubs for your session', 100.00, 'equipment', '{"player_count_min": 1}', true)
ON CONFLICT (name) DO UPDATE 
SET description = EXCLUDED.description, 
    price = EXCLUDED.price,
    is_active = EXCLUDED.is_active;

-- Add St. Andrews to famous courses (if you have a courses table)
-- Note: The software has 5000+ courses, but we're ensuring St. Andrews is explicitly available
-- This is a placeholder - adjust based on your actual courses table structure
-- CREATE TABLE IF NOT EXISTS public.famous_courses (
--   id SERIAL PRIMARY KEY,
--   name VARCHAR(255) NOT NULL UNIQUE,
--   location VARCHAR(255),
--   holes INTEGER DEFAULT 18,
--   par INTEGER,
--   is_active BOOLEAN DEFAULT true,
--   created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
-- );

-- INSERT INTO public.famous_courses (name, location, holes, par, is_active)
-- VALUES ('St. Andrews (Old Course)', 'St. Andrews, Scotland', 18, 72, true)
-- ON CONFLICT (name) DO NOTHING;

-- Add comment about pricing update
COMMENT ON TABLE public.bookings IS 'Bookings table - Updated pricing: 4-ball and 3-ball specials now R150/person/hour with 3-hour minimum';
</file>

<file path="scripts/007_add_addons_to_bookings.sql">
-- Add add-on fields to bookings table for golf club rental and coaching

ALTER TABLE bookings 
ADD COLUMN IF NOT EXISTS golf_club_rental BOOLEAN DEFAULT FALSE,
ADD COLUMN IF NOT EXISTS coaching_session BOOLEAN DEFAULT FALSE;

-- Add comment explaining the add-ons
COMMENT ON COLUMN bookings.golf_club_rental IS 'Golf club rental add-on (R100)';
COMMENT ON COLUMN bookings.coaching_session IS 'Professional coaching add-on (R450 for 1 hour)';
</file>

<file path="scripts/008_add_public_booking_policy.sql">
-- Add a public policy to allow anyone to view booking time slots for availability checking
-- This only exposes start_time data for availability purposes, not user information

-- First check if policy exists and drop it if so
DROP POLICY IF EXISTS "Anyone can view booking times for availability" ON public.bookings;

-- Create new policy that allows public read access to non-cancelled bookings
-- but only for the fields needed for availability (start_time, end_time, booking_date)
CREATE POLICY "Anyone can view booking times for availability"
  ON public.bookings FOR SELECT
  USING (status != 'cancelled');
</file>

<file path="styles/globals.css">
@import 'tailwindcss';
@import 'tw-animate-css';

@custom-variant dark (&:is(.dark *));

:root {
  --background: oklch(1 0 0);
  --foreground: oklch(0.145 0 0);
  --card: oklch(1 0 0);
  --card-foreground: oklch(0.145 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.145 0 0);
  --primary: oklch(0.205 0 0);
  --primary-foreground: oklch(0.985 0 0);
  --secondary: oklch(0.97 0 0);
  --secondary-foreground: oklch(0.205 0 0);
  --muted: oklch(0.97 0 0);
  --muted-foreground: oklch(0.556 0 0);
  --accent: oklch(0.97 0 0);
  --accent-foreground: oklch(0.205 0 0);
  --destructive: oklch(0.577 0.245 27.325);
  --destructive-foreground: oklch(0.577 0.245 27.325);
  --border: oklch(0.922 0 0);
  --input: oklch(0.922 0 0);
  --ring: oklch(0.708 0 0);
  --chart-1: oklch(0.646 0.222 41.116);
  --chart-2: oklch(0.6 0.118 184.704);
  --chart-3: oklch(0.398 0.07 227.392);
  --chart-4: oklch(0.828 0.189 84.429);
  --chart-5: oklch(0.769 0.188 70.08);
  --radius: 0.625rem;
  --sidebar: oklch(0.985 0 0);
  --sidebar-foreground: oklch(0.145 0 0);
  --sidebar-primary: oklch(0.205 0 0);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.97 0 0);
  --sidebar-accent-foreground: oklch(0.205 0 0);
  --sidebar-border: oklch(0.922 0 0);
  --sidebar-ring: oklch(0.708 0 0);
}

.dark {
  --background: oklch(0.145 0 0);
  --foreground: oklch(0.985 0 0);
  --card: oklch(0.145 0 0);
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.145 0 0);
  --popover-foreground: oklch(0.985 0 0);
  --primary: oklch(0.985 0 0);
  --primary-foreground: oklch(0.205 0 0);
  --secondary: oklch(0.269 0 0);
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.269 0 0);
  --muted-foreground: oklch(0.708 0 0);
  --accent: oklch(0.269 0 0);
  --accent-foreground: oklch(0.985 0 0);
  --destructive: oklch(0.396 0.141 25.723);
  --destructive-foreground: oklch(0.637 0.237 25.331);
  --border: oklch(0.269 0 0);
  --input: oklch(0.269 0 0);
  --ring: oklch(0.439 0 0);
  --chart-1: oklch(0.488 0.243 264.376);
  --chart-2: oklch(0.696 0.17 162.48);
  --chart-3: oklch(0.769 0.188 70.08);
  --chart-4: oklch(0.627 0.265 303.9);
  --chart-5: oklch(0.645 0.246 16.439);
  --sidebar: oklch(0.205 0 0);
  --sidebar-foreground: oklch(0.985 0 0);
  --sidebar-primary: oklch(0.488 0.243 264.376);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.269 0 0);
  --sidebar-accent-foreground: oklch(0.985 0 0);
  --sidebar-border: oklch(0.269 0 0);
  --sidebar-ring: oklch(0.439 0 0);
}

@theme inline {
  --font-sans: 'Geist', 'Geist Fallback';
  --font-mono: 'Geist Mono', 'Geist Mono Fallback';
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-destructive-foreground: var(--destructive-foreground);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
  --color-sidebar: var(--sidebar);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-ring: var(--sidebar-ring);
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }
}
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "target": "ES6",
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
</file>

<file path="worker.js">
import { getAssetFromKV } from '@cloudflare/kv-asset-handler';
import { nextOnPagesRoutes } from './_worker.js/next-on-pages-internal/routes-manifest.js';

export default {
  async fetch(request, env, ctx) {
    try {
      return await getAssetFromKV({
        request,
        waitUntil(promise) {
          return ctx.waitUntil(promise);
        },
      });
    } catch (e) {
      let pathname = new URL(request.url).pathname;
      if (nextOnPagesRoutes.some(route => pathname.startsWith(route.pattern))) {
        return (await import('./_worker.js')).default.fetch(request, env, ctx);
      }
      return new Response(e.message || e.toString(), { status: 500 });
    }
  }
};
</file>

<file path="wrangler.toml">
name = "bestmulligan"
compatibility_date = "2025-11-25"
compatibility_flags = ["nodejs_compat"]
pages_build_output_dir = ".vercel/output/static"
</file>

</files>
